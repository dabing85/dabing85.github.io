{
    "version": "https://jsonfeed.org/version/1",
    "title": "null • All posts by \"https\" tag",
    "description": "欢迎来到大冰的笔记空间~这里主要会记录编程学习笔记🌸",
    "home_page_url": "https://blog.dabing.cool",
    "items": [
        {
            "id": "https://blog.dabing.cool/hexo/ssl/",
            "url": "https://blog.dabing.cool/hexo/ssl/",
            "title": "服务器配置hexo开启https（ssl证书）",
            "date_published": "2022-09-05T13:46:25.000Z",
            "content_html": "<p>作者：dabing（王甜甜）</p>\n<p>参加了又拍云的联盟活动，白嫖的 10G 的存储空间 + 15GB 的 CDN 免费流量，有域名并且已经备案的有网站的小伙伴也可以去试试：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudXB5dW4uY29tL2xlYWd1ZQ==\">又拍云联盟 - 开发者帮助计划，为开发者加速 - 又拍云 (upyun.com)</span></p>\n<p><img data-src=\"http://image.dabing.cool/image/image-20220909084820511.png\" alt=\"image-20220909084820511\"></p>\n<p>顺便申请了免费的 SSL 证书，你看我的小站现在是 https 开头的啦～～～</p>\n<p>一些申领过程可以参考我友链中余白的博客：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudmlweXViYWkudG9wL3Bvc3QvYTQyYmVmYzYuaHRtbA==\">hexo 的优化：又拍云 cdn 加速 | 余白の小屋 (vipyubai.top)</span></p>\n<p>我这里只是记录一下我在服务器 nginx 如何开启 https（SSL 证书）</p>\n<h1 id=\"获取证书\"><a class=\"markdownIt-Anchor\" href=\"#获取证书\">#</a> 获取证书</h1>\n<p>先从你的又拍云平台把已经颁发了的证书下载下来。</p>\n<p>我的下载下来有两个文件：</p>\n<ul>\n<li>blog.dabing.cool.crt</li>\n<li>blog.dabing.cool.key</li>\n</ul>\n<p><img data-src=\"http://image.dabing.cool/image/image-20220909085441872.png\" alt=\"image-20220909085441872\"></p>\n<h1 id=\"服务器配置nginx\"><a class=\"markdownIt-Anchor\" href=\"#服务器配置nginx\">#</a> 服务器配置 nginx</h1>\n<p>我参考的这篇文章：<span class=\"exturl\" data-url=\"aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC84NTA0MDYyNQ==\">Nginx 配置 SSL 证书</span></p>\n<p>懒得再写一次了，这里记录一下我的配置</p>\n<h2 id=\"1-先检测一下自己的环境是否允许\"><a class=\"markdownIt-Anchor\" href=\"#1-先检测一下自己的环境是否允许\">#</a> 1. 先检测一下自己的环境是否允许：</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>nginx <span class=\"token parameter variable\">-V</span></pre></td></tr></table></figure><p>看到这个 <code>--with-stream_ssl_module</code>  那就 ok</p>\n<p><img data-src=\"http://image.dabing.cool/image/image-20220909090711795.png\" alt=\"image-20220909090711795\"></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl version</pre></td></tr></table></figure><p><img data-src=\"http://image.dabing.cool/image/image-20220909090843974.png\" alt=\"image-20220909090843974\"></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">rpm</span> <span class=\"token parameter variable\">-qa</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token function\">open</span>  <span class=\"token comment\"># 查询是否安装 openssl</span></pre></td></tr></table></figure><p><img data-src=\"http://image.dabing.cool/image/image-20220909091040936.png\" alt=\"image-20220909091040936\"></p>\n<h2 id=\"2-confd的文件配置\"><a class=\"markdownIt-Anchor\" href=\"#2-confd的文件配置\">#</a> 2. conf.d/ 的文件配置</h2>\n<p>再你的 etc/nginx/conf.d/ 文件夹下创建一个文件，我的是 <code>etc/nginx/conf.d/blog.conf</code></p>\n<p>我的配置内容如下：</p>\n<p>值得注意的是：# 如果你的 ssl on 爆红或者你的 nginx 是 1.15.x 以上版本的话</p>\n<p>得将 <code>listen 443</code>  和 <code>ssl on</code>  改成 <code>listen 443 ssl </code></p>\n<figure class=\"highlight nginx\"><figcaption data-lang=\"nginx\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">server</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">listen</span> <span class=\"token number\">443</span> ssl</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\"># 如果你的 ssl on 爆红或者你的 nginx 是 1.15 以上版本的话，</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">server_name</span> blog.dabing.cool</span><span class=\"token punctuation\">;</span>     <span class=\"token comment\"># 填写绑定证书的域名</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">ssl_certificate</span> /etc/nginx/cert/blog.dabing.cool.crt</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">ssl_certificate_key</span> /etc/nginx/cert/blog.dabing.cool.key</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">ssl_session_timeout</span> <span class=\"token number\">5m</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">ssl_protocols</span> TLSv1 TLSv1.1 TLSv1.2</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\"># 按照这个协议配置</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">ssl_ciphers</span> ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE</span><span class=\"token punctuation\">;</span>     <span class=\"token comment\"># 按照这个套件配置</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">ssl_prefer_server_ciphers</span> <span class=\"token boolean\">on</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">location</span> /</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">root</span> /var/www/hexo</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\"># 站点目录</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token directive\"><span class=\"token keyword\">index</span>  index.html index.htm</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token directive\"><span class=\"token keyword\">server</span></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">listen</span>       <span class=\"token number\">80</span> default_server</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">listen</span>       [::]:80 default_server</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">server_name</span>  xxx.xx.xxx.xx</span><span class=\"token punctuation\">;</span> <span class=\"token comment\"># 这里可以填你的主机 ip</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">root</span>         /var/www/hexo</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token directive\"><span class=\"token keyword\">rewrite</span> ^(.*) https://blog.dabing.cool</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\"># 添加的语句</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>然后重启 nginx 即可：</p>\n<p><code>systemctl restart nginx.service</code>  重启</p>\n<p>如果你遇到类似这样的错误：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>Job <span class=\"token keyword\">for</span> nginx.service failed because the control process exited with error code. See <span class=\"token string\">\"systemctl status nginx.service\"</span> and <span class=\"token string\">\"journalctl -xe\"</span> <span class=\"token keyword\">for</span> details.</pre></td></tr></table></figure><p>有可能是你的 80 端口或者 443 端口被占用着，命令查看一下</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">ps</span> -ef<span class=\"token operator\">|</span><span class=\"token function\">grep</span> nginx</pre></td></tr></table></figure><p>有就把进程杀掉，再重启即可。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">kill</span> <span class=\"token parameter variable\">-9</span> pid</pre></td></tr></table></figure><p>再访问看看：<a href=\"https://blog.dabing.cool/\">https://blog.dabing.cool/</a></p>\n<p><img data-src=\"http://image.dabing.cool/image/image-20220909100723165.png\" alt=\"image-20220909100723165\"></p>\n",
            "tags": [
                "Hexo",
                "ssl",
                "https"
            ]
        }
    ]
}