{
    "version": "https://jsonfeed.org/version/1",
    "title": "null â€¢ All posts by \"redis\" tag",
    "description": "æ¬¢è¿æ¥åˆ°å¤§å†°çš„ç¬”è®°ç©ºé—´~è¿™é‡Œä¸»è¦ä¼šè®°å½•ç¼–ç¨‹å­¦ä¹ ç¬”è®°ğŸŒ¸",
    "home_page_url": "https://blog.dabing.cool",
    "items": [
        {
            "id": "https://blog.dabing.cool/javamore/cache/redis%E5%AE%9E%E7%8E%B0%E6%89%8B%E6%9C%BA%E9%AA%8C%E8%AF%81%E7%A0%81%E6%A0%A1%E9%AA%8C/",
            "url": "https://blog.dabing.cool/javamore/cache/redis%E5%AE%9E%E7%8E%B0%E6%89%8B%E6%9C%BA%E9%AA%8C%E8%AF%81%E7%A0%81%E6%A0%A1%E9%AA%8C/",
            "title": "Rediså®ç°æ‰‹æœºéªŒè¯ç æ ¡éªŒ",
            "date_published": "2022-08-20T02:10:10.000Z",
            "content_html": "<h2 id=\"ç›®æ ‡-å®Œæˆä¸€ä¸ªæ‰‹æœºéªŒè¯ç åŠŸèƒ½\"><a class=\"markdownIt-Anchor\" href=\"#ç›®æ ‡-å®Œæˆä¸€ä¸ªæ‰‹æœºéªŒè¯ç åŠŸèƒ½\">#</a> ç›®æ ‡ - å®Œæˆä¸€ä¸ªæ‰‹æœºéªŒè¯ç åŠŸèƒ½</h2>\n<p><strong>è¦æ±‚ï¼š</strong><br>\n1ã€è¾“å…¥æ‰‹æœºå·ï¼Œç‚¹å‡»å‘é€åéšæœºç”Ÿæˆ 6 ä½æ•°å­—ç ï¼Œ2 åˆ†é’Ÿæœ‰æ•ˆ<br>\n 2ã€è¾“å…¥éªŒè¯ç ï¼Œç‚¹å‡»éªŒè¯ï¼Œè¿”å›æˆåŠŸæˆ–å¤±è´¥<br>\n 3ã€æ¯ä¸ªæ‰‹æœºå·æ¯å¤©åªèƒ½è¾“å…¥ 3 æ¬¡</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731164343801.png\" alt=\"image-20220731164343801\"></p>\n<p><strong>å®ç°ï¼š</strong></p>\n<h3 id=\"å‰ç«¯ä»£ç \"><a class=\"markdownIt-Anchor\" href=\"#å‰ç«¯ä»£ç \">#</a> å‰ç«¯ä»£ç ï¼š</h3>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span>@ page language<span class=\"token operator\">=</span><span class=\"token string\">\"java\"</span> contentType<span class=\"token operator\">=</span><span class=\"token string\">\"text/html; charset=UTF-8\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    pageEncoding<span class=\"token operator\">=</span><span class=\"token string\">\"UTF-8\"</span><span class=\"token operator\">%</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">DOCTYPE</span> html<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">&lt;</span>html<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token operator\">&lt;</span>head<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token operator\">&lt;</span>meta charset<span class=\"token operator\">=</span><span class=\"token string\">\"UTF-8\"</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token operator\">&lt;</span>title<span class=\"token operator\">></span>Insert title here<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>title<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token operator\">&lt;</span>script  src<span class=\"token operator\">=</span><span class=\"token string\">\"static/jquery/jquery-3.1.0.js\"</span> <span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token operator\">&lt;</span>link href<span class=\"token operator\">=</span><span class=\"token string\">\"static/bs/css/bootstrap.min.css\"</span> rel<span class=\"token operator\">=</span><span class=\"token string\">\"stylesheet\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token operator\">&lt;</span>script  src<span class=\"token operator\">=</span><span class=\"token string\">\"static/bs/js/bootstrap.min.js\"</span>   <span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>head<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token operator\">&lt;</span>body<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token operator\">&lt;</span>div <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"container\"</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t<span class=\"token operator\">&lt;</span>div <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"row\"</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t    <span class=\"token operator\">&lt;</span>div id<span class=\"token operator\">=</span><span class=\"token string\">\"alertdiv\"</span> <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"col-md-12\"</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t          <span class=\"token operator\">&lt;</span>form <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"navbar-form navbar-left\"</span> role<span class=\"token operator\">=</span><span class=\"token string\">\"search\"</span> id<span class=\"token operator\">=</span><span class=\"token string\">\"codeform\"</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t\t\t  <span class=\"token operator\">&lt;</span>div <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"form-group\"</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t\t\t    <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string\">\"text\"</span> <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"form-control\"</span> placeholder<span class=\"token operator\">=</span><span class=\"token string\">\"å¡«å†™æ‰‹æœºå·\"</span> name<span class=\"token operator\">=</span><span class=\"token string\">\"phone_no\"</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t\t\t    <span class=\"token operator\">&lt;</span>button type<span class=\"token operator\">=</span><span class=\"token string\">\"button\"</span> <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"btn btn-default\"</span> id<span class=\"token operator\">=</span><span class=\"token string\">\"sendCode\"</span><span class=\"token operator\">></span>å‘é€éªŒè¯ç <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>br<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t\t\t    <span class=\"token operator\">&lt;</span>font id<span class=\"token operator\">=</span><span class=\"token string\">\"countdown\"</span> color<span class=\"token operator\">=</span><span class=\"token string\">\"red\"</span> <span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>font<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\t\t\t    <span class=\"token operator\">&lt;</span>br<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t\t\t    <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string\">\"text\"</span> <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"form-control\"</span> placeholder<span class=\"token operator\">=</span><span class=\"token string\">\"å¡«å†™éªŒè¯ç \"</span> name<span class=\"token operator\">=</span><span class=\"token string\">\"verify_code\"</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t\t\t    <span class=\"token operator\">&lt;</span>button type<span class=\"token operator\">=</span><span class=\"token string\">\"button\"</span> <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"btn btn-default\"</span> id<span class=\"token operator\">=</span><span class=\"token string\">\"verifyCode\"</span><span class=\"token operator\">></span>ç¡®å®š<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t\t\t    <span class=\"token operator\">&lt;</span>font id<span class=\"token operator\">=</span><span class=\"token string\">\"result\"</span> color<span class=\"token operator\">=</span><span class=\"token string\">\"green\"</span> <span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>font<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>font id<span class=\"token operator\">=</span><span class=\"token string\">\"error\"</span> color<span class=\"token operator\">=</span><span class=\"token string\">\"red\"</span> <span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>font<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\t\t\t    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t\t\t    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>form<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>   <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>body<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token operator\">&lt;</span>script type<span class=\"token operator\">=</span><span class=\"token string\">\"text/javascript\"</span><span class=\"token operator\">></span> </pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token keyword\">var</span> t<span class=\"token operator\">=</span><span class=\"token number\">120</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// è®¾å®šå€’è®¡æ—¶çš„æ—¶é—´ </span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token keyword\">var</span> interval<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">refer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>  </pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#countdown\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è¯·äº\"</span><span class=\"token operator\">+</span>t<span class=\"token operator\">+</span><span class=\"token string\">\"ç§’å†…å¡«å†™éªŒè¯ç  \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// æ˜¾ç¤ºå€’è®¡æ—¶ </span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    t<span class=\"token operator\">--</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// è®¡æ•°å™¨é€’å‡ </span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>t<span class=\"token operator\">&lt;=</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    \t<span class=\"token function\">clearInterval</span><span class=\"token punctuation\">(</span>interval<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    \t<span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#countdown\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"éªŒè¯ç å·²å¤±æ•ˆï¼Œè¯·é‡æ–°å‘é€ï¼ \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token punctuation\">&#125;</span> </pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\t<span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#sendCode\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">click</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\t       </pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t\t   $<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"SendCodeServlet\"</span><span class=\"token punctuation\">,</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#codeform\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">serialize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>\t    \t <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>data<span class=\"token operator\">==</span><span class=\"token string\">\"true\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\t    \t\t t<span class=\"token operator\">=</span><span class=\"token number\">120</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>\t    \t\t <span class=\"token function\">clearInterval</span><span class=\"token punctuation\">(</span>interval<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>\t    \t\t interval<span class=\"token operator\">=</span> <span class=\"token function\">setInterval</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"refer()\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// å¯åŠ¨ 1 ç§’å®šæ—¶  </span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>\t   \t\t <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>data<span class=\"token operator\">==</span><span class=\"token string\">\"limit\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>\t   \t\t\t<span class=\"token function\">clearInterval</span><span class=\"token punctuation\">(</span>interval<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>\t   \t\t\t<span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#countdown\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å•æ—¥å‘é€è¶…è¿‡æ¬¡æ•°ï¼ \"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>\t   \t\t <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>\t\t  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   </pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"60\"></td><td><pre>\t<span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#verifyCode\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">click</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>\t    </pre></td></tr><tr><td data-num=\"62\"></td><td><pre>\t\t   $<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"CheckCodeServlet\"</span><span class=\"token punctuation\">,</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#codeform\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">serialize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>\t    \t <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>data<span class=\"token operator\">==</span><span class=\"token string\">\"true\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>\t    \t\t <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#result\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"color\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"green\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>\t    \t\t <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#result\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"éªŒè¯æˆåŠŸ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>\t    \t\t <span class=\"token function\">clearInterval</span><span class=\"token punctuation\">(</span>interval<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>\t    \t\t <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#countdown\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>\t   \t\t <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>\t    \t\t <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#result\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"color\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"red\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>\t    \t\t <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#result\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"éªŒè¯å¤±è´¥\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>\t   \t\t <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>\t\t  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   </pre></td></tr><tr><td data-num=\"73\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"75\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"76\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>html<span class=\"token operator\">></span></pre></td></tr></table></figure><h3 id=\"åç«¯ä»£ç \"><a class=\"markdownIt-Anchor\" href=\"#åç«¯ä»£ç \">#</a> åç«¯ä»£ç ï¼š</h3>\n<ol>\n<li>ç‚¹å‡»å‘é€éªŒè¯ç æ—¶ï¼š</li>\n</ol>\n<p>å°†æ•°æ®å­˜å…¥ redis ä¸­</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>dabing<span class=\"token punctuation\">.</span>redis<span class=\"token punctuation\">.</span>servlet</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">redis<span class=\"token punctuation\">.</span>clients<span class=\"token punctuation\">.</span>jedis<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Jedis</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ServletException</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">WebServlet</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HttpServlet</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HttpServletRequest</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HttpServletResponse</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOException</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Duration</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">LocalTime</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Random</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">// å¤„ç†å‘é€éªŒè¯ç çš„ Servlet</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token annotation punctuation\">@WebServlet</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/SendCodeServlet\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SendCodeServlet</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">HttpServlet</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doPost</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ServletException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token class-name\">String</span> phoneNo <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">getParameter</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"phone_no\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>phoneNo<span class=\"token operator\">==</span><span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>phoneNo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token class-name\">Jedis</span> jedis <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Jedis</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"xxx.xxx.xx.xx\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">6379</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token class-name\">String</span> countKey<span class=\"token operator\">=</span>phoneNo<span class=\"token operator\">+</span><span class=\"token string\">\":count\"</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// ç”ŸæˆéªŒè¯ç çš„æ¬¡æ•° key</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token class-name\">String</span> codeKey<span class=\"token operator\">=</span>phoneNo<span class=\"token operator\">+</span><span class=\"token string\">\":code\"</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// æ‰‹æœºéªŒè¯ç  key</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token class-name\">String</span> count <span class=\"token operator\">=</span> jedis<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>countKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token class-name\">String</span> code<span class=\"token operator\">=</span><span class=\"token function\">getCode</span><span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"code=\"</span><span class=\"token operator\">+</span>code<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>count<span class=\"token operator\">==</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token comment\">// è¯æ˜æ²¡æœ‰å‘é€è¿‡éªŒè¯ç </span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token comment\">// ä¿å­˜éªŒè¯ç åˆ° redisï¼Œè¿‡æœŸæ—¶é—´ 120 ç§’</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            jedis<span class=\"token punctuation\">.</span><span class=\"token function\">setex</span><span class=\"token punctuation\">(</span>codeKey<span class=\"token punctuation\">,</span><span class=\"token number\">120</span><span class=\"token punctuation\">,</span>code<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token comment\">// è®¾ç½®è¿‡æœŸæ—¶é—´ä¸ºä»Šå¤©çš„å‰©ä½™æ—¶é—´</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            jedis<span class=\"token punctuation\">.</span><span class=\"token function\">setex</span><span class=\"token punctuation\">(</span>countKey<span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span><span class=\"token function\">getTheLeftSeconds</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            response<span class=\"token punctuation\">.</span><span class=\"token function\">getWriter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"true\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"3\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            <span class=\"token comment\">// è¯æ˜å·²ç»å‘é€è¿‡ 3 æ¬¡äº†</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            response<span class=\"token punctuation\">.</span><span class=\"token function\">getWriter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"limit\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// è¿”å›ä¸è®©å‘äº†</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token comment\">// è¯æ˜å·²ç»å‘è¿‡ï¼Œä½†æ˜¯æ¬¡æ•°æ²¡è¾¾åˆ° 3 æ¬¡</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            jedis<span class=\"token punctuation\">.</span><span class=\"token function\">setex</span><span class=\"token punctuation\">(</span>codeKey<span class=\"token punctuation\">,</span><span class=\"token number\">120</span><span class=\"token punctuation\">,</span>code<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            jedis<span class=\"token punctuation\">.</span><span class=\"token function\">incr</span><span class=\"token punctuation\">(</span>countKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// æ¬¡æ•°åŠ  1</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            response<span class=\"token punctuation\">.</span><span class=\"token function\">getWriter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"true\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        jedis<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doGet</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ServletException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token function\">doPost</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span>response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    <span class=\"token comment\">// éšæœºç”ŸæˆéªŒè¯ç çš„æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getCode</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> len<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token class-name\">String</span> code <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> len<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>            <span class=\"token keyword\">int</span> rand <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">nextInt</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>            code <span class=\"token operator\">+=</span> rand<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>        <span class=\"token keyword\">return</span> code<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>    <span class=\"token comment\">// è·å–å½“å¤©å‰©ä½™ç§’æ•°çš„æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">long</span> <span class=\"token function\">getTheLeftSeconds</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>        <span class=\"token comment\">// è·å–ç°åœ¨çš„æ—¶é—´</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>        <span class=\"token class-name\">LocalTime</span> now <span class=\"token operator\">=</span> <span class=\"token class-name\">LocalTime</span><span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>        <span class=\"token comment\">// è·å–å½“æ—¥ 23 ç‚¹ 59 åˆ† 59 ç§’çš„æ—¶é—´</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>        <span class=\"token class-name\">LocalTime</span> end <span class=\"token operator\">=</span> <span class=\"token class-name\">LocalTime</span><span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span><span class=\"token number\">23</span><span class=\"token punctuation\">,</span> <span class=\"token number\">59</span><span class=\"token punctuation\">,</span> <span class=\"token number\">59</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>        <span class=\"token comment\">// è·å– end ä¸ now ç›¸å·®çš„ç§’æ•°</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>        <span class=\"token keyword\">long</span> millis <span class=\"token operator\">=</span> <span class=\"token class-name\">Duration</span><span class=\"token punctuation\">.</span><span class=\"token function\">between</span><span class=\"token punctuation\">(</span>now<span class=\"token punctuation\">,</span> end<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">/</span><span class=\"token number\">1000</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>        <span class=\"token keyword\">return</span> millis<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ol start=\"2\">\n<li>è¾“å…¥éªŒè¯ç æ ¡éªŒæ—¶</li>\n</ol>\n<p>ä» redis ä¸­å–å‡ºå¯¹æ¯”</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>dabing<span class=\"token punctuation\">.</span>redis<span class=\"token punctuation\">.</span>servlet</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">redis<span class=\"token punctuation\">.</span>clients<span class=\"token punctuation\">.</span>jedis<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Jedis</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ServletException</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">WebServlet</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HttpServlet</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HttpServletRequest</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HttpServletResponse</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOException</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">// å¤„ç†éªŒè¯éªŒè¯ç è¯·æ±‚çš„ Servlet</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token annotation punctuation\">@WebServlet</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/CheckCodeServlet\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CheckCodeServlet</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">HttpServlet</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doPost</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ServletException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token class-name\">String</span> code<span class=\"token operator\">=</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">getParameter</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"verify_code\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token class-name\">String</span> phoneNo<span class=\"token operator\">=</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">getParameter</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"phone_no\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>code<span class=\"token operator\">==</span><span class=\"token keyword\">null</span><span class=\"token operator\">||</span>phoneNo<span class=\"token operator\">==</span><span class=\"token keyword\">null</span><span class=\"token operator\">||</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>code<span class=\"token punctuation\">)</span><span class=\"token operator\">||</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>phoneNo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token class-name\">Jedis</span> jedis <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Jedis</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"xxx.xx.xxx.xx\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">6379</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">String</span> codeKey<span class=\"token operator\">=</span>phoneNo <span class=\"token operator\">+</span> <span class=\"token string\">\":code\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token class-name\">String</span> codeRedis <span class=\"token operator\">=</span> jedis<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>codeKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>code<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>codeRedis<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            jedis<span class=\"token punctuation\">.</span><span class=\"token function\">del</span><span class=\"token punctuation\">(</span>codeKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            response<span class=\"token punctuation\">.</span><span class=\"token function\">getWriter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"true\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        jedis<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doGet</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ServletException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token function\">doPost</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span>response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure>",
            "tags": [
                "Redis"
            ]
        },
        {
            "id": "https://blog.dabing.cool/javamore/cache/%E4%BD%BF%E7%94%A8Jedis%E8%BF%9E%E6%8E%A5%E6%9C%8D%E5%8A%A1%E5%99%A8Redis/",
            "url": "https://blog.dabing.cool/javamore/cache/%E4%BD%BF%E7%94%A8Jedis%E8%BF%9E%E6%8E%A5%E6%9C%8D%E5%8A%A1%E5%99%A8Redis/",
            "title": "ç”¨Jedisè¿æ¥Redis",
            "date_published": "2022-08-20T02:10:10.000Z",
            "content_html": "<p>ğŸš¨ğŸš¨å…ˆè¯´æ˜ï¼Œåšä¸‹é¢æ“ä½œï¼Œå¦‚æœæ˜¯æœåŠ¡å™¨çš„è¯ï¼Œä¿®æ”¹ç«¯å£ 6379 ä¸ºå…¬å¼€ã€ä¸è®¾ç½® redis å¯†ç è¿™äº›æ“ä½œéƒ½æ˜¯å¾ˆå±é™©çš„ï¼ï¼ï¼ä¸€å®šè¦è®¾ç½®å¯†ç ï¼Œå¯ä»¥æ”¹ç«¯å£å·ï¼Œåªè¦ä¸æ˜¯ 6379 éƒ½è¡Œï¼Œç„¶åä¹Ÿä¸è¦å…¬å¼€ï¼Œå°±è®¾ç½®è‡ªå·±æœ¬æœºçš„ ip å³å¯ï¼Œæˆ‘ä¸‹é¢æ²¡æœ‰åšæ›´æ”¹ã€‚</p>\n<p>è¡€çš„æ•™è®­ï¼Œæˆ‘å°±è¢«æ”»å‡»äº†ï¼Œå¯å‚è€ƒï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NpbmRlcmVsbGFfX18vYXJ0aWNsZS9kZXRhaWxzLzgwMzkxNTYz\"> æŒ–çŸ¿ï¼Ÿå…¥ä¾µï¼Ÿæœ¨é©¬ï¼Ÿéƒ½æ˜¯ redis æ²¡è®¾å¯†ç æçš„é¬¼</span></p>\n<h2 id=\"1-jedisæ‰€éœ€è¦çš„jaråŒ…\"><a class=\"markdownIt-Anchor\" href=\"#1-jedisæ‰€éœ€è¦çš„jaråŒ…\">#</a> 1 - Jedis æ‰€éœ€è¦çš„ jar åŒ…</h2>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>redis.clients<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>jedis<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>3.2.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h2 id=\"2-è¿æ¥redisæ³¨æ„äº‹é¡¹\"><a class=\"markdownIt-Anchor\" href=\"#2-è¿æ¥redisæ³¨æ„äº‹é¡¹\">#</a> 2 - è¿æ¥ Redis æ³¨æ„äº‹é¡¹</h2>\n<p>ç¦ç”¨ Linux çš„é˜²ç«å¢™ï¼šLinux (CentOS7) é‡Œæ‰§è¡Œå‘½ä»¤</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>æŸ¥çœ‹çŠ¶æ€ï¼š systemctl status firewalld</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>å…³é—­ï¼š systemctl stop firewalld</pre></td></tr></table></figure><p>redis.conf ä¸­æ³¨é‡Šæ‰ bind 127.0.0.1 , ç„¶å protected-mode no</p>\n<h2 id=\"3-jedisè¿æ¥æµ‹è¯•\"><a class=\"markdownIt-Anchor\" href=\"#3-jedisè¿æ¥æµ‹è¯•\">#</a> 3 - Jedis è¿æ¥æµ‹è¯•</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>dabing<span class=\"token punctuation\">.</span>jedis</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>junit<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Test</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">redis<span class=\"token punctuation\">.</span>clients<span class=\"token punctuation\">.</span>jedis<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Jedis</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Demo01</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>     * æµ‹è¯•è¿æ¥ Redis æœåŠ¡</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>     * èƒ½è¿æ¥ä¸Šçš„å‰æï¼š</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>     * 1. å…³é—­ linux çš„é˜²ç«å¢™</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>     * 2. ä¿®æ”¹ Redis çš„é…ç½®æ–‡ä»¶</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>     *      2.1 å°† bind 127.0.0.1 æ³¨é‡Šæ‰</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>     *      2.2 å°†ä¿æŠ¤æ¨¡å¼å…³é—­ï¼Œå³ protected-mode çš„å€¼è®¾ç½®ä¸º no</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">connectionTest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token class-name\">Jedis</span> jedis <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Jedis</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"192.168.22.3\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">6379</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// è¿™ä¸ªä¸»æœºæˆ‘çå†™çš„ï¼Œå†™è‡ªå·±çš„</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token class-name\">String</span> pong <span class=\"token operator\">=</span> jedis<span class=\"token punctuation\">.</span><span class=\"token function\">ping</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è¿æ¥æˆåŠŸï¼š\"</span><span class=\"token operator\">+</span>pong<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        jedis<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"4-æµ‹è¯•ç›¸å…³æ•°æ®ç±»å‹\"><a class=\"markdownIt-Anchor\" href=\"#4-æµ‹è¯•ç›¸å…³æ•°æ®ç±»å‹\">#</a> 4 - æµ‹è¯•ç›¸å…³æ•°æ®ç±»å‹</h2>\n<h3 id=\"741jedis-api-key\"><a class=\"markdownIt-Anchor\" href=\"#741jedis-api-key\">#</a> 7.4.1.\tJedis-API:    Key</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"k1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"v1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"k2\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"v2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"k3\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"v3\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> keys <span class=\"token operator\">=</span> jedis<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"*\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>keys<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> key <span class=\"token operator\">:</span> keys<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">exists</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"k1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">ttl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"k1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                </pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"k1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"742jedis-api-string\"><a class=\"markdownIt-Anchor\" href=\"#742jedis-api-string\">#</a> 7.4.2.\tJedis-API:    String</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">mset</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"str1\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"v1\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"str2\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"v2\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"str3\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"v3\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">mget</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"str1\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"str2\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"str3\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"743jedis-api-list\"><a class=\"markdownIt-Anchor\" href=\"#743jedis-api-list\">#</a> 7.4.3.\tJedis-API:    List</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> list <span class=\"token operator\">=</span> jedis<span class=\"token punctuation\">.</span><span class=\"token function\">lrange</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mylist\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> element <span class=\"token operator\">:</span> list<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"744jedis-api-set\"><a class=\"markdownIt-Anchor\" href=\"#744jedis-api-set\">#</a> 7.4.4.\tJedis-API:    set</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">sadd</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"orders\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"order01\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">sadd</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"orders\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"order02\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">sadd</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"orders\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"order03\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">sadd</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"orders\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"order04\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> smembers <span class=\"token operator\">=</span> jedis<span class=\"token punctuation\">.</span><span class=\"token function\">smembers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"orders\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> order <span class=\"token operator\">:</span> smembers<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>order<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">srem</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"orders\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"order02\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"745jedis-api-hash\"><a class=\"markdownIt-Anchor\" href=\"#745jedis-api-hash\">#</a> 7.4.5.\tJedis-API:    hash</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">hset</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hash1\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"userName\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"lisi\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">hget</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hash1\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"userName\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> map <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>map<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"telphone\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"13810169999\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>map<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"address\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"atguigu\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>map<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"email\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"abc@163.com\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">hmset</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hash2\"</span><span class=\"token punctuation\">,</span>map<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> result <span class=\"token operator\">=</span> jedis<span class=\"token punctuation\">.</span><span class=\"token function\">hmget</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hash2\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"telphone\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"email\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> element <span class=\"token operator\">:</span> result<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>7.4.6.\tJedis-API:    zset</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">zadd</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"zset01\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100d</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"z3\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">zadd</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"zset01\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">90d</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"l4\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">zadd</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"zset01\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">80d</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"w5\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">zadd</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"zset01\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">70d</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"z6\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> zrange <span class=\"token operator\">=</span> jedis<span class=\"token punctuation\">.</span><span class=\"token function\">zrange</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"zset01\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> e <span class=\"token operator\">:</span> zrange<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"5-æˆ‘æ»´å®æ“\"><a class=\"markdownIt-Anchor\" href=\"#5-æˆ‘æ»´å®æ“\">#</a> 5- æˆ‘æ»´å®æ“</h2>\n<ol>\n<li>å†™ test è·Ÿä¸Šè¾¹çš„ä¸€æ ·ï¼Œå‘ï¼Œè¿æ¥è¶…æ—¶</li>\n</ol>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220821201445710.png\" alt=\"image-20220821201445710\"></p>\n<ol start=\"2\">\n<li>å…³é˜²ç«å¢™ã€æ”¹ä¿æŠ¤æ¨¡å¼ä¸º noã€æ³¨é‡Šæ‰ bind 127.0.0.1</li>\n</ol>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">1</span>ã€firewalldçš„åŸºæœ¬ä½¿ç”¨</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>å¯åŠ¨ï¼š systemctl start firewalld</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>å…³é—­ï¼š systemctl stop firewalld</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>æŸ¥çœ‹çŠ¶æ€ï¼š systemctl status firewalld</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>å¼€æœºç¦ç”¨ ï¼š systemctl disable firewalld</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>å¼€æœºå¯ç”¨ ï¼š systemctl <span class=\"token builtin class-name\">enable</span> firewalld</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">2</span>. <span class=\"token function\">vi</span> redis.conf </pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">3</span>. å¯åŠ¨redis-server</pre></td></tr></table></figure><p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220821191948636.png\" alt=\"image-20220821191948636\"></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220821192558716.png\" alt=\"image-20220821192558716\"></p>\n<p>æ³¨ï¼šæˆ‘è¿™é‡Œå®Œæˆäº†ä»¥ä¸Šä¸¤æ­¥ä¹‹åï¼Œè¿˜æ˜¯æ²¡æœ‰è¿æ¥æˆåŠŸï¼Œç™¾åº¦ä¹‹åå‘ç°åŸæ¥æ˜¯ç”±äºæˆ‘è¿æ¥çš„æ˜¯æœåŠ¡å™¨ï¼Œæ²¡æœ‰æ·»åŠ  6379 ç«¯å£çš„å®‰å…¨ç»„ã€‚</p>\n<p>å¯å‚è€ƒï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzg3ODMzMi9hcnRpY2xlL2RldGFpbHMvMTA4NzQxMzY3\">Java ä½¿ç”¨ Jedis åœ¨æœ¬åœ°è¿œç¨‹è¿æ¥è…¾è®¯äº‘æœåŠ¡å™¨ï¼ˆCentOS 7ï¼‰</span></p>\n<p>ä½†æ˜¯æˆ‘çš„æ˜¯è½»é‡çº§æœåŠ¡å™¨ï¼Œçœ‹æ„æ€å°±æ˜¯é˜²ç«å¢™è®¾ç½®äº†ï¼š</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220821195819961.png\" alt=\"image-20220821195819961\"></p>\n<p>å†æ¥æµ‹è¯•ä¸€æ¬¡ï¼šæˆåŠŸï¼</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220821202013924.png\" alt=\"image-20220821202013924\"></p>\n<p>æ¥ä¸‹æ¥å°±æ˜¯æµ‹è¯•é‚£äº›æ•°æ®äº†ã€‚è·Ÿä¸Šè¾¹çš„æ¥å°±è¡Œã€‚</p>\n",
            "tags": [
                "Redis",
                "Jedis"
            ]
        },
        {
            "id": "https://blog.dabing.cool/javamore/cache/Redis/",
            "url": "https://blog.dabing.cool/javamore/cache/Redis/",
            "title": "Redis",
            "date_published": "2022-07-01T02:00:00.000Z",
            "content_html": "<p>å®˜ç½‘é“¾æ¥ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5yZWRpcy5pbw==\">http://www.redis.io</span></p>\n<p>è§†é¢‘ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMVJ2NDExNzdBZj9zcG1faWRfZnJvbT0zMzMuOTk5LjAuMCZhbXA7dmRfc291cmNlPTEzOWU4MTY4ZDFhZWJiYTg3NGI4MDQ4OTEwMDY2ZDMx\">Redis 6 å°šç¡…è°·</span></p>\n<h1 id=\"ä¸€-nosqlæ•°æ®åº“ç®€ä»‹\"><a class=\"markdownIt-Anchor\" href=\"#ä¸€-nosqlæ•°æ®åº“ç®€ä»‹\">#</a> ä¸€ã€NoSQL æ•°æ®åº“ç®€ä»‹</h1>\n<h2 id=\"1-æŠ€æœ¯å‘å±•\"><a class=\"markdownIt-Anchor\" href=\"#1-æŠ€æœ¯å‘å±•\">#</a> 1- æŠ€æœ¯å‘å±•</h2>\n<p>æŠ€æœ¯çš„åˆ†ç±»</p>\n<blockquote>\n<p>1ã€è§£å†³åŠŸèƒ½æ€§çš„é—®é¢˜ï¼šJavaã€Jspã€RDBMSã€Tomcatã€HTMLã€Linuxã€JDBCã€SVN<br>\n2ã€è§£å†³æ‰©å±•æ€§çš„é—®é¢˜ï¼šStrutsã€Springã€SpringMVCã€Hibernateã€Mybatis<br>\n3ã€è§£å†³æ€§èƒ½çš„é—®é¢˜ï¼šNoSQLã€Java çº¿ç¨‹ã€Hadoopã€Nginxã€MQã€ElasticSearch</p>\n</blockquote>\n<h3 id=\"111web10æ—¶ä»£\"><a class=\"markdownIt-Anchor\" href=\"#111web10æ—¶ä»£\">#</a> 1.1.1.\tWeb1.0 æ—¶ä»£</h3>\n<p>Web1.0 çš„æ—¶ä»£ï¼Œæ•°æ®è®¿é—®é‡å¾ˆæœ‰é™ï¼Œç”¨ä¸€å¤«å½“å…³çš„é«˜æ€§èƒ½çš„å•ç‚¹æœåŠ¡å™¨å¯ä»¥è§£å†³å¤§éƒ¨åˆ†é—®é¢˜ã€‚</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220726231113112.png\" alt=\"image-20220726231113112\"></p>\n<h3 id=\"112web20æ—¶ä»£\"><a class=\"markdownIt-Anchor\" href=\"#112web20æ—¶ä»£\">#</a> 1.1.2.\tWeb2.0 æ—¶ä»£</h3>\n<p>éšç€ Web2.0 çš„æ—¶ä»£çš„åˆ°æ¥ï¼Œç”¨æˆ·è®¿é—®é‡å¤§å¹…åº¦æå‡ï¼ŒåŒæ—¶äº§ç”Ÿäº†å¤§é‡çš„ç”¨æˆ·æ•°æ®ã€‚åŠ ä¸Šåæ¥çš„æ™ºèƒ½ç§»åŠ¨è®¾å¤‡çš„æ™®åŠï¼Œæ‰€æœ‰çš„äº’è”ç½‘å¹³å°éƒ½é¢ä¸´äº†å·¨å¤§çš„æ€§èƒ½æŒ‘æˆ˜ã€‚</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220726231129462.png\" alt=\"image-20220726231129462\"></p>\n<h3 id=\"113è§£å†³cpuåŠå†…å­˜å‹åŠ›\"><a class=\"markdownIt-Anchor\" href=\"#113è§£å†³cpuåŠå†…å­˜å‹åŠ›\">#</a> 1.1.3.\tè§£å†³ CPU åŠå†…å­˜å‹åŠ›</h3>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220726231204844.png\" alt=\"image-20220726231204844\"></p>\n<h3 id=\"114è§£å†³ioå‹åŠ›\"><a class=\"markdownIt-Anchor\" href=\"#114è§£å†³ioå‹åŠ›\">#</a> 1.1.4.\tè§£å†³ IO å‹åŠ›</h3>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220726231220567.png\" alt=\"image-20220726231220567\"></p>\n<h2 id=\"2-nosqlæ•°æ®åº“\"><a class=\"markdownIt-Anchor\" href=\"#2-nosqlæ•°æ®åº“\">#</a> 2 - NoSQL æ•°æ®åº“</h2>\n<h3 id=\"121nosqlæ•°æ®åº“æ¦‚è¿°\"><a class=\"markdownIt-Anchor\" href=\"#121nosqlæ•°æ®åº“æ¦‚è¿°\">#</a> 1.2.1.\tNoSQL æ•°æ®åº“æ¦‚è¿°</h3>\n<p><strong>NoSQL(NoSQL = Not Only SQL )</strong>ï¼Œæ„å³ â€œä¸ä»…ä»…æ˜¯ SQLâ€ï¼Œæ³›æŒ‡ <code>éå…³ç³»å‹</code> çš„æ•°æ®åº“ã€‚<br>\nNoSQL ä¸ä¾èµ–ä¸šåŠ¡é€»è¾‘æ–¹å¼å­˜å‚¨ï¼Œè€Œä»¥ç®€å•çš„ <code>key-value</code>  æ¨¡å¼å­˜å‚¨ã€‚å› æ­¤å¤§å¤§çš„å¢åŠ äº†æ•°æ®åº“çš„æ‰©å±•èƒ½åŠ›ã€‚</p>\n<ul>\n<li>ä¸éµå¾ª SQL æ ‡å‡†ã€‚</li>\n<li>ä¸æ”¯æŒ ACIDã€‚</li>\n<li>è¿œè¶…äº SQL çš„æ€§èƒ½ã€‚</li>\n</ul>\n<h3 id=\"122nosqlé€‚ç”¨åœºæ™¯\"><a class=\"markdownIt-Anchor\" href=\"#122nosqlé€‚ç”¨åœºæ™¯\">#</a> 1.2.2.\tNoSQL é€‚ç”¨åœºæ™¯</h3>\n<ul>\n<li>å¯¹æ•°æ®é«˜å¹¶å‘çš„è¯»å†™</li>\n<li>æµ·é‡æ•°æ®çš„è¯»å†™</li>\n<li>å¯¹æ•°æ®é«˜å¯æ‰©å±•æ€§çš„</li>\n</ul>\n<h3 id=\"123nosqlä¸é€‚ç”¨åœºæ™¯\"><a class=\"markdownIt-Anchor\" href=\"#123nosqlä¸é€‚ç”¨åœºæ™¯\">#</a> 1.2.3.\tNoSQL ä¸é€‚ç”¨åœºæ™¯</h3>\n<ul>\n<li>\n<p>éœ€è¦äº‹åŠ¡æ”¯æŒ</p>\n</li>\n<li>\n<p>åŸºäº sql çš„ç»“æ„åŒ–æŸ¥è¯¢å­˜å‚¨ï¼Œå¤„ç†å¤æ‚çš„å…³ç³»ï¼Œéœ€è¦ <code>å³å¸­</code>  æŸ¥è¯¢ã€‚</p>\n</li>\n<li>\n<p><strong>ï¼ˆç”¨ä¸ç€ sql çš„å’Œç”¨äº† sql ä¹Ÿä¸è¡Œçš„æƒ…å†µï¼Œè¯·è€ƒè™‘ç”¨ NoSqlï¼‰</strong></p>\n</li>\n</ul>\n<h3 id=\"124memcache\"><a class=\"markdownIt-Anchor\" href=\"#124memcache\">#</a> 1.2.4.\tMemcache</h3>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220726231803375.png\" alt=\"image-20220726231803375\"></p>\n<h3 id=\"125redis\"><a class=\"markdownIt-Anchor\" href=\"#125redis\">#</a> 1.2.5.\tRedis</h3>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220726231821129.png\" alt=\"image-20220726231821129\"></p>\n<h3 id=\"126mongodb\"><a class=\"markdownIt-Anchor\" href=\"#126mongodb\">#</a> 1.2.6.\tMongoDB</h3>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220726231850038.png\" alt=\"image-20220726231850038\"></p>\n<h2 id=\"3-è¡Œå¼å­˜å‚¨æ•°æ®åº“å¤§æ•°æ®æ—¶ä»£\"><a class=\"markdownIt-Anchor\" href=\"#3-è¡Œå¼å­˜å‚¨æ•°æ®åº“å¤§æ•°æ®æ—¶ä»£\">#</a> 3 - è¡Œå¼å­˜å‚¨æ•°æ®åº“ï¼ˆå¤§æ•°æ®æ—¶ä»£ï¼‰</h2>\n<h3 id=\"131è¡Œå¼æ•°æ®åº“\"><a class=\"markdownIt-Anchor\" href=\"#131è¡Œå¼æ•°æ®åº“\">#</a> 1.3.1.\tè¡Œå¼æ•°æ®åº“</h3>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220726232027994.png\" alt=\"image-20220726232027994\"></p>\n<h3 id=\"132åˆ—å¼æ•°æ®åº“\"><a class=\"markdownIt-Anchor\" href=\"#132åˆ—å¼æ•°æ®åº“\">#</a> 1.3.2.\tåˆ—å¼æ•°æ®åº“</h3>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220726232035860.png\" alt=\"image-20220726232035860\"></p>\n<p><strong>1.3.2.1.\tHbase</strong></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220726232045024.png\" alt=\"image-20220726232045024\"></p>\n<p>HBase æ˜¯<strong> Hadoop</strong> é¡¹ç›®ä¸­çš„æ•°æ®åº“ã€‚å®ƒç”¨äºéœ€è¦å¯¹å¤§é‡çš„æ•°æ®è¿›è¡Œéšæœºã€å®æ—¶çš„è¯»å†™æ“ä½œçš„åœºæ™¯ä¸­ã€‚<br>\nHBase çš„ç›®æ ‡å°±æ˜¯å¤„ç†æ•°æ®é‡<strong>éå¸¸åºå¤§</strong>çš„è¡¨ï¼Œå¯ä»¥ç”¨<strong>æ™®é€šçš„è®¡ç®—æœº</strong>å¤„ç†è¶…è¿‡<strong> 10 äº¿è¡Œæ•°æ®</strong>ï¼Œè¿˜å¯å¤„ç†æœ‰æ•°ç™¾ä¸‡<strong>åˆ—</strong>å…ƒç´ çš„æ•°æ®è¡¨ã€‚</p>\n<p><strong>1.3.2.2.\tCassandra[kÉ™ËˆsÃ¦ndrÉ™]</strong></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220727003413693.png\" alt=\"image-20220727003413693\"></p>\n<p>Apache Cassandra æ˜¯ä¸€æ¬¾å…è´¹çš„å¼€æº NoSQL æ•°æ®åº“ï¼Œå…¶è®¾è®¡ç›®çš„åœ¨äºç®¡ç†ç”±å¤§é‡å•†ç”¨æœåŠ¡å™¨æ„å»ºèµ·æ¥çš„åºå¤§é›†ç¾¤ä¸Šçš„<strong>æµ·é‡æ•°æ®é›† (æ•°æ®é‡é€šå¸¸è¾¾åˆ° PB çº§åˆ«)</strong>ã€‚åœ¨ä¼—å¤šæ˜¾è‘—ç‰¹æ€§å½“ä¸­ï¼ŒCassandra æœ€ä¸ºå“è¶Šçš„é•¿å¤„æ˜¯å¯¹å†™å…¥åŠè¯»å–æ“ä½œè¿›è¡Œè§„æ¨¡è°ƒæ•´ï¼Œè€Œä¸”å…¶ä¸å¼ºè°ƒä¸»é›†ç¾¤çš„è®¾è®¡æ€è·¯èƒ½å¤Ÿä»¥ç›¸å¯¹ç›´è§‚çš„æ–¹å¼ç®€åŒ–å„é›†ç¾¤çš„åˆ›å»ºä¸æ‰©å±•æµç¨‹ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>è®¡ç®—æœºå­˜å‚¨å•ä½ è®¡ç®—æœºå­˜å‚¨å•ä½ä¸€èˆ¬ç”¨<span class=\"token class-name\">B</span>ï¼Œ<span class=\"token constant\">KB</span>ï¼Œ<span class=\"token constant\">MB</span>ï¼Œ<span class=\"token constant\">GB</span>ï¼Œ<span class=\"token constant\">TB</span>ï¼Œ<span class=\"token constant\">EB</span>ï¼Œ<span class=\"token constant\">ZB</span>ï¼Œ<span class=\"token constant\">YB</span>ï¼Œ<span class=\"token constant\">BB</span>æ¥è¡¨ç¤ºï¼Œå®ƒä»¬ä¹‹é—´çš„å…³ç³»æ˜¯ï¼š</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>ä½ bit <span class=\"token punctuation\">(</span>æ¯”ç‰¹<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Binary</span> <span class=\"token class-name\">Digits</span><span class=\"token punctuation\">)</span>ï¼šå­˜æ”¾ä¸€ä½äºŒè¿›åˆ¶æ•°ï¼Œå³ <span class=\"token number\">0</span> æˆ– <span class=\"token number\">1</span>ï¼Œæœ€å°çš„å­˜å‚¨å•ä½ã€‚</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>å­—èŠ‚ <span class=\"token keyword\">byte</span>ï¼š<span class=\"token number\">8</span>ä¸ªäºŒè¿›åˆ¶ä½ä¸ºä¸€ä¸ªå­—èŠ‚<span class=\"token punctuation\">(</span><span class=\"token class-name\">B</span><span class=\"token punctuation\">)</span>ï¼Œæœ€å¸¸ç”¨çš„å•ä½ã€‚</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">1</span><span class=\"token constant\">KB</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Kilobyte</span> åƒå­—èŠ‚<span class=\"token punctuation\">)</span><span class=\"token operator\">=</span><span class=\"token number\">1024</span>Bï¼Œ</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">1</span><span class=\"token constant\">MB</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Megabyte</span> å…†å­—èŠ‚ ç®€ç§°â€œå…†â€<span class=\"token punctuation\">)</span><span class=\"token operator\">=</span><span class=\"token number\">1024</span><span class=\"token constant\">KB</span>ï¼Œ</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">1</span><span class=\"token constant\">GB</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Gigabyte</span> å‰å­—èŠ‚ åˆç§°â€œåƒå…†â€<span class=\"token punctuation\">)</span><span class=\"token operator\">=</span><span class=\"token number\">1024</span><span class=\"token constant\">MB</span>ï¼Œ</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">1</span><span class=\"token constant\">TB</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Trillionbyte</span> ä¸‡äº¿å­—èŠ‚ å¤ªå­—èŠ‚<span class=\"token punctuation\">)</span><span class=\"token operator\">=</span><span class=\"token number\">1024</span><span class=\"token constant\">GB</span>ï¼Œå…¶ä¸­<span class=\"token number\">1024</span><span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token operator\">^</span><span class=\"token number\">10</span> <span class=\"token punctuation\">(</span> <span class=\"token number\">2</span> çš„<span class=\"token number\">10</span>æ¬¡æ–¹<span class=\"token punctuation\">)</span>ï¼Œ</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">1</span><span class=\"token constant\">PB</span>ï¼ˆ<span class=\"token class-name\">Petabyte</span> åƒä¸‡äº¿å­—èŠ‚ æ‹å­—èŠ‚ï¼‰<span class=\"token operator\">=</span><span class=\"token number\">1024</span><span class=\"token constant\">TB</span>ï¼Œ</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">1</span><span class=\"token constant\">EB</span>ï¼ˆ<span class=\"token class-name\">Exabyte</span> ç™¾äº¿äº¿å­—èŠ‚ è‰¾å­—èŠ‚ï¼‰<span class=\"token operator\">=</span><span class=\"token number\">1024</span><span class=\"token constant\">PB</span>ï¼Œ</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">1</span><span class=\"token constant\">ZB</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Zettabyte</span> åä¸‡äº¿äº¿å­—èŠ‚ æ³½å­—èŠ‚<span class=\"token punctuation\">)</span><span class=\"token operator\">=</span> <span class=\"token number\">1024</span> <span class=\"token constant\">EB</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">1</span><span class=\"token constant\">YB</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Jottabyte</span> ä¸€äº¿äº¿äº¿å­—èŠ‚ å°§å­—èŠ‚<span class=\"token punctuation\">)</span><span class=\"token operator\">=</span> <span class=\"token number\">1024</span> <span class=\"token constant\">ZB</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">1</span><span class=\"token constant\">BB</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Brontobyte</span> ä¸€åƒäº¿äº¿äº¿å­—èŠ‚<span class=\"token punctuation\">)</span><span class=\"token operator\">=</span> <span class=\"token number\">1024</span> <span class=\"token constant\">YB</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>æ³¨ï¼šâ€œå…†â€ä¸ºç™¾ä¸‡çº§æ•°é‡å•ä½ã€‚</pre></td></tr></table></figure><h2 id=\"4-å›¾å…³ç³»å‹æ•°æ®åº“\"><a class=\"markdownIt-Anchor\" href=\"#4-å›¾å…³ç³»å‹æ•°æ®åº“\">#</a> 4- å›¾å…³ç³»å‹æ•°æ®åº“</h2>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220727003806092.png\" alt=\"image-20220727003806092\"></p>\n<p>ä¸»è¦åº”ç”¨ï¼šç¤¾ä¼šå…³ç³»ï¼Œå…¬å…±äº¤é€šç½‘ç»œï¼Œåœ°å›¾åŠç½‘ç»œæ‹“è°± (n*(n-1)/2)</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220727003831658.png\" alt=\"image-20220727003831658\"></p>\n<h2 id=\"5-db-engines-æ•°æ®åº“æ’å\"><a class=\"markdownIt-Anchor\" href=\"#5-db-engines-æ•°æ®åº“æ’å\">#</a> 5 - DB-Engines æ•°æ®åº“æ’å</h2>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL2RiLWVuZ2luZXMuY29tL2VuL3Jhbmtpbmc=\">http://db-engines.com/en/ranking</span></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220727003904477.png\" alt=\"image-20220727003904477\"></p>\n<h1 id=\"äºŒ-redisæ¦‚è¿°å®‰è£…\"><a class=\"markdownIt-Anchor\" href=\"#äºŒ-redisæ¦‚è¿°å®‰è£…\">#</a> äºŒã€Redis æ¦‚è¿°å®‰è£…</h1>\n<ul>\n<li>Redis æ˜¯ä¸€ä¸ª <code>å¼€æº</code> çš„ <code>key-value</code>  å­˜å‚¨ç³»ç»Ÿã€‚</li>\n<li>å’Œ Memcached ç±»ä¼¼ï¼Œå®ƒæ”¯æŒå­˜å‚¨çš„ value ç±»å‹ç›¸å¯¹æ›´å¤šï¼ŒåŒ…æ‹¬ <code>string</code>  (å­—ç¬¦ä¸²)ã€ <code>list</code>  (é“¾è¡¨)ã€ <code>set</code>  (é›†åˆ)ã€ <code>zset</code>  (sorted set -- æœ‰åºé›†åˆ) å’Œ <code>hash</code> ï¼ˆå“ˆå¸Œç±»å‹ï¼‰</li>\n<li>è¿™äº›æ•°æ®ç±»å‹éƒ½æ”¯æŒ push/popã€add/remove åŠå–äº¤é›†å¹¶é›†å’Œå·®é›†åŠæ›´ä¸°å¯Œçš„æ“ä½œï¼Œè€Œä¸”è¿™äº›æ“ä½œéƒ½æ˜¯ <code>åŸå­æ€§</code> çš„</li>\n<li>åœ¨æ­¤åŸºç¡€ä¸Šï¼ŒRedis æ”¯æŒå„ç§ä¸åŒæ–¹å¼çš„ <code>æ’åº</code> ã€‚</li>\n<li>ä¸ memcached ä¸€æ ·ï¼Œä¸ºäº†ä¿è¯æ•ˆç‡ï¼Œæ•°æ®éƒ½æ˜¯ <code>ç¼“å­˜åœ¨å†…å­˜</code> ä¸­ã€‚</li>\n<li>åŒºåˆ«çš„æ˜¯ Redis ä¼šå‘¨æœŸæ€§çš„æŠŠæ›´æ–°çš„æ•°æ®å†™å…¥ç£ç›˜æˆ–è€…æŠŠä¿®æ”¹æ“ä½œå†™å…¥è¿½åŠ çš„è®°å½•æ–‡ä»¶ã€‚</li>\n<li>å¹¶ä¸”åœ¨æ­¤åŸºç¡€ä¸Šå®ç°äº† <code>master-slave(ä¸»ä»)</code>  åŒæ­¥ã€‚</li>\n</ul>\n<h2 id=\"1-åº”ç”¨åœºæ™¯\"><a class=\"markdownIt-Anchor\" href=\"#1-åº”ç”¨åœºæ™¯\">#</a> 1 - åº”ç”¨åœºæ™¯</h2>\n<h3 id=\"211é…åˆå…³ç³»å‹æ•°æ®åº“åšé«˜é€Ÿç¼“å­˜\"><a class=\"markdownIt-Anchor\" href=\"#211é…åˆå…³ç³»å‹æ•°æ®åº“åšé«˜é€Ÿç¼“å­˜\">#</a> 2.1.1.\té…åˆå…³ç³»å‹æ•°æ®åº“åšé«˜é€Ÿç¼“å­˜</h3>\n<ul>\n<li>é«˜é¢‘æ¬¡ï¼Œçƒ­é—¨è®¿é—®çš„æ•°æ®ï¼Œé™ä½æ•°æ®åº“ IO</li>\n<li>åˆ†å¸ƒå¼æ¶æ„ï¼Œåš session å…±äº«</li>\n<li><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220727004314790.png\" alt=\"image-20220727004314790\"></li>\n</ul>\n<h3 id=\"212å¤šæ ·çš„æ•°æ®ç»“æ„å­˜å‚¨æŒä¹…åŒ–æ•°æ®\"><a class=\"markdownIt-Anchor\" href=\"#212å¤šæ ·çš„æ•°æ®ç»“æ„å­˜å‚¨æŒä¹…åŒ–æ•°æ®\">#</a> 2.1.2.\tå¤šæ ·çš„æ•°æ®ç»“æ„å­˜å‚¨æŒä¹…åŒ–æ•°æ®</h3>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220727004344728.png\" alt=\"image-20220727004344728\"></p>\n<h2 id=\"2-rediså®‰è£…\"><a class=\"markdownIt-Anchor\" href=\"#2-rediså®‰è£…\">#</a> 2 - Redis å®‰è£…</h2>\n<p>Redis å®˜æ–¹ç½‘ç«™:  <span class=\"exturl\" data-url=\"aHR0cDovL3JlZGlzLmlv\">http://redis.io</span></p>\n<p>Redis ä¸­æ–‡å®˜æ–¹ç½‘ç«™:  <span class=\"exturl\" data-url=\"aHR0cDovL3JlZGlzLmNuLw==\">http://redis.cn/</span></p>\n<p>å‚è€ƒé“¾æ¥ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC81Mjc4Mjg2Mjc=\">linux ç³»ç»Ÿå®‰è£…å’Œä½¿ç”¨ Redis - çŸ¥ä¹ (zhihu.com)</span></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220727004514512.png\" alt=\"image-20220727004514512\"></p>\n<h3 id=\"221å®‰è£…ç‰ˆæœ¬\"><a class=\"markdownIt-Anchor\" href=\"#221å®‰è£…ç‰ˆæœ¬\">#</a> 2.2.1.\tå®‰è£…ç‰ˆæœ¬</h3>\n<ul>\n<li>6.2.1 for Linuxï¼ˆredis-6.2.1.tar.gzï¼‰</li>\n<li>ä¸ç”¨è€ƒè™‘åœ¨ windows ç¯å¢ƒä¸‹å¯¹ Redis çš„æ”¯æŒ (å¦‚æœçœŸçš„éœ€è¦å¯ä»¥å» github ä¸Šæ‰¾æ‰¾)</li>\n</ul>\n<h3 id=\"222å®‰è£…æ­¥éª¤\"><a class=\"markdownIt-Anchor\" href=\"#222å®‰è£…æ­¥éª¤\">#</a> 2.2.2.\tå®‰è£…æ­¥éª¤</h3>\n<p><strong>2.2.2.1.\tå‡†å¤‡å·¥ä½œï¼šä¸‹è½½å®‰è£…æœ€æ–°ç‰ˆçš„ gcc ç¼–è¯‘å™¨</strong><br>\nå®‰è£… C è¯­è¨€çš„ç¼–è¯‘ç¯å¢ƒ</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>yum <span class=\"token function\">install</span> centos-release-scl scl-utils-build</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>yum <span class=\"token function\">install</span> <span class=\"token parameter variable\">-y</span> devtoolset-8-toolchain</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>scl <span class=\"token builtin class-name\">enable</span> devtoolset-8 <span class=\"token function\">bash</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># æµ‹è¯• gcc ç‰ˆæœ¬ </span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>gcc <span class=\"token parameter variable\">--version</span></pre></td></tr></table></figure><p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220727104704322.png\" alt=\"image-20220727104704322\"></p>\n<p><strong>2.2.2.2.\tä¸‹è½½ redis-6.2.1.tar.gz æ”¾ /opt ç›®å½•</strong></p>\n<p><strong>2.2.2.3.\tè§£å‹å‘½ä»¤ï¼štar -zxvf redis-6.2.1.tar.gz</strong></p>\n<p><strong>2.2.2.4.\tè§£å‹å®Œæˆåè¿›å…¥ç›®å½•ï¼šcd redis-6.2.1</strong></p>\n<p><strong>2.2.2.5.\tåœ¨ redis-6.2.1 ç›®å½•ä¸‹å†æ¬¡æ‰§è¡Œ make å‘½ä»¤ï¼ˆåªæ˜¯ç¼–è¯‘å¥½ï¼‰</strong></p>\n<p><strong>2.2.2.6.\tå¦‚æœæ²¡æœ‰å‡†å¤‡å¥½ C è¯­è¨€ç¼–è¯‘ç¯å¢ƒï¼Œmake ä¼šæŠ¥é”™ â€”Jemalloc/jemalloc.hï¼šæ²¡æœ‰é‚£ä¸ªæ–‡ä»¶</strong></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220727104834499.png\" alt=\"image-20220727104834499\"></p>\n<p><strong>2.2.2.7.\tè§£å†³æ–¹æ¡ˆï¼šè¿è¡Œ make distclean</strong></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220727104852287.png\" alt=\"image-20220727104852287\"></p>\n<p><strong>2.2.2.8.\tåœ¨ redis-6.2.1 ç›®å½•ä¸‹å†æ¬¡æ‰§è¡Œ make å‘½ä»¤ï¼ˆåªæ˜¯ç¼–è¯‘å¥½ï¼‰</strong></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220727104906795.png\" alt=\"image-20220727104906795\"></p>\n<p><strong>2.2.2.9.\tè·³è¿‡ make test ç»§ç»­æ‰§è¡Œ: make install</strong></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220727104934592.png\" alt=\"image-20220727104934592\"></p>\n<h3 id=\"å®æ“\"><a class=\"markdownIt-Anchor\" href=\"#å®æ“\">#</a> å®æ“</h3>\n<ol>\n<li>å®‰è£…ä¾èµ–ï¼Œå› ä¸º Redis æ˜¯åŸºäº C è¯­è¨€ç¼–å†™çš„ï¼Œå› æ­¤é¦–å…ˆéœ€è¦å®‰è£… Redis æ‰€éœ€è¦çš„ gcc ä¾èµ–</li>\n</ol>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>yum <span class=\"token function\">install</span> <span class=\"token parameter variable\">-y</span> gcc tcl</pre></td></tr></table></figure><p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220727155634575.png\" alt=\"image-20220727155634575\"></p>\n<ol start=\"2\">\n<li>\n<p>ä¸Šä¼ æ–‡ä»¶ï¼šæˆ‘ä¸Šä¼ åˆ°äº† /opt ç›®å½•ä¸‹</p>\n</li>\n<li>\n<p>è§£å‹ï¼š <code>tar -zxvf redis-6.2.7.tar.gz</code></p>\n</li>\n<li>\n<p>cd åˆ°è¯¥ç›®å½•ï¼šcd  redis-6.2.7</p>\n</li>\n<li>\n<p>make: ç¼–è¯‘   <code>make</code>  è¿™ä¸ªå®Œæˆä¹‹å <code>make install</code></p>\n</li>\n</ol>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220727161333762.png\" alt=\"image-20220727161333762\"></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220727161816964.png\" alt=\"image-20220727161816964\"></p>\n<p>é»˜è®¤å®‰è£…è·¯å¾„ï¼šusr/local/bin/</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220727161855947.png\" alt=\"image-20220727161855947\"></p>\n<p>ä½¿ç”¨æ¨èçš„åå°å¯åŠ¨æ–¹å¼ï¼Œéœ€è¦å¯¹ redis.conf å¤‡ä»½ä¸€ä»½</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">cp</span> redis.conf redis.conf.copy</pre></td></tr></table></figure><p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220727162452302.png\" alt=\"image-20220727162452302\"></p>\n<h3 id=\"223å®‰è£…ç›®å½•usrlocalbin\"><a class=\"markdownIt-Anchor\" href=\"#223å®‰è£…ç›®å½•usrlocalbin\">#</a> 2.2.3.\tå®‰è£…ç›®å½•ï¼š/usr/local/bin</h3>\n<p><strong>æŸ¥çœ‹é»˜è®¤å®‰è£…ç›®å½•ï¼š</strong><br>\nredis-benchmark :   æ€§èƒ½æµ‹è¯•å·¥å…·ï¼Œå¯ä»¥åœ¨è‡ªå·±æœ¬å­è¿è¡Œï¼Œçœ‹çœ‹è‡ªå·±æœ¬å­æ€§èƒ½å¦‚ä½•<br>\n redis-check-aofï¼š ä¿®å¤æœ‰é—®é¢˜çš„ AOF æ–‡ä»¶ï¼Œrdb å’Œ aof åé¢è®²<br>\n redis-check-dumpï¼šä¿®å¤æœ‰é—®é¢˜çš„ dump.rdb æ–‡ä»¶<br>\n redis-sentinelï¼šRedis é›†ç¾¤ä½¿ç”¨<br>\n <code>redis-server</code> ï¼šRedis æœåŠ¡å™¨å¯åŠ¨å‘½ä»¤<br>\n <code>redis-cli</code> ï¼šå®¢æˆ·ç«¯ï¼Œæ“ä½œå…¥å£</p>\n<h3 id=\"224å‰å°å¯åŠ¨ä¸æ¨è\"><a class=\"markdownIt-Anchor\" href=\"#224å‰å°å¯åŠ¨ä¸æ¨è\">#</a> 2.2.4.\tå‰å°å¯åŠ¨ï¼ˆä¸æ¨èï¼‰</h3>\n<p>å‰å°å¯åŠ¨ï¼Œå‘½ä»¤è¡Œçª—å£ä¸èƒ½å…³é—­ï¼Œå¦åˆ™æœåŠ¡å™¨åœæ­¢</p>\n<p>redis-server</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220727105158482.png\" alt=\"image-20220727105158482\"></p>\n<h3 id=\"225åå°å¯åŠ¨æ¨è\"><a class=\"markdownIt-Anchor\" href=\"#225åå°å¯åŠ¨æ¨è\">#</a> 2.2.5.\tåå°å¯åŠ¨ï¼ˆæ¨èï¼‰</h3>\n<p><strong>2.2.5.1.\tå¤‡ä»½ redis.conf</strong></p>\n<p>æ‹·è´ä¸€ä»½ <code>redis.conf</code>  åˆ°å…¶ä»–ç›®å½•<br>\n <code>cp  /opt/redis-3.2.5/redis.conf  /myredis</code></p>\n<p><strong>2.2.5.2.\tåå°å¯åŠ¨è®¾ç½® <code>daemonize no</code>  æ”¹æˆ <code>yes</code> </strong></p>\n<p>ä¿®æ”¹ redis.conf (128 è¡Œ) æ–‡ä»¶å°†é‡Œé¢çš„ daemonize no æ”¹æˆ yesï¼Œè®©æœåŠ¡åœ¨åå°å¯åŠ¨</p>\n<p><strong>2.2.5.3.\tRedis å¯åŠ¨</strong></p>\n<p><code>redis-server/myredis/redis.conf</code>   ä½ çš„è¿™ä¸ªé…ç½®æ–‡ä»¶åœ¨é‚£ä¸ªæ–‡ä»¶å¤¹ä¸‹å°±æ‰§è¡Œå“ªä¸ªæ–‡ä»¶å¤¹çš„é…ç½®é…ç½®æ–‡ä»¶</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220727105349213.png\" alt=\"image-20220727105349213\"></p>\n<p><strong>2.2.5.4.\tç”¨å®¢æˆ·ç«¯è®¿é—®ï¼š</strong> <code>redis-cli</code></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220727105413882.png\" alt=\"image-20220727105413882\"></p>\n<p><strong>2.2.5.5.\tå¤šä¸ªç«¯å£å¯ä»¥ï¼š</strong> <code>redis-cli -p6379</code> <br>\n<strong>2.2.5.6.\tæµ‹è¯•éªŒè¯ï¼š</strong>  <code>ping</code></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220727105506029.png\" alt=\"image-20220727105506029\"></p>\n<p><strong>2.2.5.7.\tRedis å…³é—­</strong></p>\n<p>å•å®ä¾‹å…³é—­ï¼š <code>redis-cli shutdown</code></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220727105606303.png\" alt=\"image-20220727105606303\"></p>\n<p>ä¹Ÿå¯ä»¥è¿›å…¥ç»ˆç«¯åå†å…³é—­</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220727105620164.png\" alt=\"image-20220727105620164\"></p>\n<p>å¤šå®ä¾‹å…³é—­ï¼ŒæŒ‡å®šç«¯å£å…³é—­ï¼š <code>redis-cli -p 6379 shutdown</code></p>\n<h3 id=\"226redisä»‹ç»ç›¸å…³çŸ¥è¯†\"><a class=\"markdownIt-Anchor\" href=\"#226redisä»‹ç»ç›¸å…³çŸ¥è¯†\">#</a> 2.2.6.\tRedis ä»‹ç»ç›¸å…³çŸ¥è¯†</h3>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220727105742074.png\" alt=\"image-20220727105742074\"></p>\n<p><strong>Redis æ˜¯å•çº¿ç¨‹ + å¤šè·¯ IO å¤ç”¨æŠ€æœ¯</strong></p>\n<p>å¤šè·¯å¤ç”¨æ˜¯æŒ‡ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥æ£€æŸ¥å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆSocketï¼‰çš„å°±ç»ªçŠ¶æ€ï¼Œæ¯”å¦‚è°ƒç”¨ select å’Œ poll å‡½æ•°ï¼Œä¼ å…¥å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦å°±ç»ªï¼Œåˆ™è¿”å›ï¼Œå¦åˆ™é˜»å¡ç›´åˆ°è¶…æ—¶ã€‚å¾—åˆ°å°±ç»ªçŠ¶æ€åè¿›è¡ŒçœŸæ­£çš„æ“ä½œå¯ä»¥åœ¨åŒä¸€ä¸ªçº¿ç¨‹é‡Œæ‰§è¡Œï¼Œä¹Ÿå¯ä»¥å¯åŠ¨çº¿ç¨‹æ‰§è¡Œï¼ˆæ¯”å¦‚ä½¿ç”¨çº¿ç¨‹æ± ï¼‰</p>\n<p><code>ä¸²è¡Œ   vs   å¤šçº¿ç¨‹+é”ï¼ˆmemcachedï¼‰ vs   å•çº¿ç¨‹+å¤šè·¯IOå¤ç”¨(Redis)</code></p>\n<p>ï¼ˆä¸ Memcache ä¸‰ç‚¹ä¸åŒï¼šæ”¯æŒå¤šæ•°æ®ç±»å‹ï¼Œæ”¯æŒæŒä¹…åŒ–ï¼Œå•çº¿ç¨‹ + å¤šè·¯ IO å¤ç”¨ï¼‰</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220727105854506.png\" alt=\"image-20220727105854506\"></p>\n<h1 id=\"ä¸‰-å¸¸ç”¨äº”å¤§æ•°æ®ç±»å‹\"><a class=\"markdownIt-Anchor\" href=\"#ä¸‰-å¸¸ç”¨äº”å¤§æ•°æ®ç±»å‹\">#</a> ä¸‰ã€å¸¸ç”¨äº”å¤§æ•°æ®ç±»å‹</h1>\n<p>å“ªé‡Œå»è·å¾— redis å¸¸è§æ•°æ®ç±»å‹æ“ä½œå‘½ä»¤ http://www.redis.cn/commands.html</p>\n<h2 id=\"1-redisé”®key\"><a class=\"markdownIt-Anchor\" href=\"#1-redisé”®key\">#</a> 1 - Redis é”® (key)</h2>\n<p><code>key:</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>å‘½ä»¤ï¼š</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  ï¼ˆ1ï¼‰keys * <span class=\"token builtin class-name\">:</span> æŸ¥çœ‹å½“å‰åº“æ‰€æœ‰key    <span class=\"token punctuation\">(</span>åŒ¹é…ï¼škeys *1<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  ï¼ˆ2ï¼‰exists key: åˆ¤æ–­æŸä¸ªkeyæ˜¯å¦å­˜åœ¨</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  ï¼ˆ3ï¼‰type key <span class=\"token builtin class-name\">:</span> æŸ¥çœ‹ä½ çš„keyæ˜¯ä»€ä¹ˆç±»å‹</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  ï¼ˆ4ï¼‰del key  <span class=\"token builtin class-name\">:</span> åˆ é™¤æŒ‡å®šçš„keyæ•°æ®</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  ï¼ˆ5ï¼‰unlink key <span class=\"token builtin class-name\">:</span> æ ¹æ®valueé€‰æ‹©éé˜»å¡åˆ é™¤<span class=\"token punctuation\">(</span>ä»…å°†keysä»keyspaceå…ƒæ•°æ®ä¸­åˆ é™¤ï¼ŒçœŸæ­£çš„åˆ é™¤ä¼šåœ¨åç»­å¼‚æ­¥æ“ä½œ<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  ï¼ˆ6ï¼‰expire key <span class=\"token number\">10</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">10</span>ç§’é’Ÿ,ä¸ºç»™å®šçš„keyè®¾ç½®è¿‡æœŸæ—¶é—´</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  ï¼ˆ7ï¼‰ttl key <span class=\"token builtin class-name\">:</span> æŸ¥çœ‹è¿˜æœ‰å¤šå°‘ç§’è¿‡æœŸï¼Œ-1è¡¨ç¤ºæ°¸ä¸è¿‡æœŸï¼Œ-2è¡¨ç¤ºå·²è¿‡æœŸ</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  ï¼ˆ8ï¼‰select  <span class=\"token builtin class-name\">:</span> å‘½ä»¤åˆ‡æ¢æ•°æ®åº“</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  ï¼ˆ9ï¼‰dbsize  <span class=\"token builtin class-name\">:</span> æŸ¥çœ‹å½“å‰æ•°æ®åº“çš„keyçš„æ•°é‡</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  ï¼ˆ10ï¼‰flushdb <span class=\"token builtin class-name\">:</span> æ¸…ç©ºå½“å‰åº“</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  ï¼ˆ11ï¼‰flushall: é€šæ€å…¨éƒ¨åº“</pre></td></tr></table></figure><h2 id=\"2-rediså­—ç¬¦ä¸²string\"><a class=\"markdownIt-Anchor\" href=\"#2-rediså­—ç¬¦ä¸²string\">#</a> 2 - Redis å­—ç¬¦ä¸² (String)</h2>\n<h3 id=\"321ç®€ä»‹\"><a class=\"markdownIt-Anchor\" href=\"#321ç®€ä»‹\">#</a> 3.2.1.\tç®€ä»‹</h3>\n<p>String æ˜¯ Redis æœ€åŸºæœ¬çš„ç±»å‹ï¼Œä½ å¯ä»¥ç†è§£æˆä¸ Memcached ä¸€æ¨¡ä¸€æ ·çš„ç±»å‹ï¼Œä¸€ä¸ª key å¯¹åº”ä¸€ä¸ª valueã€‚<br>\nString ç±»å‹æ˜¯ <code>äºŒè¿›åˆ¶å®‰å…¨çš„</code> ã€‚æ„å‘³ç€ Redis çš„ string å¯ä»¥åŒ…å«ä»»ä½•æ•°æ®ã€‚æ¯”å¦‚ jpg å›¾ç‰‡æˆ–è€…åºåˆ—åŒ–çš„å¯¹è±¡ã€‚<br>\nString ç±»å‹æ˜¯ Redis æœ€åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œä¸€ä¸ª Redis ä¸­å­—ç¬¦ä¸² value æœ€å¤šå¯ä»¥æ˜¯ <code>512M</code></p>\n<h3 id=\"322å¸¸ç”¨å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#322å¸¸ç”¨å‘½ä»¤\">#</a> 3.2.2.\tå¸¸ç”¨å‘½ä»¤</h3>\n<p><code>String:</code>  k- key (é”®)  v-value (å€¼)</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>å‘½ä»¤ï¼š</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  ï¼ˆ1ï¼‰å­˜ï¼šset k <span class=\"token function\">v</span>  <span class=\"token punctuation\">[</span>å¦è¯´æ˜è§ä¸‹ï¼<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  ï¼ˆ2ï¼‰å–ï¼šget k         </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  ï¼ˆ3ï¼‰è¿½åŠ å­—ç¬¦ï¼šappend k <span class=\"token string\">\"è¿½åŠ å­—æ®µ\"</span> </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  ï¼ˆ4ï¼‰é•¿åº¦ï¼šstrlen k</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  ï¼ˆ5ï¼‰æ— è¯¥keyæ—¶å­˜ï¼šsetnx k v:ï¼ˆåªæœ‰åœ¨ key ä¸å­˜åœ¨æ—¶è®¾ç½® key çš„å€¼ï¼‰</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  ï¼ˆ6ï¼‰å¢æŒ‡å®šå€¼ï¼šincrby k <span class=\"token punctuation\">[</span>integer<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  ï¼ˆ7ï¼‰å‡æŒ‡å®šå€¼ï¼šdecrby k <span class=\"token punctuation\">[</span>integer<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  ï¼ˆ8ï¼‰é€’å¢ï¼šincr k ï¼ˆä¸€å®šæ˜¯æ•´æ•°ï¼›å¦‚æ— å€¼åˆ™èµ‹0ååŠ 1ï¼‰</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  ï¼ˆ9ï¼‰é€’é”®ï¼šdecr k ï¼ˆä¸€å®šæ˜¯æ•´æ•°ï¼›å¦‚æ— å€¼åˆ™èµ‹0åå‡1ï¼‰</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>å…¶ä»–å‘½ä»¤ï¼š</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  ï¼ˆ1ï¼‰æ‰¹é‡å­˜ï¼šmset k1 v1 k2 v2<span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  ï¼ˆ2ï¼‰æ‰¹é‡å–ï¼šmget k1 k2 k3 <span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>         </pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  ï¼ˆ3ï¼‰æ‰¹é‡å­˜ï¼šmsetnx k1 v1 k2 v2<span class=\"token punctuation\">..</span>.ï¼ˆå½“ä¸”ä»…å½“æ‰€æœ‰ç»™å®š key éƒ½ä¸å­˜åœ¨ï¼ŒåŸå­æ€§ï¼Œæœ‰ä¸€ä¸ªå¤±è´¥åˆ™éƒ½å¤±è´¥ï¼‰</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  ï¼ˆ4ï¼‰èŒƒå›´å–ï¼šgetrange k èµ·å§‹ä½ç½® ç»“æŸä½ç½®ï¼ˆç±»ä¼¼javaä¸­çš„substringï¼Œå‰åŒ…ï¼ŒååŒ…ï¼‰</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  ï¼ˆ5ï¼‰å–å…¨éƒ¨æ•°æ®ï¼šgetrange k <span class=\"token number\">0</span> <span class=\"token parameter variable\">-1</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  ï¼ˆ6ï¼‰è¦†ç›–å€¼ï¼šsetrange k èµ·å§‹ä½ç½® <span class=\"token function\">v</span> <span class=\"token punctuation\">(</span>ç”¨<span class=\"token operator\">&lt;</span>value<span class=\"token operator\">></span>è¦†å†™<span class=\"token operator\">&lt;</span>key<span class=\"token operator\">></span>æ‰€å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼ï¼Œä»<span class=\"token operator\">&lt;</span>èµ·å§‹ä½ç½®<span class=\"token operator\">></span>å¼€å§‹<span class=\"token punctuation\">(</span>ç´¢å¼•ä»0å¼€å§‹<span class=\"token punctuation\">))</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  ï¼ˆ7ï¼‰è¿‡æœŸæ—¶é—´ï¼šsetex k è¿‡æœŸæ—¶é—´ value <span class=\"token punctuation\">(</span>è®¾ç½®é”®å€¼çš„åŒæ—¶ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå•ä½ç§’<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  ï¼ˆ8ï¼‰ä»¥æ–°æ¢æ—§ï¼šgetset k <span class=\"token function\">v</span> <span class=\"token punctuation\">(</span>è®¾ç½®äº†æ–°å€¼åŒæ—¶è·å¾—æ—§å€¼<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p><strong>å­˜ set çš„è¯´æ˜ï¼š</strong></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220727111440940.png\" alt=\"image-20220727111440940\"></p>\n<ul>\n<li>NXï¼šå½“æ•°æ®åº“ä¸­ key ä¸å­˜åœ¨æ—¶ï¼Œå¯ä»¥å°† key-value æ·»åŠ æ•°æ®åº“</li>\n<li>XXï¼šå½“æ•°æ®åº“ä¸­ key å­˜åœ¨æ—¶ï¼Œå¯ä»¥å°† key-value æ·»åŠ æ•°æ®åº“ï¼Œä¸ NX å‚æ•°äº’æ–¥</li>\n<li>EXï¼škey çš„è¶…æ—¶ç§’æ•°</li>\n<li>PXï¼škey çš„è¶…æ—¶æ¯«ç§’æ•°ï¼Œä¸ EX äº’æ–¥</li>\n</ul>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220727113031192.png\" alt=\"image-20220727113031192\"></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220727113111389.png\" alt=\"image-20220727113111389\"></p>\n<p>ä¸Šé¢çš„å€¼å¯èƒ½æ˜¯ 2~200ï¼Œå› ä¸º i++ ä¸æ˜¯åŸå­æ“ä½œï¼Œå®ƒåˆ†ä¸‰æ­¥å®Œæˆï¼šè·å– i çš„å€¼ï¼Œè¿›è¡Œ + æ“ä½œï¼Œèµ‹å€¼</p>\n<h3 id=\"323æ•°æ®ç»“æ„\"><a class=\"markdownIt-Anchor\" href=\"#323æ•°æ®ç»“æ„\">#</a> 3.2.3.\tæ•°æ®ç»“æ„</h3>\n<p>String çš„æ•°æ®ç»“æ„ä¸º <code>ç®€å•åŠ¨æ€å­—ç¬¦ä¸²</code>  (Simple Dynamic String, ç¼©å†™ SDS)ã€‚æ˜¯å¯ä»¥ä¿®æ”¹çš„å­—ç¬¦ä¸²ï¼Œå†…éƒ¨ç»“æ„å®ç°ä¸Šç±»ä¼¼äº Java çš„ <code>ArrayList</code> ï¼Œé‡‡ç”¨é¢„åˆ†é…å†—ä½™ç©ºé—´çš„æ–¹å¼æ¥å‡å°‘å†…å­˜çš„é¢‘ç¹åˆ†é…</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220727123548075.png\" alt=\"image-20220727123548075\"></p>\n<p>å¦‚å›¾ä¸­æ‰€ç¤ºï¼Œå†…éƒ¨ä¸ºå½“å‰å­—ç¬¦ä¸²å®é™…åˆ†é…çš„ç©ºé—´ capacity ä¸€èˆ¬è¦é«˜äºå®é™…å­—ç¬¦ä¸²é•¿åº¦ lenã€‚å½“å­—ç¬¦ä¸²é•¿åº¦å°äº 1M æ—¶ï¼Œæ‰©å®¹éƒ½æ˜¯ <code>åŠ å€</code> ç°æœ‰çš„ç©ºé—´ï¼Œå¦‚æœè¶…è¿‡ 1Mï¼Œæ‰©å®¹æ—¶ä¸€æ¬¡åªä¼š <code>å¤šæ‰©1M</code>  çš„ç©ºé—´ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å­—ç¬¦ä¸²æœ€å¤§é•¿åº¦ä¸º 512Mã€‚</p>\n<h2 id=\"3-redisåˆ—è¡¨list\"><a class=\"markdownIt-Anchor\" href=\"#3-redisåˆ—è¡¨list\">#</a> 3 - Redis åˆ—è¡¨ (List)</h2>\n<h3 id=\"331ç®€ä»‹\"><a class=\"markdownIt-Anchor\" href=\"#331ç®€ä»‹\">#</a> 3.3.1.\tç®€ä»‹</h3>\n<p><strong>å•é”®å¤šå€¼</strong><br>\n Redis åˆ—è¡¨æ˜¯ç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒæŒ‰ç…§æ’å…¥é¡ºåºæ’åºã€‚ä½ å¯ä»¥æ·»åŠ ä¸€ä¸ªå…ƒç´ åˆ°åˆ—è¡¨çš„å¤´éƒ¨ï¼ˆå·¦è¾¹ï¼‰æˆ–è€…å°¾éƒ¨ï¼ˆå³è¾¹ï¼‰ã€‚</p>\n<p>å®ƒçš„åº•å±‚å®é™…æ˜¯ä¸ª <code>åŒå‘é“¾è¡¨</code> ï¼Œå¯¹ä¸¤ç«¯çš„æ“ä½œæ€§èƒ½å¾ˆé«˜ï¼Œé€šè¿‡ç´¢å¼•ä¸‹æ ‡çš„æ“ä½œä¸­é—´çš„èŠ‚ç‚¹æ€§èƒ½ä¼šè¾ƒå·®ã€‚</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220727123852045.png\" alt=\"image-20220727123852045\"></p>\n<h3 id=\"332å¸¸ç”¨å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#332å¸¸ç”¨å‘½ä»¤\">#</a> 3.3.2.\tå¸¸ç”¨å‘½ä»¤</h3>\n<p><code>list:</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>æ¦‚è¿°ï¼š</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>å…ƒç´ æ’å…¥</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>é“¾è¡¨è¡¨å¤´æˆ–ç»“å°¾æ’å…¥ï¼šé«˜æ•ˆï¼Œä¸­é—´ï¼šä½</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>å­˜å‚¨listï¼š</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">1</span>.ArrayListä½¿ç”¨æ•°ç»„æ–¹å¼ï¼šä½¿ç”¨ç´¢å¼•æŸ¥è¯¢-å—ï¼Œæ–°å¢åˆ é™¤æ—¶æ¶‰åŠä½ç§»æ“ä½œ-æ…¢</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">2</span>.LinkedListä½¿ç”¨åŒå‘é“¾æ¥æ–¹å¼ï¼šæ¯ä¸ªå…ƒç´ è®°å½•å‰åå…ƒç´ æŒ‡é’ˆ</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">3</span>.åŒå‘é“¾è¡¨å¢åŠ æ•°æ®</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">4</span>.åŒå‘é“¾è¡¨åˆ é™¤æ•°æ®</pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>å­˜å‚¨listå¸¸ç”¨å‘½ä»¤ï¼š</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token number\">1</span>.ä¸¤ç«¯æ·»åŠ ï¼šlpushã€rpush<span class=\"token variable\">`</span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>lpush list <span class=\"token number\">1</span> <span class=\"token number\">2</span> <span class=\"token number\">3</span> <span class=\"token comment\">#ä»å·¦ä¾§å¾€ list è¡¨ä¸­æ’å…¥ 1 2 3</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>rpush list a b c <span class=\"token comment\">#ä»å³ä¾§å¾€ list è¡¨ä¸­æ’å…¥ a b c </span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token number\">2</span>.æŸ¥çœ‹åˆ—è¡¨ï¼šlrange<span class=\"token variable\">`</span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>lrange list <span class=\"token number\">0</span> <span class=\"token parameter variable\">-1</span> <span class=\"token comment\">#ä»å¤´åˆ°å°¾æŸ¥çœ‹</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>lrange list <span class=\"token number\">0</span> <span class=\"token number\">5</span>  <span class=\"token comment\">#ä»å¼€å§‹åˆ°ç¬¬ 5 ä¸ªæŸ¥çœ‹</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token number\">3</span>.ä¸¤ç«¯å¼¹å‡ºï¼šlpopã€rpop <span class=\"token punctuation\">(</span>å€¼åœ¨é”®åœ¨ï¼Œå€¼å…‰é”®äº¡<span class=\"token punctuation\">)</span><span class=\"token variable\">`</span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>lpop list <span class=\"token comment\">#ä»å·¦è¾¹å¼¹å‡ºç¬¬ä¸€ä¸ªæ•°</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>rpop list <span class=\"token comment\">#ä»å°¾éƒ¨å¼¹å‡ºç¬¬ä¸€ä¸ªæ•°</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token number\">4</span>.è·å–åˆ—è¡¨å…ƒç´ ä¸ªæ•°ï¼šllen<span class=\"token variable\">`</span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>llen list <span class=\"token comment\">#æŸ¥çœ‹å…ƒç´ ä¸ªæ•°</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token number\">5</span>.æ‰©å±•å‘½ä»¤ï¼šlpushxã€rpushxã€lremã€lsetã€rpoplppush<span class=\"token variable\">`</span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>lpushx list x <span class=\"token comment\">#æ’å…¥ x åˆ° list è¡¨çš„å¼€å¤´ï¼ˆå·¦è¾¹ï¼‰</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>rpushx list y <span class=\"token comment\">#æ’å…¥ y åˆ° list è¡¨çš„å°¾éƒ¨ï¼ˆå³è¾¹ï¼‰</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>lrem list n value <span class=\"token comment\">#ä»å¤´åˆ°å°¾åˆ é™¤ n ä¸ª value</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>lrem list <span class=\"token number\">2</span> <span class=\"token number\">3</span> <span class=\"token comment\">#ä»å¤´åˆ°å°¾åˆ é™¤ 2 ä¸ª 3 (ä»å·¦åˆ°å³)</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>lrem list <span class=\"token parameter variable\">-2</span> <span class=\"token number\">1</span>  <span class=\"token comment\">#ä»å°¾åˆ°å¤´åˆ é™¤ 2 ä¸ª 1ï¼ˆä»å³åˆ°å·¦ï¼‰</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>lrem list <span class=\"token number\">0</span> <span class=\"token number\">2</span>\t<span class=\"token comment\">#åˆ é™¤æ‰€æœ‰ 2</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>lset key n value \t<span class=\"token comment\">#åœ¨ key è¡¨ç¬¬ n ä¸ªè§’æ ‡è®¾ç½®ä¸º value</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>lset list <span class=\"token number\">3</span> mmm \t<span class=\"token comment\">#åœ¨ list è¡¨ç¬¬ 3 ä¸ªè§’æ ‡è®¾ç½® mmm</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>linset list before a yy\t <span class=\"token comment\">#åœ¨ list è¡¨ä¸­ a ä¹‹å‰æ’å…¥ yy</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>linset list after b xx \t<span class=\"token comment\">#åœ¨ list è¡¨ä¸­ b ä¹‹åæ’å…¥ xx</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>rpoplpush list1 list2 \t<span class=\"token comment\">#ä» list1 è¡¨çš„å³è¾¹åå‡ºå‹å…¥åˆ° list2 è¡¨çš„å·¦è¾¹</span></pre></td></tr></table></figure><h3 id=\"333æ•°æ®ç»“æ„\"><a class=\"markdownIt-Anchor\" href=\"#333æ•°æ®ç»“æ„\">#</a> 3.3.3.\tæ•°æ®ç»“æ„</h3>\n<p>List çš„æ•°æ®ç»“æ„ä¸º <code>å¿«é€Ÿé“¾è¡¨quickList</code> ã€‚</p>\n<p>é¦–å…ˆåœ¨åˆ—è¡¨å…ƒç´ è¾ƒå°‘çš„æƒ…å†µä¸‹ä¼šä½¿ç”¨ä¸€å—è¿ç»­çš„å†…å­˜å­˜å‚¨ï¼Œè¿™ä¸ªç»“æ„æ˜¯ <code>ziplist</code> ï¼Œä¹Ÿå³æ˜¯ <code>å‹ç¼©åˆ—è¡¨</code> ã€‚</p>\n<p>å®ƒå°†æ‰€æœ‰çš„å…ƒç´ ç´§æŒ¨ç€ä¸€èµ·å­˜å‚¨ï¼Œåˆ†é…çš„æ˜¯ä¸€å—è¿ç»­çš„å†…å­˜ã€‚</p>\n<p>å½“æ•°æ®é‡æ¯”è¾ƒå¤šçš„æ—¶å€™æ‰ä¼šæ”¹æˆ <code>quicklist</code> ã€‚</p>\n<p>å› ä¸ºæ™®é€šçš„é“¾è¡¨éœ€è¦çš„é™„åŠ æŒ‡é’ˆç©ºé—´å¤ªå¤§ï¼Œä¼šæ¯”è¾ƒæµªè´¹ç©ºé—´ã€‚æ¯”å¦‚è¿™ä¸ªåˆ—è¡¨é‡Œå­˜çš„åªæ˜¯ int ç±»å‹çš„æ•°æ®ï¼Œç»“æ„ä¸Šè¿˜éœ€è¦ä¸¤ä¸ªé¢å¤–çš„æŒ‡é’ˆ prev å’Œ nextã€‚</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220727135259344.png\" alt=\"image-20220727135259344\"></p>\n<p>Redis å°†é“¾è¡¨å’Œ ziplist ç»“åˆèµ·æ¥ç»„æˆäº† quicklistã€‚ä¹Ÿå°±æ˜¯å°†å¤šä¸ª ziplist ä½¿ç”¨åŒå‘æŒ‡é’ˆä¸²èµ·æ¥ä½¿ç”¨ã€‚è¿™æ ·æ—¢æ»¡è¶³äº†å¿«é€Ÿçš„æ’å…¥åˆ é™¤æ€§èƒ½ï¼Œåˆä¸ä¼šå‡ºç°å¤ªå¤§çš„ç©ºé—´å†—ä½™ã€‚</p>\n<h2 id=\"4-redisé›†åˆset\"><a class=\"markdownIt-Anchor\" href=\"#4-redisé›†åˆset\">#</a> 4 - Redis é›†åˆ (Set)</h2>\n<h3 id=\"341ç®€ä»‹\"><a class=\"markdownIt-Anchor\" href=\"#341ç®€ä»‹\">#</a> 3.4.1.\tç®€ä»‹</h3>\n<p>Redis set å¯¹å¤–æä¾›çš„åŠŸèƒ½ä¸ list ç±»ä¼¼æ˜¯ä¸€ä¸ªåˆ—è¡¨çš„åŠŸèƒ½ï¼Œç‰¹æ®Šä¹‹å¤„åœ¨äº set æ˜¯å¯ä»¥ <code>è‡ªåŠ¨æ’é‡</code> çš„ï¼Œå½“ä½ éœ€è¦å­˜å‚¨ä¸€ä¸ªåˆ—è¡¨æ•°æ®ï¼Œåˆä¸å¸Œæœ›å‡ºç°é‡å¤æ•°æ®æ—¶ï¼Œset æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œå¹¶ä¸” set æä¾›äº†åˆ¤æ–­æŸä¸ªæˆå‘˜æ˜¯å¦åœ¨ä¸€ä¸ª set é›†åˆå†…çš„é‡è¦æ¥å£ï¼Œè¿™ä¸ªä¹Ÿæ˜¯ list æ‰€ä¸èƒ½æä¾›çš„ã€‚</p>\n<p>Redis çš„ Set æ˜¯ string ç±»å‹çš„<strong>æ— åºé›†åˆ</strong>ã€‚<strong>å®ƒåº•å±‚å…¶å®æ˜¯ä¸€ä¸ª value ä¸º null çš„ hash è¡¨ï¼Œæ‰€ä»¥æ·»åŠ ï¼Œåˆ é™¤ï¼ŒæŸ¥æ‰¾çš„å¤æ‚åº¦éƒ½æ˜¯ O (1)</strong>ã€‚</p>\n<p>ä¸€ä¸ªç®—æ³•ï¼Œéšç€æ•°æ®çš„å¢åŠ ï¼Œæ‰§è¡Œæ—¶é—´çš„é•¿çŸ­ï¼Œå¦‚æœæ˜¯ O (1)ï¼Œæ•°æ®å¢åŠ ï¼ŒæŸ¥æ‰¾æ•°æ®çš„æ—¶é—´ä¸å˜</p>\n<h3 id=\"342å¸¸ç”¨å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#342å¸¸ç”¨å‘½ä»¤\">#</a> 3.4.2.\tå¸¸ç”¨å‘½ä»¤</h3>\n<p><code>Set:</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>Redisæ•°æ®ç»“æ„ï¼ˆSetï¼‰: Listå…è®¸å‡ºç°é‡å¤æ•°æ®ï¼ŒSetä¸å…è®¸å‡ºç°é‡å¤æ•°æ®ï¼›Setæœ€å¤§å…ƒç´ æ•°é‡æ˜¯4294967295</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>å‘½ä»¤ï¼š</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  ï¼ˆ1ï¼‰å­˜ï¼šsadd åˆ—å <span class=\"token punctuation\">[</span>å€¼<span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  ï¼ˆ2ï¼‰åˆ ï¼šsrem åˆ—å <span class=\"token punctuation\">[</span>å€¼<span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  ï¼ˆ3ï¼‰æŸ¥å…¨ï¼šsmembers åˆ—å</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  ï¼ˆ4ï¼‰æŸ¥æ˜¯å¦å­˜åœ¨ï¼šsismember åˆ—å å€¼ï¼Œ1è¡¨ç¤ºå­˜åœ¨ï¼Œ0è¡¨ç¤ºä¸å­˜åœ¨</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  ï¼ˆ5ï¼‰å·®é›†ï¼šsdiff åˆ—å1 åˆ—å2 ï¼ˆ<span class=\"token punctuation\">(</span>åˆ—1ä¸­çš„ï¼Œä¸åŒ…å«åœ¨åˆ—2ä¸­çš„<span class=\"token punctuation\">)</span>ï¼‰</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  ï¼ˆ6ï¼‰äº¤é›†ï¼šsinter åˆ—å1 åˆ—å2</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  ï¼ˆ7ï¼‰å¹¶é›†ï¼šsunion åˆ—å1 åˆ—å2</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  ï¼ˆ8ï¼‰æŸ¥æ•°é‡ï¼šscard åˆ—å</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  ï¼ˆ9ï¼‰éšæœºæŸ¥<span class=\"token operator\">&lt;</span>n<span class=\"token operator\">></span>ä¸ªå€¼ï¼šsrandmember åˆ—å <span class=\"token operator\">&lt;</span>n<span class=\"token operator\">></span>ï¼ˆä¸ä¼šä»é›†åˆä¸­åˆ é™¤ï¼‰</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  ï¼ˆ10ï¼‰éšæœºåå‡ºä¸€ä¸ªå€¼ï¼šspop åˆ—å</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  ï¼ˆ11ï¼‰ä»é›†åˆAçš„å€¼ç§»åŠ¨åˆ°é›†åˆBï¼šsmove åˆ—å1 åˆ—å2 å€¼ </pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  ï¼ˆ12ï¼‰å°†å·®é›†å­˜åˆ°æ–°é›†åˆä¸­ï¼šsdiffstore æ–°åˆ—å åˆ—å1 åˆ—å2</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  ï¼ˆ13ï¼‰å°†äº¤é›†å­˜åˆ°æ–°é›†åˆä¸­ï¼šsinterstore æ–°åˆ—å åˆ—å1 åˆ—å2</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  ï¼ˆ14ï¼‰å°†å¹¶é›†å­˜åˆ°æ–°é›†åˆä¸­ï¼šsunionstore æ–°åˆ—å åˆ—å1 åˆ—å2</pre></td></tr></table></figure><h3 id=\"343æ•°æ®ç»“æ„\"><a class=\"markdownIt-Anchor\" href=\"#343æ•°æ®ç»“æ„\">#</a> 3.4.3.\tæ•°æ®ç»“æ„</h3>\n<p>Set æ•°æ®ç»“æ„æ˜¯ dict å­—å…¸ï¼Œå­—å…¸æ˜¯ç”¨ <code>å“ˆå¸Œè¡¨</code> å®ç°çš„ã€‚</p>\n<p>Java ä¸­ HashSet çš„å†…éƒ¨å®ç°ä½¿ç”¨çš„æ˜¯ HashMapï¼Œåªä¸è¿‡æ‰€æœ‰çš„ value éƒ½æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚Redis çš„ set ç»“æ„ä¹Ÿæ˜¯ä¸€æ ·ï¼Œå®ƒçš„å†…éƒ¨ä¹Ÿä½¿ç”¨ hash ç»“æ„ï¼Œæ‰€æœ‰çš„ value éƒ½æŒ‡å‘åŒä¸€ä¸ªå†…éƒ¨å€¼ã€‚</p>\n<h2 id=\"5-rediså“ˆå¸Œhash\"><a class=\"markdownIt-Anchor\" href=\"#5-rediså“ˆå¸Œhash\">#</a> 5 - Redis å“ˆå¸Œ (Hash)</h2>\n<h3 id=\"351ç®€ä»‹\"><a class=\"markdownIt-Anchor\" href=\"#351ç®€ä»‹\">#</a> 3.5.1.\tç®€ä»‹</h3>\n<p>Redis hash æ˜¯ä¸€ä¸ªé”®å€¼å¯¹é›†åˆã€‚</p>\n<p>Redis hash æ˜¯ä¸€ä¸ª string ç±»å‹çš„ <code>field</code>  å’Œ <code>value</code>  çš„æ˜ å°„è¡¨ï¼Œhash ç‰¹åˆ«é€‚åˆç”¨äº <code>å­˜å‚¨å¯¹è±¡</code> ã€‚<br>\nç±»ä¼¼ Java é‡Œé¢çš„ Map&lt;String,Object&gt;</p>\n<p>ç”¨æˆ· ID ä¸ºæŸ¥æ‰¾çš„ keyï¼Œå­˜å‚¨çš„ value ç”¨æˆ·å¯¹è±¡åŒ…å«å§“åï¼Œå¹´é¾„ï¼Œç”Ÿæ—¥ç­‰ä¿¡æ¯ï¼Œå¦‚æœç”¨æ™®é€šçš„ key/value ç»“æ„æ¥å­˜å‚¨</p>\n<p>ä¸»è¦æœ‰ä»¥ä¸‹ 2 ç§å­˜å‚¨æ–¹å¼ï¼š</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220727140611227.png\" alt=\"image-20220727140611227\"></p>\n<h3 id=\"352å¸¸ç”¨å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#352å¸¸ç”¨å‘½ä»¤\">#</a> 3.5.2.\tå¸¸ç”¨å‘½ä»¤</h3>\n<p><code>Hash:</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>å¸¸ç”¨å­˜å‚¨ç±»å‹ï¼ˆHashï¼‰ï¼šæ¯ä¸ªå¯å­˜4294967295ä¸ªé”®å€¼å¯¹</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>å‘½ä»¤: è¡¨å<span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span> åŸŸ<span class=\"token punctuation\">(</span>field<span class=\"token punctuation\">)</span> å€¼<span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  ï¼ˆ1ï¼‰å­˜ï¼šhset è¡¨å åŸŸ å€¼ </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  ï¼ˆ2ï¼‰æ‰¹é‡å­˜ï¼šhmset è¡¨å åŸŸ å€¼ åŸŸ å€¼<span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  ï¼ˆ2ï¼‰å–ï¼šhget è¡¨å åŸŸ</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  ï¼ˆ4ï¼‰æ‰¹é‡å–ï¼šhmget è¡¨å åŸŸ åŸŸ <span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  ï¼ˆ5ï¼‰å–å…¨ï¼šhgetall è¡¨å</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  ï¼ˆ6ï¼‰åˆ é™¤ï¼šhdel è¡¨å åŸŸ<span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  ï¼ˆ7ï¼‰å…¨åˆ ï¼šdel è¡¨å</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  ï¼ˆ8ï¼‰å¢æŒ‡å®šå€¼ï¼šhincrby è¡¨å åŸŸ <span class=\"token punctuation\">[</span>integer<span class=\"token punctuation\">]</span>ï¼ˆä¸€å®šæ˜¯æ•´æ•°ï¼‰</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  ï¼ˆ9ï¼‰åˆ¤æ–­å­˜åœ¨ï¼šhexists è¡¨å åŸŸ <span class=\"token punctuation\">(</span>æŸ¥çœ‹å“ˆå¸Œè¡¨ key ä¸­ï¼Œç»™å®šåŸŸ field æ˜¯å¦å­˜åœ¨<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  ï¼ˆ10ï¼‰è®¾ç½®åŸŸå€¼ï¼šhsetnx è¡¨å f <span class=\"token function\">v</span> ï¼ˆå°†hashè¡¨ä¸­åŸŸfçš„å€¼è®¾ç½®ä¸ºvï¼Œå½“ä¸”ä»…å½“fieldä¸å­˜åœ¨æ—¶ï¼‰</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  ï¼ˆ11ï¼‰é”®å€¼å¯¹æ•°é‡ï¼šhlen è¡¨å</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  ï¼ˆ12ï¼‰å–æ‰€æœ‰åŸŸ<span class=\"token punctuation\">(</span>é”®<span class=\"token punctuation\">)</span>ï¼šhkeys è¡¨åï¼ˆåˆ—å‡ºæ‰€æœ‰çš„fieldï¼‰</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  ï¼ˆ13ï¼‰å–æ‰€æœ‰å€¼ï¼šhvals è¡¨åï¼ˆåˆ—å‡ºæ‰€æœ‰çš„valueï¼‰</pre></td></tr></table></figure><h3 id=\"353æ•°æ®ç»“æ„\"><a class=\"markdownIt-Anchor\" href=\"#353æ•°æ®ç»“æ„\">#</a> 3.5.3.\tæ•°æ®ç»“æ„</h3>\n<p>Hash ç±»å‹å¯¹åº”çš„æ•°æ®ç»“æ„æ˜¯ä¸¤ç§ï¼š <code>ziplist</code> ï¼ˆå‹ç¼©åˆ—è¡¨ï¼‰ï¼Œ <code>hashtable</code> ï¼ˆå“ˆå¸Œè¡¨ï¼‰ã€‚å½“ field-value é•¿åº¦è¾ƒçŸ­ä¸”ä¸ªæ•°è¾ƒå°‘æ—¶ï¼Œä½¿ç”¨ ziplistï¼Œå¦åˆ™ä½¿ç”¨ hashtableã€‚</p>\n<h2 id=\"6-redisæœ‰åºé›†åˆzsetsorted-set\"><a class=\"markdownIt-Anchor\" href=\"#6-redisæœ‰åºé›†åˆzsetsorted-set\">#</a> 6 - Redis æœ‰åºé›†åˆ Zset (sorted set)</h2>\n<h3 id=\"361ç®€ä»‹\"><a class=\"markdownIt-Anchor\" href=\"#361ç®€ä»‹\">#</a> 3.6.1.\tç®€ä»‹</h3>\n<p>Redis æœ‰åºé›†åˆ zset ä¸æ™®é€šé›†åˆ set éå¸¸ç›¸ä¼¼ï¼Œæ˜¯ä¸€ä¸ª <code>æ²¡æœ‰é‡å¤å…ƒç´ </code> çš„å­—ç¬¦ä¸²é›†åˆã€‚</p>\n<p>ä¸åŒä¹‹å¤„æ˜¯æœ‰åºé›†åˆçš„æ¯ä¸ªæˆå‘˜éƒ½å…³è”äº†ä¸€ä¸ª <code>è¯„åˆ†ï¼ˆscoreï¼‰</code> , è¿™ä¸ªè¯„åˆ†ï¼ˆscoreï¼‰è¢«ç”¨æ¥æŒ‰ç…§ä»æœ€ä½åˆ†åˆ°æœ€é«˜åˆ†çš„æ–¹å¼ <code>æ’åº</code> é›†åˆä¸­çš„æˆå‘˜ã€‚<strong>é›†åˆçš„æˆå‘˜æ˜¯å”¯ä¸€çš„ï¼Œä½†æ˜¯è¯„åˆ†å¯ä»¥æ˜¯é‡å¤äº† ã€‚</strong></p>\n<p>å› ä¸ºå…ƒç´ æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥ä½ ä¹Ÿå¯ä»¥å¾ˆå¿«çš„æ ¹æ®è¯„åˆ†ï¼ˆscoreï¼‰æˆ–è€…æ¬¡åºï¼ˆpositionï¼‰æ¥è·å–ä¸€ä¸ªèŒƒå›´çš„å…ƒç´ ã€‚</p>\n<p>è®¿é—®æœ‰åºé›†åˆçš„ä¸­é—´å…ƒç´ ä¹Ÿæ˜¯éå¸¸å¿«çš„ï¼Œå› æ­¤ä½ èƒ½å¤Ÿ<strong>ä½¿ç”¨æœ‰åºé›†åˆä½œä¸ºä¸€ä¸ªæ²¡æœ‰é‡å¤æˆå‘˜</strong>çš„æ™ºèƒ½åˆ—è¡¨ã€‚</p>\n<h3 id=\"362å¸¸ç”¨å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#362å¸¸ç”¨å‘½ä»¤\">#</a> 3.6.2.\tå¸¸ç”¨å‘½ä»¤</h3>\n<p><code>Zset:</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>å‘½ä»¤: é›†åˆå<span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span> è¯„åˆ†<span class=\"token punctuation\">(</span>score<span class=\"token punctuation\">)</span> å€¼<span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  ï¼ˆ1ï¼‰<span class=\"token variable\"><span class=\"token variable\">`</span>å­˜<span class=\"token variable\">`</span></span>ï¼šzadd é›†åˆå è¯„åˆ†1 å€¼1 è¯„åˆ†2 å€¼2<span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  ï¼ˆ2ï¼‰<span class=\"token variable\"><span class=\"token variable\">`</span>æŒ‰ä¸‹æ ‡å–<span class=\"token variable\">`</span></span>ï¼šzrange é›†åˆå ä¸‹æ ‡1 ä¸‹æ ‡2 <span class=\"token punctuation\">[</span>WITHSCORES<span class=\"token punctuation\">]</span> </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  ï¼ˆè¿”å›æœ‰åºé›† key ä¸­ï¼Œä¸‹æ ‡åœ¨<span class=\"token operator\">&lt;</span>ä¸‹æ ‡<span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span> <span class=\"token operator\">&lt;</span>ä¸‹æ ‡<span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span>ä¹‹é—´çš„å…ƒç´ ,å¸¦WITHSCORESï¼Œå¯ä»¥è®©åˆ†æ•°ä¸€èµ·å’Œå€¼è¿”å›åˆ°ç»“æœé›†ï¼‰</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  ï¼ˆ3ï¼‰<span class=\"token variable\"><span class=\"token variable\">`</span>æŒ‰è¯„åˆ†å–<span class=\"token variable\">`</span></span>ï¼šzrangebyscore é›†åˆå min max <span class=\"token punctuation\">[</span>withscores<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>limit offset count<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  ï¼ˆè¿”å›æœ‰åºé›† key ä¸­ï¼Œæ‰€æœ‰ score å€¼ä»‹äº min å’Œ max ä¹‹é—´<span class=\"token punctuation\">(</span>åŒ…æ‹¬ç­‰äº min æˆ– max <span class=\"token punctuation\">)</span>çš„æˆå‘˜ã€‚æœ‰åºé›†æˆå‘˜æŒ‰ score å€¼é€’å¢<span class=\"token punctuation\">(</span>ä»å°åˆ°å¤§<span class=\"token punctuation\">)</span>æ¬¡åºæ’åˆ—ï¼‰</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  ï¼ˆ4ï¼‰<span class=\"token variable\"><span class=\"token variable\">`</span>ä»å¤§åˆ°å°å–<span class=\"token variable\">`</span></span>ï¼šzrevrangebyscore é›†åˆå max min <span class=\"token punctuation\">[</span>withscores<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>limit offset count<span class=\"token punctuation\">]</span>   ï¼ˆåŒä¸Šï¼Œæ”¹ä¸ºä»å¤§åˆ°å°æ’åˆ—ã€‚ï¼‰</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  ï¼ˆ5ï¼‰<span class=\"token variable\"><span class=\"token variable\">`</span>å¢æŒ‡å®šå€¼<span class=\"token variable\">`</span></span>ï¼šzincrby é›†åˆå å¢é‡ å€¼ï¼ˆç»™å€¼åŠ ä¸Šå¢é‡ï¼‰</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  ï¼ˆ6ï¼‰<span class=\"token variable\"><span class=\"token variable\">`</span>åˆ é™¤<span class=\"token variable\">`</span></span>ï¼šzrem é›†åˆå å€¼ </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  ï¼ˆ7ï¼‰<span class=\"token variable\"><span class=\"token variable\">`</span>ç»Ÿè®¡<span class=\"token variable\">`</span></span>ï¼šzcount é›†åˆå min max ï¼ˆç»Ÿè®¡è¯¥é›†åˆï¼Œåˆ†æ•°åŒºé—´å†…çš„å…ƒç´ ä¸ªæ•°ï¼‰</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  ï¼ˆ8ï¼‰<span class=\"token variable\"><span class=\"token variable\">`</span>æ’å<span class=\"token variable\">`</span></span>ï¼šzrank é›†åˆå å€¼ ï¼ˆè¿”å›è¯¥å€¼åœ¨é›†åˆä¸­çš„æ’åï¼Œä»0å¼€å§‹ï¼‰</pre></td></tr></table></figure><p>æ¡ˆä¾‹ï¼šå¦‚ä½•åˆ©ç”¨ zset å®ç°ä¸€ä¸ªæ–‡ç« è®¿é—®é‡çš„æ’è¡Œæ¦œï¼Ÿ</p>\n<h3 id=\"363æ•°æ®ç»“æ„\"><a class=\"markdownIt-Anchor\" href=\"#363æ•°æ®ç»“æ„\">#</a> 3.6.3.\tæ•°æ®ç»“æ„</h3>\n<p>SortedSet (zset) æ˜¯ Redis æä¾›çš„ä¸€ä¸ªéå¸¸ç‰¹åˆ«çš„æ•°æ®ç»“æ„ï¼Œä¸€æ–¹é¢å®ƒç­‰ä»·äº Java çš„æ•°æ®ç»“æ„ Map&lt;String, Double&gt;ï¼Œå¯ä»¥ç»™æ¯ä¸€ä¸ªå…ƒç´  value èµ‹äºˆä¸€ä¸ªæƒé‡ scoreï¼Œå¦ä¸€æ–¹é¢å®ƒåˆç±»ä¼¼äº TreeSetï¼Œå†…éƒ¨çš„å…ƒç´ ä¼šæŒ‰ç…§æƒé‡ score è¿›è¡Œæ’åºï¼Œå¯ä»¥å¾—åˆ°æ¯ä¸ªå…ƒç´ çš„åæ¬¡ï¼Œè¿˜å¯ä»¥é€šè¿‡ score çš„èŒƒå›´æ¥è·å–å…ƒç´ çš„åˆ—è¡¨ã€‚</p>\n<p>zset åº•å±‚ä½¿ç”¨äº†ä¸¤ä¸ªæ•°æ®ç»“æ„<br>\nï¼ˆ1ï¼‰<strong>hash</strong>ï¼Œhash çš„ä½œç”¨å°±æ˜¯å…³è”å…ƒç´  value å’Œæƒé‡ scoreï¼Œä¿éšœå…ƒç´  value çš„å”¯ä¸€æ€§ï¼Œå¯ä»¥é€šè¿‡å…ƒç´  value æ‰¾åˆ°ç›¸åº”çš„ score å€¼ã€‚<br>\nï¼ˆ2ï¼‰<strong>è·³è·ƒè¡¨</strong>ï¼Œè·³è·ƒè¡¨çš„ç›®çš„åœ¨äºç»™å…ƒç´  value æ’åºï¼Œæ ¹æ® score çš„èŒƒå›´è·å–å…ƒç´ åˆ—è¡¨ã€‚</p>\n<h3 id=\"364è·³è·ƒè¡¨è·³è¡¨\"><a class=\"markdownIt-Anchor\" href=\"#364è·³è·ƒè¡¨è·³è¡¨\">#</a> 3.6.4.\tè·³è·ƒè¡¨ï¼ˆè·³è¡¨ï¼‰</h3>\n<p><strong>1ã€ç®€ä»‹</strong></p>\n<p>â€‹\t    æœ‰åºé›†åˆåœ¨ç”Ÿæ´»ä¸­æ¯”è¾ƒå¸¸è§ï¼Œä¾‹å¦‚æ ¹æ®æˆç»©å¯¹å­¦ç”Ÿæ’åï¼Œæ ¹æ®å¾—åˆ†å¯¹ç©å®¶æ’åç­‰ã€‚å¯¹äºæœ‰åºé›†åˆçš„åº•å±‚å®ç°ï¼Œå¯ä»¥ç”¨æ•°ç»„ã€å¹³è¡¡æ ‘ã€é“¾è¡¨ç­‰ã€‚æ•°ç»„ä¸ä¾¿å…ƒç´ çš„æ’å…¥ã€åˆ é™¤ï¼›å¹³è¡¡æ ‘æˆ–çº¢é»‘æ ‘è™½ç„¶æ•ˆç‡é«˜ä½†ç»“æ„å¤æ‚ï¼›é“¾è¡¨æŸ¥è¯¢éœ€è¦éå†æ‰€æœ‰æ•ˆç‡ä½ã€‚Redis é‡‡ç”¨çš„æ˜¯è·³è·ƒè¡¨ã€‚è·³è·ƒè¡¨æ•ˆç‡å ªæ¯”çº¢é»‘æ ‘ï¼Œå®ç°è¿œæ¯”çº¢é»‘æ ‘ç®€å•ã€‚</p>\n<p><strong>2ã€å®ä¾‹</strong></p>\n<p>â€‹\tå¯¹æ¯”æœ‰åºé“¾è¡¨å’Œè·³è·ƒè¡¨ï¼Œä»é“¾è¡¨ä¸­æŸ¥è¯¢å‡º 51</p>\n<p>ï¼ˆ1ï¼‰<strong>æœ‰åºé“¾è¡¨</strong></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220727150205067.png\" alt=\"image-20220727150205067\"></p>\n<p>è¦æŸ¥æ‰¾å€¼ä¸º 51 çš„å…ƒç´ ï¼Œéœ€è¦ä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ä¾æ¬¡æŸ¥æ‰¾ã€æ¯”è¾ƒæ‰èƒ½æ‰¾åˆ°ã€‚å…±éœ€è¦ 6 æ¬¡æ¯”è¾ƒã€‚<br>\nï¼ˆ2ï¼‰<strong>è·³è·ƒè¡¨</strong></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220727150256931.png\" alt=\"image-20220727150256931\"></p>\n<p>ä»ç¬¬ 2 å±‚å¼€å§‹ï¼Œ1 èŠ‚ç‚¹æ¯” 51 èŠ‚ç‚¹å°ï¼Œå‘åæ¯”è¾ƒã€‚</p>\n<p>21 èŠ‚ç‚¹æ¯” 51 èŠ‚ç‚¹å°ï¼Œç»§ç»­å‘åæ¯”è¾ƒï¼Œåé¢å°±æ˜¯ NULL äº†ï¼Œæ‰€ä»¥ä» 21 èŠ‚ç‚¹å‘ä¸‹åˆ°ç¬¬ 1 å±‚</p>\n<p>åœ¨ç¬¬ 1 å±‚ï¼Œ41 èŠ‚ç‚¹æ¯” 51 èŠ‚ç‚¹å°ï¼Œç»§ç»­å‘åï¼Œ61 èŠ‚ç‚¹æ¯” 51 èŠ‚ç‚¹å¤§ï¼Œæ‰€ä»¥ä» 41 å‘ä¸‹</p>\n<p>åœ¨ç¬¬ 0 å±‚ï¼Œ51 èŠ‚ç‚¹ä¸ºè¦æŸ¥æ‰¾çš„èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹è¢«æ‰¾åˆ°ï¼Œå…±æŸ¥æ‰¾ 4 æ¬¡ã€‚</p>\n<p>ä»æ­¤å¯ä»¥çœ‹å‡ºè·³è·ƒè¡¨æ¯”æœ‰åºé“¾è¡¨æ•ˆç‡è¦é«˜</p>\n<h1 id=\"å››-redisé…ç½®æ–‡ä»¶ä»‹ç»\"><a class=\"markdownIt-Anchor\" href=\"#å››-redisé…ç½®æ–‡ä»¶ä»‹ç»\">#</a> å››ã€Redis é…ç½®æ–‡ä»¶ä»‹ç»</h1>\n<p>æˆ‘çš„ç›®å½•ï¼š/opt/redis-6.2.7/redis.conf</p>\n<h2 id=\"1-unitså•ä½\"><a class=\"markdownIt-Anchor\" href=\"#1-unitså•ä½\">#</a> 1- Units å•ä½</h2>\n<p>é…ç½®å¤§å°å•ä½ï¼Œå¼€å¤´å®šä¹‰äº†ä¸€äº›åŸºæœ¬çš„åº¦é‡å•ä½ï¼Œåªæ”¯æŒ bytesï¼Œä¸æ”¯æŒ bit å¤§å°å†™ä¸æ•æ„Ÿ</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220730115141232.png\" alt=\"image-20220730115141232\"></p>\n<h2 id=\"2-includesåŒ…å«\"><a class=\"markdownIt-Anchor\" href=\"#2-includesåŒ…å«\">#</a> 2- INCLUDES åŒ…å«</h2>\n<p>ç±»ä¼¼ jsp ä¸­çš„ includeï¼Œå¤šå®ä¾‹çš„æƒ…å†µå¯ä»¥æŠŠå…¬ç”¨çš„é…ç½®æ–‡ä»¶æå–å‡ºæ¥</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220730115303933.png\" alt=\"image-20220730115303933\"></p>\n<h2 id=\"3-ç½‘ç»œç›¸å…³é…ç½®\"><a class=\"markdownIt-Anchor\" href=\"#3-ç½‘ç»œç›¸å…³é…ç½®\">#</a> 3 - ç½‘ç»œç›¸å…³é…ç½®</h2>\n<h3 id=\"431-bind\"><a class=\"markdownIt-Anchor\" href=\"#431-bind\">#</a> 4.3.1  bind</h3>\n<p>é»˜è®¤æƒ…å†µ bind=127.0.0.1 åªèƒ½æ¥å—æœ¬æœºçš„è®¿é—®è¯·æ±‚</p>\n<p>ä¸å†™çš„æƒ…å†µä¸‹ï¼Œæ— é™åˆ¶æ¥å—ä»»ä½• ip åœ°å€çš„è®¿é—®</p>\n<p>ç”Ÿäº§ç¯å¢ƒè‚¯å®šè¦å†™ä½ åº”ç”¨æœåŠ¡å™¨çš„åœ°å€ï¼›æœåŠ¡å™¨æ˜¯éœ€è¦è¿œç¨‹è®¿é—®çš„ï¼Œæ‰€ä»¥éœ€è¦å°†å…¶æ³¨é‡Šæ‰</p>\n<p><strong>å¦‚æœå¼€å¯äº† protected-modeï¼Œé‚£ä¹ˆåœ¨æ²¡æœ‰è®¾å®š bind ip ä¸”æ²¡æœ‰è®¾å¯†ç çš„æƒ…å†µä¸‹ï¼ŒRedis åªå…è®¸æ¥å—æœ¬æœºçš„å“åº”</strong></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220730141422593.png\" alt=\"image-20220730141422593\"></p>\n<p>ä¿å­˜é…ç½®ï¼Œåœæ­¢æœåŠ¡ï¼Œé‡å¯å¯åŠ¨æŸ¥çœ‹è¿›ç¨‹ï¼Œä¸å†æ˜¯æœ¬æœºè®¿é—®äº†ã€‚</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220730114744786.png\" alt=\"image-20220730114744786\"></p>\n<h3 id=\"432-protected-mode\"><a class=\"markdownIt-Anchor\" href=\"#432-protected-mode\">#</a> 4.3.2.  protected-mode</h3>\n<p>å°†æœ¬æœºè®¿é—®ä¿æŠ¤æ¨¡å¼è®¾ç½® no</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220730141730607.png\" alt=\"image-20220730141730607\"></p>\n<h3 id=\"433-port\"><a class=\"markdownIt-Anchor\" href=\"#433-port\">#</a> 4.3.3 Port</h3>\n<p>ç«¯å£å·ï¼Œé»˜è®¤ 6379</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220730141828893.png\" alt=\"image-20220730141828893\"></p>\n<h3 id=\"434-tcp-backlog\"><a class=\"markdownIt-Anchor\" href=\"#434-tcp-backlog\">#</a> 4.3.4.  tcp-backlog</h3>\n<p>è®¾ç½® tcp çš„ backlogï¼Œbacklog å…¶å®æ˜¯ä¸€ä¸ªè¿æ¥é˜Ÿåˆ—ï¼Œbacklog é˜Ÿåˆ—æ€»å’Œ = æœªå®Œæˆä¸‰æ¬¡æ¡æ‰‹é˜Ÿåˆ— + å·²ç»å®Œæˆä¸‰æ¬¡æ¡æ‰‹é˜Ÿåˆ—ã€‚</p>\n<p>åœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹ä½ éœ€è¦ä¸€ä¸ªé«˜ backlog å€¼æ¥é¿å…æ…¢å®¢æˆ·ç«¯è¿æ¥é—®é¢˜ã€‚</p>\n<p>æ³¨æ„ Linux å†…æ ¸ä¼šå°†è¿™ä¸ªå€¼å‡å°åˆ° /proc/sys/net/core/somaxconn çš„å€¼ï¼ˆ128ï¼‰ï¼Œæ‰€ä»¥éœ€è¦ç¡®è®¤å¢å¤§ /proc/sys/net/core/somaxconn å’Œ /proc/sys/net/ipv4/tcp_max_syn_backlogï¼ˆ128ï¼‰ä¸¤ä¸ªå€¼æ¥è¾¾åˆ°æƒ³è¦çš„æ•ˆæœ</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220730142147649.png\" alt=\"image-20220730142147649\"></p>\n<h3 id=\"435-timeout\"><a class=\"markdownIt-Anchor\" href=\"#435-timeout\">#</a> 4.3.5.  timeout</h3>\n<p>ä¸€ä¸ªç©ºé—²çš„å®¢æˆ·ç«¯ç»´æŒå¤šå°‘ç§’ä¼šå…³é—­ï¼Œ0 è¡¨ç¤ºå…³é—­è¯¥åŠŸèƒ½ã€‚å³<strong>æ°¸ä¸å…³é—­</strong>ã€‚</p>\n<p><img data-src=\"C:%5CUsers%5C22616%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20220730142318928.png\" alt=\"image-20220730142318928\"></p>\n<h3 id=\"436-tcp-keepalive\"><a class=\"markdownIt-Anchor\" href=\"#436-tcp-keepalive\">#</a> 4.3.6.  tcp-keepalive</h3>\n<p>å¯¹è®¿é—®å®¢æˆ·ç«¯çš„ä¸€ç§<strong>å¿ƒè·³æ£€æµ‹</strong>ï¼Œæ¯ä¸ª n ç§’æ£€æµ‹ä¸€æ¬¡ã€‚</p>\n<p>å•ä½ä¸ºç§’ï¼Œå¦‚æœè®¾ç½®ä¸º 0ï¼Œåˆ™ä¸ä¼šè¿›è¡Œ Keepalive æ£€æµ‹ï¼Œå»ºè®®è®¾ç½®æˆ 60</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220730143102388.png\" alt=\"image-20220730143102388\"></p>\n<h2 id=\"4-generalé€šç”¨\"><a class=\"markdownIt-Anchor\" href=\"#4-generalé€šç”¨\">#</a> 4 - GENERAL é€šç”¨</h2>\n<h3 id=\"441-daemonize\"><a class=\"markdownIt-Anchor\" href=\"#441-daemonize\">#</a> 4.4.1.  daemonize</h3>\n<p>æ˜¯å¦ä¸ºåå°è¿›ç¨‹ï¼Œè®¾ç½®ä¸º yes</p>\n<p>å®ˆæŠ¤è¿›ç¨‹ï¼Œåå°å¯åŠ¨</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220730143234823.png\" alt=\"image-20220730143234823\"></p>\n<h3 id=\"442-pidfile\"><a class=\"markdownIt-Anchor\" href=\"#442-pidfile\">#</a> 4.4.2.  pidfile</h3>\n<p>å­˜æ”¾ pid æ–‡ä»¶çš„ä½ç½®ï¼Œæ¯ä¸ªå®ä¾‹ä¼šäº§ç”Ÿä¸€ä¸ªä¸åŒçš„ pid æ–‡ä»¶</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220730143450301.png\" alt=\"image-20220730143450301\"></p>\n<h3 id=\"443-loglevel\"><a class=\"markdownIt-Anchor\" href=\"#443-loglevel\">#</a> 4.4.3.  loglevel</h3>\n<p>æŒ‡å®šæ—¥å¿—è®°å½•çº§åˆ«ï¼ŒRedis æ€»å…±æ”¯æŒå››ä¸ªçº§åˆ«ï¼šdebugã€verboseã€noticeã€warningï¼Œé»˜è®¤ä¸º<strong> notice</strong></p>\n<p><strong>å››ä¸ªçº§åˆ«æ ¹æ®ä½¿ç”¨é˜¶æ®µæ¥é€‰æ‹©ï¼Œç”Ÿäº§ç¯å¢ƒé€‰æ‹© notice æˆ–è€… warning</strong></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220730143541853.png\" alt=\"image-20220730143541853\"></p>\n<h3 id=\"444-logfile\"><a class=\"markdownIt-Anchor\" href=\"#444-logfile\">#</a> 4.4.4.  logfile</h3>\n<p>æ—¥å¿—æ–‡ä»¶åç§°</p>\n<p><img data-src=\"C:%5CUsers%5C22616%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20220730143639134.png\" alt=\"image-20220730143639134\"></p>\n<h3 id=\"445-databases-16\"><a class=\"markdownIt-Anchor\" href=\"#445-databases-16\">#</a> 4.4.5.  databases 16</h3>\n<p>è®¾å®šåº“çš„æ•°é‡ é»˜è®¤ 16ï¼Œé»˜è®¤æ•°æ®åº“ä¸º 0ï¼Œå¯ä»¥ä½¿ç”¨ SELECT <dbid>å‘½ä»¤åœ¨è¿æ¥ä¸ŠæŒ‡å®šæ•°æ®åº“ id</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220730143726917.png\" alt=\"image-20220730143726917\"></p>\n<h2 id=\"5-securityå®‰å…¨\"><a class=\"markdownIt-Anchor\" href=\"#5-securityå®‰å…¨\">#</a> 5 -  SECURITY å®‰å…¨</h2>\n<h3 id=\"551-è®¾ç½®å¯†ç \"><a class=\"markdownIt-Anchor\" href=\"#551-è®¾ç½®å¯†ç \">#</a> 5.5.1.  è®¾ç½®å¯†ç </h3>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220730144004826.png\" alt=\"image-20220730144004826\"></p>\n<p>è®¿é—®å¯†ç çš„æŸ¥çœ‹ã€è®¾ç½®å’Œå–æ¶ˆ</p>\n<p>åœ¨å‘½ä»¤ä¸­è®¾ç½®å¯†ç ï¼Œåªæ˜¯ä¸´æ—¶çš„ã€‚é‡å¯ redis æœåŠ¡å™¨ï¼Œå¯†ç å°±è¿˜åŸäº†ã€‚</p>\n<p>æ°¸ä¹…è®¾ç½®ï¼Œéœ€è¦å†é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œè®¾ç½®ã€‚</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220730144237188.png\" alt=\"image-20220730144237188\"></p>\n<h2 id=\"6-limitsé™åˆ¶\"><a class=\"markdownIt-Anchor\" href=\"#6-limitsé™åˆ¶\">#</a> 6 - LIMITS é™åˆ¶</h2>\n<h3 id=\"661-maxclients\"><a class=\"markdownIt-Anchor\" href=\"#661-maxclients\">#</a> 6.6.1.  maxclients</h3>\n<ul>\n<li>\n<p>è®¾ç½® redis åŒæ—¶å¯ä»¥ä¸å¤šå°‘ä¸ªå®¢æˆ·ç«¯è¿›è¡Œè¿æ¥ã€‚</p>\n</li>\n<li>\n<p>é»˜è®¤æƒ…å†µä¸‹ä¸º 10000 ä¸ªå®¢æˆ·ç«¯ã€‚</p>\n</li>\n<li>\n<p>å¦‚æœè¾¾åˆ°äº†æ­¤é™åˆ¶ï¼Œredis åˆ™ä¼šæ‹’ç»æ–°çš„è¿æ¥è¯·æ±‚ï¼Œå¹¶ä¸”å‘è¿™äº›è¿æ¥è¯·æ±‚æ–¹å‘å‡º â€œmax number of clients reachedâ€ ä»¥ä½œå›åº”ã€‚</p>\n</li>\n</ul>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220730144953788.png\" alt=\"image-20220730144953788\"></p>\n<h3 id=\"662-maxmemory\"><a class=\"markdownIt-Anchor\" href=\"#662-maxmemory\">#</a> 6.6.2.  maxmemory</h3>\n<ul>\n<li>\n<p>å»ºè®®<strong>å¿…é¡»è®¾ç½®</strong>ï¼Œå¦åˆ™ï¼Œå°†å†…å­˜å æ»¡ï¼Œé€ æˆæœåŠ¡å™¨å®•æœº</p>\n</li>\n<li>\n<p>è®¾ç½® redis å¯ä»¥ä½¿ç”¨çš„å†…å­˜é‡ã€‚ä¸€æ—¦åˆ°è¾¾å†…å­˜ä½¿ç”¨ä¸Šé™ï¼Œredis å°†ä¼šè¯•å›¾ç§»é™¤å†…éƒ¨æ•°æ®ï¼Œç§»é™¤è§„åˆ™å¯ä»¥é€šè¿‡<strong> maxmemory-policy</strong> æ¥æŒ‡å®šã€‚</p>\n</li>\n<li>\n<p>å¦‚æœ redis æ— æ³•æ ¹æ®ç§»é™¤è§„åˆ™æ¥ç§»é™¤å†…å­˜ä¸­çš„æ•°æ®ï¼Œæˆ–è€…è®¾ç½®äº† â€œä¸å…è®¸ç§»é™¤â€ï¼Œé‚£ä¹ˆ redis åˆ™ä¼šé’ˆå¯¹é‚£äº›éœ€è¦ç”³è¯·å†…å­˜çš„æŒ‡ä»¤è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œæ¯”å¦‚ SETã€LPUSH ç­‰ã€‚</p>\n</li>\n<li>\n<p>ä½†æ˜¯å¯¹äºæ— å†…å­˜ç”³è¯·çš„æŒ‡ä»¤ï¼Œä»ç„¶ä¼šæ­£å¸¸å“åº”ï¼Œæ¯”å¦‚ GET ç­‰ã€‚å¦‚æœä½ çš„ redis æ˜¯ä¸» redisï¼ˆè¯´æ˜ä½ çš„ redis æœ‰ä» redisï¼‰ï¼Œé‚£ä¹ˆåœ¨è®¾ç½®å†…å­˜ä½¿ç”¨ä¸Šé™æ—¶ï¼Œéœ€è¦åœ¨ç³»ç»Ÿä¸­ç•™å‡ºä¸€äº›å†…å­˜ç©ºé—´ç»™åŒæ­¥é˜Ÿåˆ—ç¼“å­˜ï¼Œåªæœ‰åœ¨ä½ è®¾ç½®çš„æ˜¯ â€œä¸ç§»é™¤â€ çš„æƒ…å†µä¸‹ï¼Œæ‰ä¸ç”¨è€ƒè™‘è¿™ä¸ªå› ç´ ã€‚</p>\n</li>\n</ul>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220730145049188.png\" alt=\"image-20220730145049188\"></p>\n<h3 id=\"663-maxmemory-policy\"><a class=\"markdownIt-Anchor\" href=\"#663-maxmemory-policy\">#</a> 6.6.3.  maxmemory-policy</h3>\n<ul>\n<li>\n<p>volatile-lruï¼šä½¿ç”¨ LRU ç®—æ³•ç§»é™¤ keyï¼Œåªå¯¹è®¾ç½®äº†<strong>è¿‡æœŸæ—¶é—´</strong>çš„é”®ï¼›ï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰</p>\n</li>\n<li>\n<p>allkeys-lruï¼šåœ¨æ‰€æœ‰é›†åˆ key ä¸­ï¼Œä½¿ç”¨ LRU ç®—æ³•ç§»é™¤ key</p>\n</li>\n<li>\n<p>volatile-randomï¼šåœ¨è¿‡æœŸé›†åˆä¸­ç§»é™¤éšæœºçš„ keyï¼Œåªå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®</p>\n</li>\n<li>\n<p>allkeys-randomï¼šåœ¨æ‰€æœ‰é›†åˆ key ä¸­ï¼Œç§»é™¤éšæœºçš„ key</p>\n</li>\n<li>\n<p>volatile-ttlï¼šç§»é™¤é‚£äº› TTL å€¼æœ€å°çš„ keyï¼Œå³é‚£äº›æœ€è¿‘è¦è¿‡æœŸçš„ key</p>\n</li>\n<li>\n<p>noevictionï¼šä¸è¿›è¡Œç§»é™¤ã€‚é’ˆå¯¹å†™æ“ä½œï¼Œåªæ˜¯è¿”å›é”™è¯¯ä¿¡æ¯</p>\n</li>\n</ul>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220730145143860.png\" alt=\"image-20220730145143860\"></p>\n<h3 id=\"664-maxmemory-samples\"><a class=\"markdownIt-Anchor\" href=\"#664-maxmemory-samples\">#</a> 6.6.4.  maxmemory-samples</h3>\n<ul>\n<li>\n<p>è®¾ç½®æ ·æœ¬æ•°é‡ï¼ŒLRU ç®—æ³•å’Œæœ€å° TTL ç®—æ³•éƒ½å¹¶éæ˜¯ç²¾ç¡®çš„ç®—æ³•ï¼Œè€Œæ˜¯ä¼°ç®—å€¼ï¼Œæ‰€ä»¥ä½ å¯ä»¥è®¾ç½®æ ·æœ¬çš„å¤§å°ï¼Œredis é»˜è®¤ä¼šæ£€æŸ¥è¿™ä¹ˆå¤šä¸ª key å¹¶é€‰æ‹©å…¶ä¸­ LRU çš„é‚£ä¸ªã€‚</p>\n</li>\n<li>\n<p>ä¸€èˆ¬è®¾ç½® 3 åˆ° 7 çš„æ•°å­—ï¼Œæ•°å€¼è¶Šå°æ ·æœ¬è¶Šä¸å‡†ç¡®ï¼Œä½†æ€§èƒ½æ¶ˆè€—è¶Šå°ã€‚</p>\n</li>\n</ul>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220730145234892.png\" alt=\"image-20220730145234892\"></p>\n<h1 id=\"äº”-redisçš„å‘å¸ƒå’Œè®¢é˜…\"><a class=\"markdownIt-Anchor\" href=\"#äº”-redisçš„å‘å¸ƒå’Œè®¢é˜…\">#</a> äº”ã€Redis çš„å‘å¸ƒå’Œè®¢é˜…</h1>\n<h2 id=\"1-ä»€ä¹ˆæ˜¯å‘å¸ƒå’Œè®¢é˜…\"><a class=\"markdownIt-Anchor\" href=\"#1-ä»€ä¹ˆæ˜¯å‘å¸ƒå’Œè®¢é˜…\">#</a> 1- ä»€ä¹ˆæ˜¯å‘å¸ƒå’Œè®¢é˜…</h2>\n<p>Redis å‘å¸ƒè®¢é˜… (pub/sub) æ˜¯ä¸€ç§æ¶ˆæ¯é€šä¿¡æ¨¡å¼ï¼šå‘é€è€… (pub) å‘é€æ¶ˆæ¯ï¼Œè®¢é˜…è€… (sub) æ¥æ”¶æ¶ˆæ¯ã€‚</p>\n<p>Redis å®¢æˆ·ç«¯å¯ä»¥è®¢é˜…ä»»æ„æ•°é‡çš„é¢‘é“ã€‚</p>\n<h2 id=\"2-redisçš„å‘å¸ƒå’Œè®¢é˜…\"><a class=\"markdownIt-Anchor\" href=\"#2-redisçš„å‘å¸ƒå’Œè®¢é˜…\">#</a> 2- Redis çš„å‘å¸ƒå’Œè®¢é˜…</h2>\n<p>1ã€å®¢æˆ·ç«¯å¯ä»¥è®¢é˜…é¢‘é“å¦‚ä¸‹å›¾</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220730145408989.png\" alt=\"image-20220730145408989\"></p>\n<p>2ã€å½“ç»™è¿™ä¸ªé¢‘é“å‘å¸ƒæ¶ˆæ¯åï¼Œæ¶ˆæ¯å°±ä¼šå‘é€ç»™è®¢é˜…çš„å®¢æˆ·ç«¯</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220730145420014.png\" alt=\"image-20220730145420014\"></p>\n<h2 id=\"3-å‘å¸ƒè®¢é˜…å‘½ä»¤è¡Œå®ç°\"><a class=\"markdownIt-Anchor\" href=\"#3-å‘å¸ƒè®¢é˜…å‘½ä»¤è¡Œå®ç°\">#</a> 3- å‘å¸ƒè®¢é˜…å‘½ä»¤è¡Œå®ç°</h2>\n<p>1ã€\tæ‰“å¼€ä¸€ä¸ªå®¢æˆ·ç«¯è®¢é˜… channel1<br>\nSUBSCRIBE channel1</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220730145530661.png\" alt=\"image-20220730145530661\"></p>\n<p>2ã€æ‰“å¼€å¦ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œç»™ channel1 å‘å¸ƒæ¶ˆæ¯ hello<br>\npublish channel1 hello</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220730145549967.png\" alt=\"image-20220730145549967\"></p>\n<p>è¿”å›çš„ 1 æ˜¯è®¢é˜…è€…æ•°é‡<br>\n 3ã€æ‰“å¼€ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯å¯ä»¥çœ‹åˆ°å‘é€çš„æ¶ˆæ¯</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220730145629320.png\" alt=\"image-20220730145629320\"></p>\n<p>æ³¨ï¼šå‘å¸ƒçš„æ¶ˆæ¯æ²¡æœ‰æŒä¹…åŒ–ï¼Œå¦‚æœåœ¨è®¢é˜…çš„å®¢æˆ·ç«¯æ”¶ä¸åˆ° helloï¼Œåªèƒ½æ”¶åˆ°è®¢é˜…åå‘å¸ƒçš„æ¶ˆæ¯</p>\n<h1 id=\"å…­-redisæ–°æ•°æ®ç±»å‹\"><a class=\"markdownIt-Anchor\" href=\"#å…­-redisæ–°æ•°æ®ç±»å‹\">#</a> å…­ã€Redis æ–°æ•°æ®ç±»å‹</h1>\n<h2 id=\"1-bitmaps\"><a class=\"markdownIt-Anchor\" href=\"#1-bitmaps\">#</a> 1- Bitmaps</h2>\n<h3 id=\"611ç®€ä»‹\"><a class=\"markdownIt-Anchor\" href=\"#611ç®€ä»‹\">#</a> 6.1.1.\tç®€ä»‹</h3>\n<p>ç°ä»£è®¡ç®—æœºç”¨äºŒè¿›åˆ¶ï¼ˆä½ï¼‰ ä½œä¸ºä¿¡æ¯çš„åŸºç¡€å•ä½ï¼Œ 1 ä¸ªå­—èŠ‚ç­‰äº 8 ä½ï¼Œ ä¾‹å¦‚ â€œabcâ€ å­—ç¬¦ä¸²æ˜¯ç”± 3 ä¸ªå­—èŠ‚ç»„æˆï¼Œ ä½†å®é™…åœ¨è®¡ç®—æœºå­˜å‚¨æ—¶å°†å…¶ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œ â€œabcâ€ åˆ†åˆ«å¯¹åº”çš„ ASCII ç åˆ†åˆ«æ˜¯ 97ã€ 98ã€ 99ï¼Œ å¯¹åº”çš„äºŒè¿›åˆ¶åˆ†åˆ«æ˜¯ 01100001ã€ 01100010 å’Œ 01100011ï¼Œå¦‚ä¸‹å›¾</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220730145703500.png\" alt=\"image-20220730145703500\"></p>\n<p>åˆç†åœ°ä½¿ç”¨æ“ä½œä½èƒ½å¤Ÿæœ‰æ•ˆåœ°æé«˜å†…å­˜ä½¿ç”¨ç‡å’Œå¼€å‘æ•ˆç‡ã€‚<br>\nRedis æä¾›äº† Bitmaps è¿™ä¸ª â€œæ•°æ®ç±»å‹â€ å¯ä»¥å®ç°å¯¹ä½çš„æ“ä½œï¼š<br>\nï¼ˆ1ï¼‰\tBitmaps æœ¬èº«ä¸æ˜¯ä¸€ç§æ•°æ®ç±»å‹ï¼Œ å®é™…ä¸Šå®ƒå°±æ˜¯å­—ç¬¦ä¸²ï¼ˆkey-valueï¼‰ ï¼Œ ä½†æ˜¯å®ƒå¯ä»¥å¯¹å­—ç¬¦ä¸²çš„ä½è¿›è¡Œæ“ä½œã€‚<br>\nï¼ˆ2ï¼‰\tBitmaps å•ç‹¬æä¾›äº†ä¸€å¥—å‘½ä»¤ï¼Œ æ‰€ä»¥åœ¨ Redis ä¸­ä½¿ç”¨ Bitmaps å’Œä½¿ç”¨å­—ç¬¦ä¸²çš„æ–¹æ³•ä¸å¤ªç›¸åŒã€‚ å¯ä»¥æŠŠ Bitmaps æƒ³è±¡æˆä¸€ä¸ªä»¥ä½ä¸ºå•ä½çš„æ•°ç»„ï¼Œ æ•°ç»„çš„æ¯ä¸ªå•å…ƒåªèƒ½å­˜å‚¨ 0 å’Œ 1ï¼Œ æ•°ç»„çš„ä¸‹æ ‡åœ¨ Bitmaps ä¸­å«åšåç§»é‡ã€‚</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220730145718081.png\" alt=\"image-20220730145718081\"></p>\n<h3 id=\"612å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#612å‘½ä»¤\">#</a> 6.1.2.\tå‘½ä»¤</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>å‘½ä»¤ï¼š</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  ï¼ˆ1ï¼‰å­˜ï¼šsetbit</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  ï¼ˆ2ï¼‰å–ï¼šgetbit</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  ï¼ˆ3ï¼‰ç»Ÿè®¡ï¼šbitcount</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  ï¼ˆ4ï¼‰å¹¶/äº¤/å¼‚æˆ–æ“ä½œï¼šbitop</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>è¯¦è§ä¸‹åˆ—å¾ˆå®ä¾‹ç¤ºèŒƒã€‚</pre></td></tr></table></figure><p>1ã€ <code>setbit</code> <br>\nï¼ˆ1ï¼‰æ ¼å¼<br>\n **setbit<key><offset><value>** è®¾ç½® Bitmaps ä¸­æŸä¸ªåç§»é‡çš„å€¼ï¼ˆ0 æˆ– 1ï¼‰</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220730145758337.png\" alt=\"image-20220730145758337\"></p>\n<p><code>offset</code> ï¼šåç§»é‡ä» 0 å¼€å§‹</p>\n<p>ï¼ˆ2ï¼‰å®ä¾‹<br>\næ¯ä¸ªç‹¬ç«‹ç”¨æˆ·æ˜¯å¦è®¿é—®è¿‡ç½‘ç«™å­˜æ”¾åœ¨ Bitmaps ä¸­ï¼Œ å°†è®¿é—®çš„ç”¨æˆ·è®°åš 1ï¼Œ æ²¡æœ‰è®¿é—®çš„ç”¨æˆ·è®°åš 0ï¼Œ ç”¨åç§»é‡ä½œä¸ºç”¨æˆ·çš„ idã€‚<br>\nè®¾ç½®é”®çš„ç¬¬ offset ä¸ªä½çš„å€¼ï¼ˆä» 0 ç®—èµ·ï¼‰ ï¼Œ å‡è®¾ç°åœ¨æœ‰ 20 ä¸ªç”¨æˆ·ï¼Œuserid=1ï¼Œ 6ï¼Œ 11ï¼Œ 15ï¼Œ 19 çš„ç”¨æˆ·å¯¹ç½‘ç«™è¿›è¡Œäº†è®¿é—®ï¼Œ é‚£ä¹ˆå½“å‰ Bitmaps åˆå§‹åŒ–ç»“æœå¦‚å›¾</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220730145816388.png\" alt=\"image-20220730145816388\"></p>\n<p>unique:users:20201106 ä»£è¡¨ 2020-11-06 è¿™å¤©çš„ç‹¬ç«‹è®¿é—®ç”¨æˆ·çš„ Bitmaps</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220730150000867.png\" alt=\"image-20220730150000867\"></p>\n<p>æ³¨ï¼šğŸ’¡<br>\nå¾ˆå¤šåº”ç”¨çš„ç”¨æˆ· id ä»¥ä¸€ä¸ªæŒ‡å®šæ•°å­—ï¼ˆä¾‹å¦‚ 10000ï¼‰ å¼€å¤´ï¼Œ ç›´æ¥å°†ç”¨æˆ· id å’Œ Bitmaps çš„åç§»é‡å¯¹åº”åŠ¿å¿…ä¼šé€ æˆä¸€å®šçš„æµªè´¹ï¼Œ é€šå¸¸çš„åšæ³•æ˜¯æ¯æ¬¡åš setbit æ“ä½œæ—¶å°†ç”¨æˆ· id å‡å»è¿™ä¸ªæŒ‡å®šæ•°å­—ã€‚<br>\nåœ¨ç¬¬ä¸€æ¬¡åˆå§‹åŒ– Bitmaps æ—¶ï¼Œ å‡å¦‚åç§»é‡éå¸¸å¤§ï¼Œ é‚£ä¹ˆæ•´ä¸ªåˆå§‹åŒ–è¿‡ç¨‹æ‰§è¡Œä¼šæ¯”è¾ƒæ…¢ï¼Œ å¯èƒ½ä¼šé€ æˆ Redis çš„é˜»å¡ã€‚</p>\n<p>2ã€ <code>getbit</code> <br>\nï¼ˆ1ï¼‰æ ¼å¼<br>\n **getbit<key><offset>** è·å– Bitmaps ä¸­æŸä¸ªåç§»é‡çš„å€¼</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220730150357659.png\" alt=\"image-20220730150357659\"></p>\n<p>è·å–é”®çš„ç¬¬ offset ä½çš„å€¼ï¼ˆä» 0 å¼€å§‹ç®—ï¼‰</p>\n<p>ï¼ˆ2ï¼‰å®ä¾‹<br>\nè·å– id=8 çš„ç”¨æˆ·æ˜¯å¦åœ¨ 2020-11-06 è¿™å¤©è®¿é—®è¿‡ï¼Œ è¿”å› 0 è¯´æ˜æ²¡æœ‰è®¿é—®è¿‡ï¼š</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220730150425467.png\" alt=\"image-20220730150425467\"></p>\n<p>æ³¨ï¼šå› ä¸º 100 æ ¹æœ¬ä¸å­˜åœ¨ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯è¿”å› 0</p>\n<p>3ã€ <code>bitcount</code> <br>\n<strong> ç»Ÿè®¡å­—ç¬¦ä¸²</strong>è¢«è®¾ç½®ä¸º 1 çš„ bit æ•°ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç»™å®šçš„æ•´ä¸ªå­—ç¬¦ä¸²éƒ½ä¼šè¢«è¿›è¡Œè®¡æ•°ï¼Œé€šè¿‡æŒ‡å®šé¢å¤–çš„ start æˆ– end å‚æ•°ï¼Œå¯ä»¥è®©è®¡æ•°åªåœ¨ç‰¹å®šçš„ä½ä¸Šè¿›è¡Œã€‚start å’Œ end å‚æ•°çš„è®¾ç½®ï¼Œéƒ½å¯ä»¥ä½¿ç”¨è´Ÿæ•°å€¼ï¼šæ¯”å¦‚ -1 è¡¨ç¤ºæœ€åä¸€ä¸ªä½ï¼Œè€Œ -2 è¡¨ç¤ºå€’æ•°ç¬¬äºŒä¸ªä½ï¼Œstartã€end æ˜¯æŒ‡ bit ç»„çš„å­—èŠ‚çš„<strong>ä¸‹æ ‡æ•°</strong>ï¼ŒäºŒè€…çš†åŒ…å«ã€‚<br>\nï¼ˆ1ï¼‰æ ¼å¼<br>\n<strong> bitcount<key>[start end]</strong> ç»Ÿè®¡å­—ç¬¦ä¸²ä» start å­—èŠ‚åˆ° end å­—èŠ‚æ¯”ç‰¹å€¼ä¸º 1 çš„æ•°é‡</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220730150503473.png\" alt=\"image-20220730150503473\"></p>\n<p>ï¼ˆ2ï¼‰å®ä¾‹<br>\nè®¡ç®— 2022-11-06 è¿™å¤©çš„ç‹¬ç«‹è®¿é—®ç”¨æˆ·æ•°é‡</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220730150516584.png\" alt=\"image-20220730150516584\"></p>\n<p>start å’Œ end ä»£è¡¨èµ·å§‹å’Œç»“æŸå­—èŠ‚æ•°ï¼Œ ä¸‹é¢æ“ä½œè®¡ç®—ç”¨æˆ· id åœ¨ç¬¬ 1 ä¸ªå­—èŠ‚åˆ°ç¬¬ 3 ä¸ªå­—èŠ‚ä¹‹é—´çš„ç‹¬ç«‹è®¿é—®ç”¨æˆ·æ•°ï¼Œ å¯¹åº”çš„ç”¨æˆ· id æ˜¯ 11ï¼Œ 15ï¼Œ 19ã€‚</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220730150532060.png\" alt=\"image-20220730150532060\"></p>\n<p>ä¸¾ä¾‹ï¼šğŸ’¡</p>\n<p>K1 ã€01000001 01000000  00000000 00100001ã€‘ï¼Œå¯¹åº”ã€0ï¼Œ1ï¼Œ2ï¼Œ3ã€‘</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>bitcount K1 <span class=\"token number\">1</span> <span class=\"token number\">2</span> ï¼š ç»Ÿè®¡ä¸‹æ ‡1ã€2å­—èŠ‚ç»„ä¸­bit<span class=\"token operator\">=</span><span class=\"token number\">1</span>çš„ä¸ªæ•°ï¼Œå³01000000  00000000 --ã€‹  bitcount K1 <span class=\"token number\">1</span> <span class=\"token number\">2</span>  --ã€‹  <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>bitcount K1 <span class=\"token number\">1</span> <span class=\"token number\">3</span>  ï¼š ç»Ÿè®¡ä¸‹æ ‡1ã€2å­—èŠ‚ç»„ä¸­bit<span class=\"token operator\">=</span><span class=\"token number\">1</span>çš„ä¸ªæ•°ï¼Œå³01000000  00000000 00100001  --ã€‹bitcount K1 <span class=\"token number\">1</span> <span class=\"token number\">3</span>  --ã€‹3</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>bitcount K1 <span class=\"token number\">0</span> <span class=\"token parameter variable\">-2</span>  ï¼š ç»Ÿè®¡ä¸‹æ ‡0åˆ°ä¸‹æ ‡å€’æ•°ç¬¬2ï¼Œå­—èŠ‚ç»„ä¸­bit<span class=\"token operator\">=</span><span class=\"token number\">1</span>çš„ä¸ªæ•°ï¼Œå³01000001  01000000   00000000   --ã€‹bitcount K1 <span class=\"token number\">0</span> <span class=\"token parameter variable\">-2</span>   --ã€‹3</pre></td></tr></table></figure><p>æ³¨æ„ï¼šğŸ’¡redis çš„ setbit è®¾ç½®æˆ–æ¸…é™¤çš„æ˜¯ bit ä½ç½®ï¼Œè€Œ bitcount è®¡ç®—çš„æ˜¯ byte ä½ç½®ã€‚bitï¼ˆä½ï¼‰byteï¼ˆå­—èŠ‚ï¼‰</p>\n<p>4ã€ <code>bitop</code> <br>\n (1) æ ¼å¼<br>\n<strong> bitop  and (or/not/xor) <destkey> [keyâ€¦]</strong></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731112131913.png\" alt=\"image-20220731112131913\"></p>\n<p>bitop æ˜¯ä¸€ä¸ªå¤åˆæ“ä½œï¼Œ å®ƒå¯ä»¥åšå¤šä¸ª Bitmaps çš„ andï¼ˆäº¤é›†ï¼‰ ã€ orï¼ˆå¹¶é›†ï¼‰ ã€ notï¼ˆéï¼‰ ã€ xorï¼ˆå¼‚æˆ–ï¼‰ æ“ä½œå¹¶å°†ç»“æœä¿å­˜åœ¨ destkey ä¸­ã€‚</p>\n<p>(2) å®ä¾‹</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">2020</span>-11-04 æ—¥è®¿é—®ç½‘ç«™çš„userid<span class=\"token operator\">=</span><span class=\"token number\">1,2</span>,5,9ã€‚</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>setbit unique:users:20201104 <span class=\"token number\">1</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>setbit unique:users:20201104 <span class=\"token number\">2</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>setbit unique:users:20201104 <span class=\"token number\">5</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>setbit unique:users:20201104 <span class=\"token number\">9</span> <span class=\"token number\">1</span></pre></td></tr></table></figure><figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">2020</span>-11-03 æ—¥è®¿é—®ç½‘ç«™çš„userid<span class=\"token operator\">=</span><span class=\"token number\">0,1</span>,4,9ã€‚</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>setbit unique:users:20201103 <span class=\"token number\">0</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>setbit unique:users:20201103 <span class=\"token number\">1</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>setbit unique:users:20201103 <span class=\"token number\">4</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>setbit unique:users:20201103 <span class=\"token number\">9</span> <span class=\"token number\">1</span></pre></td></tr></table></figure><p>è®¡ç®—å‡ºä¸¤å¤©éƒ½è®¿é—®è¿‡ç½‘ç«™çš„ç”¨æˆ·æ•°é‡</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>bitop and unique:users:and:20201104_03</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> unique:users:20201103 unique:users:20201104</pre></td></tr></table></figure><p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731112424506.png\" alt=\"image-20220731112424506\"></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731112608764.png\" alt=\"image-20220731112608764\"></p>\n<p>è®¡ç®—å‡ºä»»æ„ä¸€å¤©éƒ½è®¿é—®è¿‡ç½‘ç«™çš„ç”¨æˆ·æ•°é‡ï¼ˆä¾‹å¦‚æœˆæ´»è·ƒå°±æ˜¯ç±»ä¼¼è¿™ç§ï¼‰ ï¼Œ å¯ä»¥ä½¿ç”¨ or æ±‚å¹¶é›†</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731112642593.png\" alt=\"image-20220731112642593\"></p>\n<h3 id=\"613bitmapsä¸setå¯¹æ¯”\"><a class=\"markdownIt-Anchor\" href=\"#613bitmapsä¸setå¯¹æ¯”\">#</a> 6.1.3.\tBitmaps ä¸ set å¯¹æ¯”</h3>\n<p>å‡è®¾ç½‘ç«™æœ‰ 1 äº¿ç”¨æˆ·ï¼Œ æ¯å¤©ç‹¬ç«‹è®¿é—®çš„ç”¨æˆ·æœ‰ 5 åƒä¸‡ï¼Œ å¦‚æœæ¯å¤©ç”¨é›†åˆç±»å‹å’Œ Bitmaps åˆ†åˆ«å­˜å‚¨æ´»è·ƒç”¨æˆ·å¯ä»¥å¾—åˆ°è¡¨<br>\n<img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731112759996.png\" alt=\"image-20220731112759996\"></p>\n<p>å¾ˆæ˜æ˜¾ï¼Œ è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨ Bitmaps èƒ½èŠ‚çœå¾ˆå¤šçš„å†…å­˜ç©ºé—´ï¼Œ å°¤å…¶æ˜¯éšç€æ—¶é—´æ¨ç§»èŠ‚çœçš„å†…å­˜è¿˜æ˜¯éå¸¸å¯è§‚çš„</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731112933430.png\" alt=\"image-20220731112933430\"></p>\n<p>ä½† Bitmaps å¹¶ä¸æ˜¯ä¸‡é‡‘æ²¹ï¼Œ å‡å¦‚è¯¥ç½‘ç«™æ¯å¤©çš„ç‹¬ç«‹è®¿é—®ç”¨æˆ·å¾ˆå°‘ï¼Œ ä¾‹å¦‚åªæœ‰ 10 ä¸‡ï¼ˆå¤§é‡çš„åƒµå°¸ç”¨æˆ·ï¼‰ ï¼Œ é‚£ä¹ˆä¸¤è€…çš„å¯¹æ¯”å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼Œ å¾ˆæ˜¾ç„¶ï¼Œ è¿™æ—¶å€™ä½¿ç”¨ Bitmaps å°±ä¸å¤ªåˆé€‚äº†ï¼Œ å› ä¸ºåŸºæœ¬ä¸Šå¤§éƒ¨åˆ†ä½éƒ½æ˜¯ 0ã€‚<br>\n<img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731112959496.png\" alt=\"image-20220731112959496\"></p>\n<h2 id=\"2-hyperloglog\"><a class=\"markdownIt-Anchor\" href=\"#2-hyperloglog\">#</a> 2 - HyperLogLog</h2>\n<h3 id=\"621ç®€ä»‹\"><a class=\"markdownIt-Anchor\" href=\"#621ç®€ä»‹\">#</a> 6.2.1.\tç®€ä»‹</h3>\n<p>åœ¨å·¥ä½œå½“ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°ä¸ç»Ÿè®¡ç›¸å…³çš„åŠŸèƒ½éœ€æ±‚ï¼Œæ¯”å¦‚ç»Ÿè®¡ç½‘ç«™ PVï¼ˆPageView é¡µé¢è®¿é—®é‡ï¼‰, å¯ä»¥ä½¿ç”¨ Redis çš„ incrã€incrby è½»æ¾å®ç°ã€‚</p>\n<p>ä½†åƒ UVï¼ˆUniqueVisitorï¼Œç‹¬ç«‹è®¿å®¢ï¼‰ã€ç‹¬ç«‹ IP æ•°ã€æœç´¢è®°å½•æ•°ç­‰éœ€è¦å»é‡å’Œè®¡æ•°çš„é—®é¢˜å¦‚ä½•è§£å†³ï¼Ÿè¿™ç§æ±‚é›†åˆä¸­ä¸é‡å¤å…ƒç´ ä¸ªæ•°çš„é—®é¢˜ç§°ä¸ºåŸºæ•°é—®é¢˜ã€‚</p>\n<p><strong>è§£å†³åŸºæ•°é—®é¢˜æœ‰å¾ˆå¤šç§æ–¹æ¡ˆï¼š</strong><br>\nï¼ˆ1ï¼‰æ•°æ®å­˜å‚¨åœ¨ MySQL è¡¨ä¸­ï¼Œä½¿ç”¨ distinct count è®¡ç®—ä¸é‡å¤ä¸ªæ•°<br>\nï¼ˆ2ï¼‰ä½¿ç”¨ Redis æä¾›çš„ hashã€setã€bitmaps ç­‰æ•°æ®ç»“æ„æ¥å¤„ç†</p>\n<p>ä»¥ä¸Šçš„æ–¹æ¡ˆç»“æœç²¾ç¡®ï¼Œä½†éšç€æ•°æ®ä¸æ–­å¢åŠ ï¼Œå¯¼è‡´å ç”¨ç©ºé—´è¶Šæ¥è¶Šå¤§ï¼Œå¯¹äºéå¸¸å¤§çš„æ•°æ®é›†æ˜¯ä¸åˆ‡å®é™…çš„ã€‚</p>\n<p>èƒ½å¦èƒ½å¤Ÿé™ä½ä¸€å®šçš„ç²¾åº¦æ¥å¹³è¡¡å­˜å‚¨ç©ºé—´ï¼ŸRedis æ¨å‡ºäº† HyperLogLog</p>\n<p>Redis HyperLogLog æ˜¯ç”¨æ¥åšåŸºæ•°ç»Ÿè®¡çš„ç®—æ³•ï¼ŒHyperLogLog çš„ä¼˜ç‚¹æ˜¯ï¼Œåœ¨è¾“å…¥å…ƒç´ çš„æ•°é‡æˆ–è€…ä½“ç§¯éå¸¸éå¸¸å¤§æ—¶ï¼Œè®¡ç®—åŸºæ•°æ‰€éœ€çš„ç©ºé—´æ€»æ˜¯å›ºå®šçš„ã€å¹¶ä¸”æ˜¯å¾ˆå°çš„ã€‚</p>\n<p>åœ¨ Redis é‡Œé¢ï¼Œæ¯ä¸ª HyperLogLog é”®åªéœ€è¦èŠ±è´¹ 12 KB å†…å­˜ï¼Œå°±å¯ä»¥è®¡ç®—æ¥è¿‘ 2^64 ä¸ªä¸åŒå…ƒç´ çš„åŸºæ•°ã€‚è¿™å’Œè®¡ç®—åŸºæ•°æ—¶ï¼Œå…ƒç´ è¶Šå¤šè€—è´¹å†…å­˜å°±è¶Šå¤šçš„é›†åˆå½¢æˆé²œæ˜å¯¹æ¯”ã€‚</p>\n<p>ä½†æ˜¯ï¼Œå› ä¸º HyperLogLog åªä¼šæ ¹æ®è¾“å…¥å…ƒç´ æ¥è®¡ç®—åŸºæ•°ï¼Œè€Œä¸ä¼šå‚¨å­˜è¾“å…¥å…ƒç´ æœ¬èº«ï¼Œæ‰€ä»¥ HyperLogLog ä¸èƒ½åƒé›†åˆé‚£æ ·ï¼Œè¿”å›è¾“å…¥çš„å„ä¸ªå…ƒç´ ã€‚</p>\n<p>ä»€ä¹ˆæ˜¯åŸºæ•°ï¼Ÿ<br>\n æ¯”å¦‚æ•°æ®é›† {1, 3, 5, 7, 5, 7, 8}ï¼Œ é‚£ä¹ˆè¿™ä¸ªæ•°æ®é›†çš„åŸºæ•°é›†ä¸º {1, 3, 5 ,7, 8}, åŸºæ•° (ä¸é‡å¤å…ƒç´ ) ä¸º 5ã€‚ åŸºæ•°ä¼°è®¡å°±æ˜¯åœ¨è¯¯å·®å¯æ¥å—çš„èŒƒå›´å†…ï¼Œå¿«é€Ÿè®¡ç®—åŸºæ•°ã€‚</p>\n<h3 id=\"622å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#622å‘½ä»¤\">#</a> 6.2.2.\tå‘½ä»¤</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>å‘½ä»¤ï¼š</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  ï¼ˆ1ï¼‰å­˜ï¼špfadd</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  ï¼ˆ2ï¼‰å»é‡ç»Ÿè®¡ï¼ˆå¯å¹¶é›†ï¼‰ï¼špfcount</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  ï¼ˆ3ï¼‰å–å¹¶é›†<span class=\"token punctuation\">(</span>ç”Ÿæˆæ–°æ•°æ®<span class=\"token punctuation\">)</span>ï¼špfmerge</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>è¯¦è§ä¸‹åˆ—å®ä¾‹</pre></td></tr></table></figure><p>1ã€ <code>pfadd </code> <br>\nï¼ˆ1ï¼‰æ ¼å¼<br>\n<strong> pfadd <key>&lt; element&gt; [element â€¦]</strong>   æ·»åŠ æŒ‡å®šå…ƒç´ åˆ° HyperLogLog ä¸­</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731161114528.png\" alt=\"image-20220731161114528\"></p>\n<p>ï¼ˆ2ï¼‰å®ä¾‹</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731161148573.png\" alt=\"image-20220731161148573\"></p>\n<p>å°†æ‰€æœ‰å…ƒç´ æ·»åŠ åˆ°æŒ‡å®š HyperLogLog æ•°æ®ç»“æ„ä¸­ã€‚å¦‚æœæ‰§è¡Œå‘½ä»¤å HLL ä¼°è®¡çš„è¿‘ä¼¼åŸºæ•°å‘ç”Ÿå˜åŒ–ï¼Œåˆ™è¿”å› 1ï¼Œå¦åˆ™è¿”å› 0ã€‚</p>\n<p>2ã€ <code>pfcount</code> <br>\nï¼ˆ1ï¼‰æ ¼å¼<br>\n<strong> pfcount<key> [key â€¦]</strong> è®¡ç®— HLL çš„è¿‘ä¼¼åŸºæ•°ï¼Œå¯ä»¥è®¡ç®—å¤šä¸ª HLLï¼Œæ¯”å¦‚ç”¨ HLL å­˜å‚¨æ¯å¤©çš„ UVï¼Œè®¡ç®—ä¸€å‘¨çš„ UV å¯ä»¥ä½¿ç”¨ 7 å¤©çš„ UV åˆå¹¶è®¡ç®—å³å¯</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731161256514.png\" alt=\"image-20220731161256514\"></p>\n<p>ï¼ˆ2ï¼‰å®ä¾‹</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731161305107.png\" alt=\"image-20220731161305107\"></p>\n<p>3ã€ <code>pfmerge</code> <br>\nï¼ˆ1ï¼‰æ ¼å¼<br>\n<strong> pfmerge<destkey><sourcekey> [sourcekey â€¦]</strong>  å°†ä¸€ä¸ªæˆ–å¤šä¸ª HLL åˆå¹¶åçš„ç»“æœå­˜å‚¨åœ¨å¦ä¸€ä¸ª HLL ä¸­ï¼Œæ¯”å¦‚æ¯æœˆæ´»è·ƒç”¨æˆ·å¯ä»¥ä½¿ç”¨æ¯å¤©çš„æ´»è·ƒç”¨æˆ·æ¥åˆå¹¶è®¡ç®—å¯å¾—</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731161447288.png\" alt=\"image-20220731161447288\"></p>\n<p>ï¼ˆ2ï¼‰å®ä¾‹</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731161510641.png\" alt=\"image-20220731161510641\"></p>\n<h2 id=\"3-geospatial\"><a class=\"markdownIt-Anchor\" href=\"#3-geospatial\">#</a> 3- Geospatial</h2>\n<h3 id=\"631ç®€ä»‹\"><a class=\"markdownIt-Anchor\" href=\"#631ç®€ä»‹\">#</a> 6.3.1.\tç®€ä»‹</h3>\n<p>Redis 3.2 ä¸­å¢åŠ äº†å¯¹ GEO ç±»å‹çš„æ”¯æŒã€‚GEOï¼ŒGeographicï¼Œ<strong>åœ°ç†ä¿¡æ¯</strong>çš„ç¼©å†™ã€‚è¯¥ç±»å‹ï¼Œå°±æ˜¯å…ƒç´ çš„ 2 ç»´åæ ‡ï¼Œåœ¨åœ°å›¾ä¸Šå°±æ˜¯<strong>ç»çº¬åº¦</strong>ã€‚redis åŸºäºè¯¥ç±»å‹ï¼Œæä¾›äº†ç»çº¬åº¦è®¾ç½®ï¼ŒæŸ¥è¯¢ï¼ŒèŒƒå›´æŸ¥è¯¢ï¼Œè·ç¦»æŸ¥è¯¢ï¼Œç»çº¬åº¦ Hash ç­‰å¸¸è§æ“ä½œã€‚</p>\n<h3 id=\"632å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#632å‘½ä»¤\">#</a> 6.3.2.\tå‘½ä»¤</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>å‘½ä»¤ï¼š</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   ï¼ˆ1ï¼‰å­˜ï¼šgeoadd</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   ï¼ˆ2ï¼‰å–ï¼šgeopos</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   ï¼ˆ3ï¼‰ç›´çº¿è·ç¦»ï¼šgeodist</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   ï¼ˆ4ï¼‰æŒ‡å®šä¸­å¿ƒã€åŠå¾„å†…çš„å…ƒç´ ï¼šgeoradiusã€</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>è¯¦è§ä¸‹åˆ—å®ä¾‹</pre></td></tr></table></figure><p>1ã€ <code>geoadd</code></p>\n<p>ï¼ˆ1ï¼‰æ ¼å¼<br>\n<strong> geoadd<key>&lt; longitude&gt;<latitude><member> [longitude latitude memberâ€¦]</strong>   æ·»åŠ åœ°ç†ä½ç½®ï¼ˆç»åº¦ï¼Œçº¬åº¦ï¼Œåç§°ï¼‰</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731161856254.png\" alt=\"image-20220731161856254\"></p>\n<p>ï¼ˆ2ï¼‰å®ä¾‹</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>geoadd china:city <span class=\"token number\">121.47</span> <span class=\"token number\">31.23</span> shanghai</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>geoadd china:city <span class=\"token number\">106.50</span> <span class=\"token number\">29.53</span> chongqing <span class=\"token number\">114.05</span> <span class=\"token number\">22.52</span> shenzhen <span class=\"token number\">116.38</span> <span class=\"token number\">39.90</span> beijing</pre></td></tr></table></figure><p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731161919961.png\" alt=\"image-20220731161919961\"></p>\n<p>ä¸¤ææ— æ³•ç›´æ¥æ·»åŠ ï¼Œä¸€èˆ¬ä¼šä¸‹è½½åŸå¸‚æ•°æ®ï¼Œç›´æ¥é€šè¿‡ Java ç¨‹åºä¸€æ¬¡æ€§å¯¼å…¥ã€‚</p>\n<p><strong>æœ‰æ•ˆçš„ç»åº¦ä» -180 åº¦åˆ° 180 åº¦ã€‚æœ‰æ•ˆçš„çº¬åº¦ä» -85.05112878 åº¦åˆ° 85.05112878 åº¦ã€‚</strong></p>\n<p>å½“åæ ‡ä½ç½®è¶…å‡ºæŒ‡å®šèŒƒå›´æ—¶ï¼Œè¯¥å‘½ä»¤å°†ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚<br>\nå·²ç»æ·»åŠ çš„æ•°æ®ï¼Œæ˜¯æ— æ³•å†æ¬¡å¾€é‡Œé¢æ·»åŠ çš„ã€‚</p>\n<p>2ã€ <code>geopos  </code></p>\n<p>ï¼ˆ1ï¼‰æ ¼å¼<br>\n<strong> geopos  <key><member> [memberâ€¦]</strong>  è·å¾—æŒ‡å®šåœ°åŒºçš„åæ ‡å€¼</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731162347572.png\" alt=\"image-20220731162347572\"></p>\n<p>ï¼ˆ2ï¼‰å®ä¾‹</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731162359258.png\" alt=\"image-20220731162359258\"></p>\n<p>3ã€ <code>geodist</code></p>\n<p>ï¼ˆ1ï¼‰æ ¼å¼<br>\n<strong> geodist<key><member1><member2>  [m|km|ft|mi ]</strong>  è·å–ä¸¤ä¸ªä½ç½®ä¹‹é—´çš„ç›´çº¿è·ç¦»</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731162423033.png\" alt=\"image-20220731162423033\"></p>\n<p>ï¼ˆ2ï¼‰å®ä¾‹<br>\nè·å–ä¸¤ä¸ªä½ç½®ä¹‹é—´çš„ç›´çº¿è·ç¦»</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731162458356.png\" alt=\"image-20220731162458356\"></p>\n<p>å•ä½ï¼š</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>m è¡¨ç¤ºå•ä½ä¸ºç±³<span class=\"token punctuation\">[</span>é»˜è®¤å€¼<span class=\"token punctuation\">]</span>ã€‚</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>km è¡¨ç¤ºå•ä½ä¸ºåƒç±³ã€‚</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>mi è¡¨ç¤ºå•ä½ä¸ºè‹±é‡Œã€‚</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>ft è¡¨ç¤ºå•ä½ä¸ºè‹±å°ºã€‚</pre></td></tr></table></figure><p>å¦‚æœç”¨æˆ·æ²¡æœ‰æ˜¾å¼åœ°æŒ‡å®šå•ä½å‚æ•°ï¼Œ é‚£ä¹ˆ GEODIST é»˜è®¤ä½¿ç”¨ç±³ä½œä¸ºå•ä½</p>\n<p>4ã€ <code>georadius</code> <br>\nï¼ˆ1ï¼‰æ ¼å¼<br>\n<strong> georadius<key>&lt; longitude&gt;<latitude>radius  m|km|ft|mi</strong>   ä»¥ç»™å®šçš„ç»çº¬åº¦ä¸ºä¸­å¿ƒï¼Œæ‰¾å‡ºæŸä¸€åŠå¾„å†…çš„å…ƒç´ </p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731162604335.png\" alt=\"image-20220731162604335\"></p>\n<p>ç»åº¦ çº¬åº¦ è·ç¦» å•ä½</p>\n<p>ï¼ˆ2ï¼‰å®ä¾‹</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731162630641.png\" alt=\"image-20220731162630641\"></p>\n<h1 id=\"ä¸ƒ-redis_jedis_æµ‹è¯•\"><a class=\"markdownIt-Anchor\" href=\"#ä¸ƒ-redis_jedis_æµ‹è¯•\">#</a> ä¸ƒã€Redis_Jedis_æµ‹è¯•</h1>\n<h2 id=\"1-jedisæ‰€éœ€è¦çš„jaråŒ…\"><a class=\"markdownIt-Anchor\" href=\"#1-jedisæ‰€éœ€è¦çš„jaråŒ…\">#</a> 1 - Jedis æ‰€éœ€è¦çš„ jar åŒ…</h2>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>redis.clients<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>jedis<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>3.2.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h2 id=\"2-è¿æ¥redisæ³¨æ„äº‹é¡¹\"><a class=\"markdownIt-Anchor\" href=\"#2-è¿æ¥redisæ³¨æ„äº‹é¡¹\">#</a> 2 - è¿æ¥ Redis æ³¨æ„äº‹é¡¹</h2>\n<p>ç¦ç”¨ Linux çš„é˜²ç«å¢™ï¼šLinux (CentOS7) é‡Œæ‰§è¡Œå‘½ä»¤</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemctl stop/disable firewalld.service   </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>redis.confä¸­æ³¨é‡Šæ‰bind <span class=\"token number\">127.0</span>.0.1 ,ç„¶å protected-mode no</pre></td></tr></table></figure><h2 id=\"3-jediså¸¸ç”¨æ“ä½œ\"><a class=\"markdownIt-Anchor\" href=\"#3-jediså¸¸ç”¨æ“ä½œ\">#</a> 3 - Jedis å¸¸ç”¨æ“ä½œ</h2>\n<h3 id=\"731åˆ›å»ºåŠ¨æ€çš„å·¥ç¨‹\"><a class=\"markdownIt-Anchor\" href=\"#731åˆ›å»ºåŠ¨æ€çš„å·¥ç¨‹\">#</a> 7.3.1.\tåˆ›å»ºåŠ¨æ€çš„å·¥ç¨‹</h3>\n<h3 id=\"732åˆ›å»ºæµ‹è¯•ç¨‹åº\"><a class=\"markdownIt-Anchor\" href=\"#732åˆ›å»ºæµ‹è¯•ç¨‹åº\">#</a> 7.3.2.\tåˆ›å»ºæµ‹è¯•ç¨‹åº</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>atguigu<span class=\"token punctuation\">.</span>jedis</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">redis<span class=\"token punctuation\">.</span>clients<span class=\"token punctuation\">.</span>jedis<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Jedis</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Demo01</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">Jedis</span> jedis <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Jedis</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"192.168.137.3\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">6379</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">String</span> pong <span class=\"token operator\">=</span> jedis<span class=\"token punctuation\">.</span><span class=\"token function\">ping</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è¿æ¥æˆåŠŸï¼š\"</span><span class=\"token operator\">+</span>pong<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        jedis<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"4-æµ‹è¯•ç›¸å…³æ•°æ®ç±»å‹\"><a class=\"markdownIt-Anchor\" href=\"#4-æµ‹è¯•ç›¸å…³æ•°æ®ç±»å‹\">#</a> 4 - æµ‹è¯•ç›¸å…³æ•°æ®ç±»å‹</h2>\n<h3 id=\"741jedis-api-key\"><a class=\"markdownIt-Anchor\" href=\"#741jedis-api-key\">#</a> 7.4.1.\tJedis-API:    Key</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"k1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"v1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"k2\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"v2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"k3\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"v3\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> keys <span class=\"token operator\">=</span> jedis<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"*\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>keys<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> key <span class=\"token operator\">:</span> keys<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">exists</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"k1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">ttl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"k1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                </pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"k1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"742jedis-api-string\"><a class=\"markdownIt-Anchor\" href=\"#742jedis-api-string\">#</a> 7.4.2.\tJedis-API:    String</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">mset</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"str1\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"v1\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"str2\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"v2\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"str3\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"v3\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">mget</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"str1\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"str2\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"str3\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"743jedis-api-list\"><a class=\"markdownIt-Anchor\" href=\"#743jedis-api-list\">#</a> 7.4.3.\tJedis-API:    List</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> list <span class=\"token operator\">=</span> jedis<span class=\"token punctuation\">.</span><span class=\"token function\">lrange</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mylist\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> element <span class=\"token operator\">:</span> list<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"744jedis-api-set\"><a class=\"markdownIt-Anchor\" href=\"#744jedis-api-set\">#</a> 7.4.4.\tJedis-API:    set</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">sadd</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"orders\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"order01\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">sadd</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"orders\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"order02\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">sadd</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"orders\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"order03\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">sadd</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"orders\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"order04\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> smembers <span class=\"token operator\">=</span> jedis<span class=\"token punctuation\">.</span><span class=\"token function\">smembers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"orders\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> order <span class=\"token operator\">:</span> smembers<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>order<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">srem</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"orders\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"order02\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"745jedis-api-hash\"><a class=\"markdownIt-Anchor\" href=\"#745jedis-api-hash\">#</a> 7.4.5.\tJedis-API:    hash</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">hset</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hash1\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"userName\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"lisi\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">hget</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hash1\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"userName\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> map <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>map<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"telphone\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"13810169999\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>map<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"address\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"atguigu\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>map<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"email\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"abc@163.com\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">hmset</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hash2\"</span><span class=\"token punctuation\">,</span>map<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> result <span class=\"token operator\">=</span> jedis<span class=\"token punctuation\">.</span><span class=\"token function\">hmget</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hash2\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"telphone\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"email\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> element <span class=\"token operator\">:</span> result<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>7.4.6.\tJedis-API:    zset</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">zadd</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"zset01\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100d</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"z3\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">zadd</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"zset01\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">90d</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"l4\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">zadd</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"zset01\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">80d</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"w5\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">zadd</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"zset01\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">70d</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"z6\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> zrange <span class=\"token operator\">=</span> jedis<span class=\"token punctuation\">.</span><span class=\"token function\">zrange</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"zset01\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> e <span class=\"token operator\">:</span> zrange<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"å…«-redis_jedis_å®ä¾‹\"><a class=\"markdownIt-Anchor\" href=\"#å…«-redis_jedis_å®ä¾‹\">#</a> å…«ã€Redis_Jedis_å®ä¾‹</h1>\n<h2 id=\"1-å®Œæˆä¸€ä¸ªæ‰‹æœºéªŒè¯ç åŠŸèƒ½\"><a class=\"markdownIt-Anchor\" href=\"#1-å®Œæˆä¸€ä¸ªæ‰‹æœºéªŒè¯ç åŠŸèƒ½\">#</a> 1 - å®Œæˆä¸€ä¸ªæ‰‹æœºéªŒè¯ç åŠŸèƒ½</h2>\n<p>è¦æ±‚ï¼š<br>\n1ã€è¾“å…¥æ‰‹æœºå·ï¼Œç‚¹å‡»å‘é€åéšæœºç”Ÿæˆ 6 ä½æ•°å­—ç ï¼Œ2 åˆ†é’Ÿæœ‰æ•ˆ<br>\n 2ã€è¾“å…¥éªŒè¯ç ï¼Œç‚¹å‡»éªŒè¯ï¼Œè¿”å›æˆåŠŸæˆ–å¤±è´¥<br>\n 3ã€æ¯ä¸ªæ‰‹æœºå·æ¯å¤©åªèƒ½è¾“å…¥ 3 æ¬¡</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731164343801.png\" alt=\"image-20220731164343801\"></p>\n<p>å®ç°è§ï¼š<a href=\"http://blog.dabing.cool/cache/redis%E5%AE%9E%E7%8E%B0%E6%89%8B%E6%9C%BA%E9%AA%8C%E8%AF%81%E7%A0%81%E6%A0%A1%E9%AA%8C/\">http://blog.dabing.cool/cache/redis å®ç°æ‰‹æœºéªŒè¯ç æ ¡éªŒ /</a></p>\n<h1 id=\"ä¹-redisä¸spring-bootæ•´åˆ\"><a class=\"markdownIt-Anchor\" href=\"#ä¹-redisä¸spring-bootæ•´åˆ\">#</a> ä¹ã€Redis ä¸ Spring Boot æ•´åˆ</h1>\n<p>Spring Boot æ•´åˆ Redis éå¸¸ç®€å•ï¼Œåªéœ€è¦æŒ‰å¦‚ä¸‹æ­¥éª¤æ•´åˆå³å¯</p>\n<h2 id=\"1-æ•´åˆæ­¥éª¤\"><a class=\"markdownIt-Anchor\" href=\"#1-æ•´åˆæ­¥éª¤\">#</a> 1 - æ•´åˆæ­¥éª¤</h2>\n<p>1ã€\tåœ¨ pom.xml æ–‡ä»¶ä¸­å¼•å…¥ redis ç›¸å…³ä¾èµ–</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!-- redis --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-data-redis<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">&lt;!-- spring2.X é›†æˆ redis æ‰€éœ€ common-pool2--></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.apache.commons<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>commons-pool2<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.6.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>2ã€\tapplication.properties é…ç½® redis é…ç½®</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#Redis æœåŠ¡å™¨åœ°å€</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key attr-name\">spring.redis.host</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">192.168.140.136</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#Redis æœåŠ¡å™¨è¿æ¥ç«¯å£</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key attr-name\">spring.redis.port</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">6379</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#Redis æ•°æ®åº“ç´¢å¼•ï¼ˆé»˜è®¤ä¸º 0ï¼‰</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key attr-name\">spring.redis.database</span><span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">0</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">#è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token key attr-name\">spring.redis.timeout</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">1800000</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">#è¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token key attr-name\">spring.redis.lettuce.pool.max-active</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">20</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ (è´Ÿæ•°è¡¨ç¤ºæ²¡é™åˆ¶)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token key attr-name\">spring.redis.lettuce.pool.max-wait</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">-1</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">#è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token key attr-name\">spring.redis.lettuce.pool.max-idle</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">5</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">#è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token key attr-name\">spring.redis.lettuce.pool.min-idle</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">0</span></pre></td></tr></table></figure><p>3ã€\tæ·»åŠ  redis é…ç½®ç±»</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@EnableCaching</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RedisConfig</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">CachingConfigurerSupport</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">RedisTemplate</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">redisTemplate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RedisConnectionFactory</span> factory<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">RedisTemplate</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> template <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RedisTemplate</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">RedisSerializer</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> redisSerializer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StringRedisSerializer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">Jackson2JsonRedisSerializer</span> jackson2JsonRedisSerializer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Jackson2JsonRedisSerializer</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token class-name\">ObjectMapper</span> om <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ObjectMapper</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        om<span class=\"token punctuation\">.</span><span class=\"token function\">setVisibility</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">PropertyAccessor</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ALL</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">JsonAutoDetect<span class=\"token punctuation\">.</span>Visibility</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ANY</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        om<span class=\"token punctuation\">.</span><span class=\"token function\">enableDefaultTyping</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ObjectMapper<span class=\"token punctuation\">.</span>DefaultTyping</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NON_FINAL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        jackson2JsonRedisSerializer<span class=\"token punctuation\">.</span><span class=\"token function\">setObjectMapper</span><span class=\"token punctuation\">(</span>om<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        template<span class=\"token punctuation\">.</span><span class=\"token function\">setConnectionFactory</span><span class=\"token punctuation\">(</span>factory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">//key åºåˆ—åŒ–æ–¹å¼</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        template<span class=\"token punctuation\">.</span><span class=\"token function\">setKeySerializer</span><span class=\"token punctuation\">(</span>redisSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\">//value åºåˆ—åŒ–</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        template<span class=\"token punctuation\">.</span><span class=\"token function\">setValueSerializer</span><span class=\"token punctuation\">(</span>jackson2JsonRedisSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token comment\">//value hashmap åºåˆ—åŒ–</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        template<span class=\"token punctuation\">.</span><span class=\"token function\">setHashValueSerializer</span><span class=\"token punctuation\">(</span>jackson2JsonRedisSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">return</span> template<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">CacheManager</span> <span class=\"token function\">cacheManager</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RedisConnectionFactory</span> factory<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    \t<span class=\"token class-name\">RedisSerializer</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> redisSerializer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StringRedisSerializer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    \t<span class=\"token class-name\">Jackson2JsonRedisSerializer</span> jackson2JsonRedisSerializer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Jackson2JsonRedisSerializer</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    \t<span class=\"token comment\">// è§£å†³æŸ¥è¯¢ç¼“å­˜è½¬æ¢å¼‚å¸¸çš„é—®é¢˜</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token class-name\">ObjectMapper</span> om <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ObjectMapper</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        om<span class=\"token punctuation\">.</span><span class=\"token function\">setVisibility</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">PropertyAccessor</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ALL</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">JsonAutoDetect<span class=\"token punctuation\">.</span>Visibility</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ANY</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        om<span class=\"token punctuation\">.</span><span class=\"token function\">enableDefaultTyping</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ObjectMapper<span class=\"token punctuation\">.</span>DefaultTyping</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NON_FINAL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        jackson2JsonRedisSerializer<span class=\"token punctuation\">.</span><span class=\"token function\">setObjectMapper</span><span class=\"token punctuation\">(</span>om<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\t<span class=\"token comment\">// é…ç½®åºåˆ—åŒ–ï¼ˆè§£å†³ä¹±ç çš„é—®é¢˜ï¼‰, è¿‡æœŸæ—¶é—´ 600 ç§’</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token class-name\">RedisCacheConfiguration</span> config <span class=\"token operator\">=</span> <span class=\"token class-name\">RedisCacheConfiguration</span><span class=\"token punctuation\">.</span><span class=\"token function\">defaultCacheConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">entryTtl</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Duration</span><span class=\"token punctuation\">.</span><span class=\"token function\">ofSeconds</span><span class=\"token punctuation\">(</span><span class=\"token number\">600</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">serializeKeysWith</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RedisSerializationContext<span class=\"token punctuation\">.</span>SerializationPair</span><span class=\"token punctuation\">.</span><span class=\"token function\">fromSerializer</span><span class=\"token punctuation\">(</span>redisSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">serializeValuesWith</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RedisSerializationContext<span class=\"token punctuation\">.</span>SerializationPair</span><span class=\"token punctuation\">.</span><span class=\"token function\">fromSerializer</span><span class=\"token punctuation\">(</span>jackson2JsonRedisSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">disableCachingNullValues</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token class-name\">RedisCacheManager</span> cacheManager <span class=\"token operator\">=</span> <span class=\"token class-name\">RedisCacheManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span>factory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">cacheDefaults</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token keyword\">return</span> cacheManager<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>4ã€æµ‹è¯•ä¸€ä¸‹</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">RedisTestController</span>ä¸­æ·»åŠ æµ‹è¯•æ–¹æ³•</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@RestController</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/redisTest\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RedisTestController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RedisTemplate</span> redisTemplate<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">testRedis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// è®¾ç½®å€¼åˆ° redis</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"lucy\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token comment\">// ä» redis è·å–å€¼</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token class-name\">String</span> name <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span>redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">return</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"å-redis_äº‹åŠ¡_é”æœºåˆ¶_ç§’æ€\"><a class=\"markdownIt-Anchor\" href=\"#å-redis_äº‹åŠ¡_é”æœºåˆ¶_ç§’æ€\">#</a> åã€Redis_äº‹åŠ¡_é”æœºåˆ¶_ç§’æ€</h1>\n<h2 id=\"1-redisçš„äº‹åŠ¡å®šä¹‰\"><a class=\"markdownIt-Anchor\" href=\"#1-redisçš„äº‹åŠ¡å®šä¹‰\">#</a> 1- Redis çš„äº‹åŠ¡å®šä¹‰</h2>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731165702195.png\" alt=\"image-20220731165702195\"></p>\n<p>Redis äº‹åŠ¡æ˜¯ä¸€ä¸ªå•ç‹¬çš„éš”ç¦»æ“ä½œï¼šäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œã€‚äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­ã€‚</p>\n<p>Redis äº‹åŠ¡çš„ä¸»è¦ä½œç”¨å°±æ˜¯ä¸²è”å¤šä¸ªå‘½ä»¤é˜²æ­¢åˆ«çš„å‘½ä»¤æ’é˜Ÿã€‚</p>\n<h2 id=\"2-multi-exec-discard\"><a class=\"markdownIt-Anchor\" href=\"#2-multi-exec-discard\">#</a> 2 - Multiã€Execã€discard</h2>\n<p>ä»è¾“å…¥ Multi å‘½ä»¤å¼€å§‹ï¼Œè¾“å…¥çš„å‘½ä»¤éƒ½ä¼šä¾æ¬¡è¿›å…¥å‘½ä»¤é˜Ÿåˆ—ä¸­ï¼Œä½†ä¸ä¼šæ‰§è¡Œï¼Œç›´åˆ°è¾“å…¥ Exec åï¼ŒRedis ä¼šå°†ä¹‹å‰çš„å‘½ä»¤é˜Ÿåˆ—ä¸­çš„å‘½ä»¤ä¾æ¬¡æ‰§è¡Œã€‚</p>\n<p>ç»„é˜Ÿçš„è¿‡ç¨‹ä¸­å¯ä»¥é€šè¿‡ discard æ¥æ”¾å¼ƒç»„é˜Ÿã€‚</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731165752989.png\" alt=\"image-20220731165752989\"></p>\n<p>æ¡ˆä¾‹ï¼š</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731165812368.png\" alt=\"image-20220731165812368\"></p>\n<p>ç»„é˜ŸæˆåŠŸï¼Œæäº¤æˆåŠŸ</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731165825351.png\" alt=\"image-20220731165825351\"></p>\n<p>ç»„é˜Ÿé˜¶æ®µæŠ¥é”™ï¼Œæäº¤å¤±è´¥</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731165909910.png\" alt=\"image-20220731165909910\"></p>\n<p>ç»„é˜ŸæˆåŠŸï¼Œæäº¤æœ‰æˆåŠŸæœ‰å¤±è´¥æƒ…å†µ</p>\n<h2 id=\"3-äº‹åŠ¡çš„é”™è¯¯å¤„ç†\"><a class=\"markdownIt-Anchor\" href=\"#3-äº‹åŠ¡çš„é”™è¯¯å¤„ç†\">#</a> 3 - äº‹åŠ¡çš„é”™è¯¯å¤„ç†</h2>\n<p>ç»„é˜Ÿä¸­æŸä¸ªå‘½ä»¤å‡ºç°äº†æŠ¥å‘Šé”™è¯¯ï¼Œæ‰§è¡Œæ—¶æ•´ä¸ªçš„æ‰€æœ‰é˜Ÿåˆ—éƒ½ä¼šè¢«å–æ¶ˆã€‚</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731165948305.png\" alt=\"image-20220731165948305\"></p>\n<p>å¦‚æœæ‰§è¡Œé˜¶æ®µæŸä¸ªå‘½ä»¤æŠ¥å‡ºäº†é”™è¯¯ï¼Œåˆ™åªæœ‰æŠ¥é”™çš„å‘½ä»¤ä¸ä¼šè¢«æ‰§è¡Œï¼Œè€Œå…¶ä»–çš„å‘½ä»¤éƒ½ä¼šæ‰§è¡Œï¼Œä¸ä¼šå›æ»šã€‚</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731170100577.png\" alt=\"image-20220731170100577\"></p>\n<h2 id=\"4-ä¸ºä»€ä¹ˆè¦åšæˆäº‹åŠ¡\"><a class=\"markdownIt-Anchor\" href=\"#4-ä¸ºä»€ä¹ˆè¦åšæˆäº‹åŠ¡\">#</a> 4 - ä¸ºä»€ä¹ˆè¦åšæˆäº‹åŠ¡</h2>\n<p>æƒ³æƒ³ä¸€ä¸ªåœºæ™¯ï¼šæœ‰å¾ˆå¤šäººæœ‰ä½ çš„è´¦æˆ·ï¼ŒåŒæ—¶å»å‚åŠ åŒåä¸€æŠ¢è´­</p>\n<h2 id=\"5-äº‹åŠ¡å†²çªçš„é—®é¢˜\"><a class=\"markdownIt-Anchor\" href=\"#5-äº‹åŠ¡å†²çªçš„é—®é¢˜\">#</a> 5 - äº‹åŠ¡å†²çªçš„é—®é¢˜</h2>\n<h3 id=\"1051ä¾‹å­\"><a class=\"markdownIt-Anchor\" href=\"#1051ä¾‹å­\">#</a> 10.5.1.\tä¾‹å­</h3>\n<p>ä¸€ä¸ªè¯·æ±‚æƒ³ç»™é‡‘é¢å‡ 8000<br>\n ä¸€ä¸ªè¯·æ±‚æƒ³ç»™é‡‘é¢å‡ 5000<br>\n ä¸€ä¸ªè¯·æ±‚æƒ³ç»™é‡‘é¢å‡ 1000</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731170212554.png\" alt=\"image-20220731170212554\"></p>\n<h3 id=\"1052æ‚²è§‚é”\"><a class=\"markdownIt-Anchor\" href=\"#1052æ‚²è§‚é”\">#</a> 10.5.2.\tæ‚²è§‚é”</h3>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731170241787.png\" alt=\"image-20220731170241787\"></p>\n<p><code>æ‚²è§‚é”</code>  (Pessimistic Lock),  é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆæ‚²è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼š block ç›´åˆ°å®ƒæ‹¿åˆ°é”ã€‚</p>\n<p><strong>ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“é‡Œè¾¹å°±ç”¨åˆ°äº†å¾ˆå¤šè¿™ç§é”æœºåˆ¶</strong>ï¼Œæ¯”å¦‚<strong>è¡Œé”ï¼Œè¡¨é”ç­‰ï¼Œè¯»é”ï¼Œå†™é”</strong>ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”ã€‚</p>\n<h3 id=\"1053ä¹è§‚é”\"><a class=\"markdownIt-Anchor\" href=\"#1053ä¹è§‚é”\">#</a> 10.5.3.\tä¹è§‚é”</h3>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731170516369.png\" alt=\"image-20220731170516369\"></p>\n<p><code>ä¹è§‚é”</code>  (Optimistic Lock), é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆä¹è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ <code>ç‰ˆæœ¬å·</code> ç­‰æœºåˆ¶ã€‚</p>\n<p>ä¹è§‚é”é€‚ç”¨äº<strong>å¤šè¯»</strong>çš„åº”ç”¨ç±»å‹ï¼Œ<strong>è¿™æ ·å¯ä»¥æé«˜ååé‡</strong>ã€‚Redis å°±æ˜¯åˆ©ç”¨è¿™ç§<strong> check-and-set æœºåˆ¶</strong>å®ç°äº‹åŠ¡çš„ã€‚</p>\n<h3 id=\"1054watch-key-key\"><a class=\"markdownIt-Anchor\" href=\"#1054watch-key-key\">#</a> 10.5.4.\tWATCH key [key â€¦]</h3>\n<p>åœ¨æ‰§è¡Œ multi ä¹‹å‰ï¼Œå…ˆæ‰§è¡Œ watch key1 [key2], å¯ä»¥ç›‘è§†ä¸€ä¸ª (æˆ–å¤šä¸ª) key ï¼Œ<strong>å¦‚æœåœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰è¿™ä¸ª (æˆ–è¿™äº›) key è¢«å…¶ä»–å‘½ä»¤æ‰€æ”¹åŠ¨ï¼Œé‚£ä¹ˆäº‹åŠ¡å°†è¢«æ‰“æ–­</strong>ã€‚</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731170841894.png\" alt=\"image-20220731170841894\"></p>\n<h3 id=\"1055unwatch\"><a class=\"markdownIt-Anchor\" href=\"#1055unwatch\">#</a> 10.5.5.\tunwatch</h3>\n<p>å–æ¶ˆ WATCH å‘½ä»¤å¯¹æ‰€æœ‰ key çš„ç›‘è§†ã€‚</p>\n<p>å¦‚æœåœ¨æ‰§è¡Œ WATCH å‘½ä»¤ä¹‹åï¼ŒEXEC å‘½ä»¤æˆ– DISCARD å‘½ä»¤å…ˆè¢«æ‰§è¡Œäº†çš„è¯ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦å†æ‰§è¡Œ UNWATCH äº†ã€‚</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL2RvYy5yZWRpc2ZhbnMuY29tL3RyYW5zYWN0aW9uL2V4ZWMuaHRtbA==\">http://doc.redisfans.com/transaction/exec.html</span></p>\n<h2 id=\"6-redisäº‹åŠ¡ä¸‰ç‰¹æ€§\"><a class=\"markdownIt-Anchor\" href=\"#6-redisäº‹åŠ¡ä¸‰ç‰¹æ€§\">#</a> 6 - Redis äº‹åŠ¡ä¸‰ç‰¹æ€§</h2>\n<ul>\n<li>å•ç‹¬çš„éš”ç¦»æ“ä½œ\n<ul>\n<li>äº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œã€‚äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­ã€‚</li>\n</ul>\n</li>\n<li>æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µ\n<ul>\n<li>é˜Ÿåˆ—ä¸­çš„å‘½ä»¤æ²¡æœ‰æäº¤ä¹‹å‰éƒ½ä¸ä¼šå®é™…è¢«æ‰§è¡Œï¼Œå› ä¸ºäº‹åŠ¡æäº¤å‰ä»»ä½•æŒ‡ä»¤éƒ½ä¸ä¼šè¢«å®é™…æ‰§è¡Œ</li>\n</ul>\n</li>\n<li>ä¸ä¿è¯åŸå­æ€§\n<ul>\n<li>äº‹åŠ¡ä¸­å¦‚æœæœ‰ä¸€æ¡å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œå…¶åçš„å‘½ä»¤ä»ç„¶ä¼šè¢«æ‰§è¡Œï¼Œæ²¡æœ‰å›æ»š</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"åä¸€-redis_äº‹åŠ¡_ç§’æ€æ¡ˆä¾‹\"><a class=\"markdownIt-Anchor\" href=\"#åä¸€-redis_äº‹åŠ¡_ç§’æ€æ¡ˆä¾‹\">#</a> åä¸€ã€Redis_äº‹åŠ¡_ç§’æ€æ¡ˆä¾‹</h1>\n<h2 id=\"1-è§£å†³è®¡æ•°å™¨å’Œäººå‘˜è®°å½•çš„äº‹åŠ¡æ“ä½œ\"><a class=\"markdownIt-Anchor\" href=\"#1-è§£å†³è®¡æ•°å™¨å’Œäººå‘˜è®°å½•çš„äº‹åŠ¡æ“ä½œ\">#</a> 1 - è§£å†³è®¡æ•°å™¨å’Œäººå‘˜è®°å½•çš„äº‹åŠ¡æ“ä½œ</h2>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731171148364.png\" alt=\"image-20220731171148364\"></p>\n<h2 id=\"2-redisäº‹åŠ¡ç§’æ€å¹¶å‘æ¨¡æ‹Ÿ\"><a class=\"markdownIt-Anchor\" href=\"#2-redisäº‹åŠ¡ç§’æ€å¹¶å‘æ¨¡æ‹Ÿ\">#</a> 2 - Redis äº‹åŠ¡â€“ç§’æ€å¹¶å‘æ¨¡æ‹Ÿ</h2>\n<p>ä½¿ç”¨å·¥å…· ab æ¨¡æ‹Ÿæµ‹è¯•</p>\n<p>CentOS6 é»˜è®¤å®‰è£…</p>\n<p>CentOS7 éœ€è¦æ‰‹åŠ¨å®‰è£…</p>\n<h3 id=\"1121è”ç½‘yum-install-httpd-tools\"><a class=\"markdownIt-Anchor\" href=\"#1121è”ç½‘yum-install-httpd-tools\">#</a> 11.2.1.\tè”ç½‘ï¼šyum install httpd-tools</h3>\n<h3 id=\"1122æ— ç½‘ç»œ\"><a class=\"markdownIt-Anchor\" href=\"#1122æ— ç½‘ç»œ\">#</a> 11.2.2.\tæ— ç½‘ç»œ</h3>\n<p>ï¼ˆ1ï¼‰ è¿›å…¥ cd  /run/media/root/CentOS 7 x86_64/Packagesï¼ˆè·¯å¾„è·Ÿ centos6 ä¸åŒï¼‰</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">cd</span>  /run/media/root/CentOS <span class=\"token number\">7</span> x86_64/Packages</pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰ é¡ºåºå®‰è£…</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>apr-1.4.8-3.el7.x86_64.rpm</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>apr-util-1.5.2-6.el7.x86_64.rpm</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>httpd-tools-2.4.6-67.el7.centos.x86_64.rpm</pre></td></tr></table></figure><h3 id=\"1123æµ‹è¯•åŠç»“æœ\"><a class=\"markdownIt-Anchor\" href=\"#1123æµ‹è¯•åŠç»“æœ\">#</a> 11.2.3.\tæµ‹è¯•åŠç»“æœ</h3>\n<p><strong>11.2.3.1.\té€šè¿‡ ab æµ‹è¯•</strong><br>\n <code>vim postfile </code> æ¨¡æ‹Ÿè¡¨å•æäº¤å‚æ•°ï¼Œä»¥ <code>&amp;</code>  ç¬¦å·ç»“å°¾ï¼›å­˜æ”¾å½“å‰ç›®å½•ã€‚<br>\n** å†…å®¹ï¼š**prodid=0101&amp;</p>\n<p>ab -n 2000 -c 200  -p ~/postfile -T application/x-www-form-urlencoded <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMi4xMTU6ODA4MS9TZWNraWxsL2Rvc2Vja2lsbA==\">http://192.168.2.115:8081/Seckill/doseckill</span></p>\n<p>è¡¨ç¤ºï¼š- n å‚æ•°è¡¨ç¤º 2000 æ¬¡è¯·æ±‚ï¼Œ-c å‚æ•°è¡¨ç¤ºå¹¶å‘è¯·æ±‚ 200 æ¬¡ï¼Œ-p æ˜¯è¯·æ±‚å‚æ•°ï¼Œå†™åœ¨å½“å‰æ–‡ä»¶å¤¹çš„ postfile æ–‡ä»¶ä¸­</p>\n<p><strong>11.2.3.2.\tè¶…å–</strong><br>\n<img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731171742352.png\" alt=\"image-20220731171742352\"></p>\n<h2 id=\"3-è¶…å–é—®é¢˜\"><a class=\"markdownIt-Anchor\" href=\"#3-è¶…å–é—®é¢˜\">#</a> 3 - è¶…å–é—®é¢˜</h2>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731171820876.png\" alt=\"image-20220731171820876\"></p>\n<h2 id=\"4-åˆ©ç”¨ä¹è§‚é”æ·˜æ±°ç”¨æˆ·è§£å†³è¶…å–é—®é¢˜\"><a class=\"markdownIt-Anchor\" href=\"#4-åˆ©ç”¨ä¹è§‚é”æ·˜æ±°ç”¨æˆ·è§£å†³è¶…å–é—®é¢˜\">#</a> 4 - åˆ©ç”¨ä¹è§‚é”æ·˜æ±°ç”¨æˆ·ï¼Œè§£å†³è¶…å–é—®é¢˜ã€‚</h2>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731171831377.png\" alt=\"image-20220731171831377\"></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// å¢åŠ ä¹è§‚é”</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">watch</span><span class=\"token punctuation\">(</span>qtkey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">//3. åˆ¤æ–­åº“å­˜</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token class-name\">String</span> qtkeystr <span class=\"token operator\">=</span> jedis<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>qtkey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>qtkeystr<span class=\"token operator\">==</span><span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>qtkeystr<span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æœªåˆå§‹åŒ–åº“å­˜\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">int</span> qt <span class=\"token operator\">=</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>qtkeystr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>qt<span class=\"token operator\">&lt;=</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>err<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å·²ç»ç§’å…‰\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">// å¢åŠ äº‹åŠ¡</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token class-name\">Transaction</span> multi <span class=\"token operator\">=</span> jedis<span class=\"token punctuation\">.</span><span class=\"token function\">multi</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">//4. å‡å°‘åº“å­˜</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">//jedis.decr(qtkey);</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>multi<span class=\"token punctuation\">.</span><span class=\"token function\">decr</span><span class=\"token punctuation\">(</span>qtkey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\">//5. åŠ äºº</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\">//jedis.sadd(usrkey, uid);</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>multi<span class=\"token punctuation\">.</span><span class=\"token function\">sadd</span><span class=\"token punctuation\">(</span>usrkey<span class=\"token punctuation\">,</span> uid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\">// æ‰§è¡Œäº‹åŠ¡</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> list <span class=\"token operator\">=</span> multi<span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\">// åˆ¤æ–­äº‹åŠ¡æäº¤æ˜¯å¦å¤±è´¥</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>list<span class=\"token operator\">==</span><span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> list<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">==</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ç§’æ€å¤±è´¥\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>err<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ç§’æ€æˆåŠŸ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>jedis<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731172004110.png\" alt=\"image-20220731172004110\"></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731172018038.png\" alt=\"image-20220731172018038\"></p>\n<h2 id=\"5-ç»§ç»­å¢åŠ å¹¶å‘æµ‹è¯•\"><a class=\"markdownIt-Anchor\" href=\"#5-ç»§ç»­å¢åŠ å¹¶å‘æµ‹è¯•\">#</a> 5 - ç»§ç»­å¢åŠ å¹¶å‘æµ‹è¯•</h2>\n<h3 id=\"1151è¿æ¥æœ‰é™åˆ¶\"><a class=\"markdownIt-Anchor\" href=\"#1151è¿æ¥æœ‰é™åˆ¶\">#</a> 11.5.1.\tè¿æ¥æœ‰é™åˆ¶</h3>\n<p>ab -n 2000 -c 200 -k -p postfile -T â€˜application/x-www-form-urlencodedâ€™</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMTQwLjE6ODA4MC9zZWNraWxsL2Rvc2Vja2lsbA==\">http://192.168.140.1:8080/seckill/doseckill</span></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731172350447.png\" alt=\"image-20220731172350447\"></p>\n<p>å¢åŠ  - r å‚æ•°ï¼Œ-r   Donâ€™t exit on socket receive errors.</p>\n<p>ab -n 2000 -c 100 -r -p postfile -T â€˜application/x-www-form-urlencodedâ€™</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMTQwLjE6ODA4MC9zZWNraWxsL2Rvc2Vja2lsbA==\">http://192.168.140.1:8080/seckill/doseckill</span></p>\n<h3 id=\"1152å·²ç»ç§’å…‰å¯æ˜¯è¿˜æœ‰åº“å­˜\"><a class=\"markdownIt-Anchor\" href=\"#1152å·²ç»ç§’å…‰å¯æ˜¯è¿˜æœ‰åº“å­˜\">#</a> 11.5.2.\tå·²ç»ç§’å…‰ï¼Œå¯æ˜¯è¿˜æœ‰åº“å­˜</h3>\n<p>ab -n 2000 -c 100 -p postfile -T â€˜application/x-www-form-urlencodedâ€™</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMTM3LjE6ODA4MC9zZWNraWxsL2Rvc2Vja2lsbA==\">http://192.168.137.1:8080/seckill/doseckill</span></p>\n<p>å·²ç»ç§’å…‰ï¼Œå¯æ˜¯è¿˜æœ‰åº“å­˜ã€‚åŸå› ï¼Œå°±æ˜¯<strong>ä¹è§‚é”å¯¼è‡´å¾ˆå¤šè¯·æ±‚éƒ½å¤±è´¥</strong>ã€‚å…ˆç‚¹çš„æ²¡ç§’åˆ°ï¼Œåç‚¹çš„å¯èƒ½ç§’åˆ°äº†ã€‚</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731172717687.png\" alt=\"image-20220731172717687\"></p>\n<h3 id=\"1153è¿æ¥è¶…æ—¶é€šè¿‡è¿æ¥æ± è§£å†³\"><a class=\"markdownIt-Anchor\" href=\"#1153è¿æ¥è¶…æ—¶é€šè¿‡è¿æ¥æ± è§£å†³\">#</a> 11.5.3.\tè¿æ¥è¶…æ—¶ï¼Œé€šè¿‡è¿æ¥æ± è§£å†³</h3>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731172732412.png\" alt=\"image-20220731172732412\"></p>\n<h3 id=\"1154è¿æ¥æ± \"><a class=\"markdownIt-Anchor\" href=\"#1154è¿æ¥æ± \">#</a> 11.5.4.\tè¿æ¥æ± </h3>\n<p>èŠ‚çœæ¯æ¬¡è¿æ¥ redis æœåŠ¡å¸¦æ¥çš„æ¶ˆè€—ï¼ŒæŠŠè¿æ¥å¥½çš„å®ä¾‹åå¤åˆ©ç”¨ã€‚</p>\n<p>é€šè¿‡å‚æ•°ç®¡ç†è¿æ¥çš„è¡Œä¸º</p>\n<p>ä»£ç è§é¡¹ç›®ä¸­</p>\n<ul>\n<li><strong>é“¾æ¥æ± å‚æ•°</strong>\n<ul>\n<li><code>MaxTotal</code> ï¼šæ§åˆ¶ä¸€ä¸ª pool å¯åˆ†é…å¤šå°‘ä¸ª jedis å®ä¾‹ï¼Œé€šè¿‡ **pool.getResource ()** æ¥è·å–ï¼›å¦‚æœèµ‹å€¼ä¸º - 1ï¼Œåˆ™è¡¨ç¤ºä¸é™åˆ¶ï¼›å¦‚æœ pool å·²ç»åˆ†é…äº† MaxTotal ä¸ª jedis å®ä¾‹ï¼Œåˆ™æ­¤æ—¶ pool çš„çŠ¶æ€ä¸º exhausted ã€‚</li>\n<li><code>maxIdle</code> ï¼šæ§åˆ¶ä¸€ä¸ª pool æœ€å¤šæœ‰å¤šå°‘ä¸ªçŠ¶æ€ä¸º idle (ç©ºé—²) çš„ jedis å®ä¾‹ï¼›</li>\n<li><code>MaxWaitMillis</code> ï¼šè¡¨ç¤ºå½“ borrow ä¸€ä¸ª jedis å®ä¾‹æ—¶ï¼Œæœ€å¤§çš„ç­‰å¾…æ¯«ç§’æ•°ï¼Œå¦‚æœè¶…è¿‡ç­‰å¾…æ—¶é—´ï¼Œåˆ™ç›´æ¥æŠ› JedisConnectionExceptionï¼›</li>\n<li><code>testOnBorrow</code> ï¼šè·å¾—ä¸€ä¸ª jedis å®ä¾‹çš„æ—¶å€™æ˜¯å¦æ£€æŸ¥è¿æ¥å¯ç”¨æ€§ï¼ˆping ()ï¼‰ï¼›å¦‚æœä¸º trueï¼Œåˆ™å¾—åˆ°çš„ jedis å®ä¾‹å‡æ˜¯å¯ç”¨çš„ï¼›</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"6-è§£å†³åº“å­˜é—ç•™é—®é¢˜\"><a class=\"markdownIt-Anchor\" href=\"#6-è§£å†³åº“å­˜é—ç•™é—®é¢˜\">#</a> 6 - è§£å†³åº“å­˜é—ç•™é—®é¢˜</h2>\n<p>** é—®é¢˜æè¿°ï¼š** ç”±äºä¹è§‚é”é€ æˆçš„åº“å­˜é—ç•™é—®é¢˜</p>\n<p>å‡è®¾ç°åœ¨æœ‰ 500 ä¸ªå•†å“è¦å‡ºå”®ï¼Œç‰ˆæœ¬å·æ˜¯ 1.0ï¼Œæœ‰ 2000 ä¸ªäººåŒæ—¶ç§’æ€ï¼Œå…¶ä¸­æœ‰ 1 ä¸ªäººè´­ä¹°æˆåŠŸå¹¶ä¸”ä¿®æ”¹åº“å­˜ä¸º 499ï¼Œç‰ˆæœ¬å· 1.1ï¼Œé‚£å…¶ä»–çš„ 1999 äººéƒ½ä¸èƒ½æˆåŠŸè´­ä¹°ï¼Œå³æœ‰é¢„å­˜ä½†æ˜¯æ— æ³•è´­ä¹°ï¼Œé€ æˆçš„åº“å­˜é¢„ç•™é—®é¢˜ã€‚</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220804125018740.png\" alt=\"image-20220804125018740\"></p>\n<p>** è§£å†³ï¼š** ç”¨ LUA è„šæœ¬ï¼Œè„šæœ¬å¯è§ 11.7.5 ä»£ç </p>\n<h3 id=\"1161luaè„šæœ¬\"><a class=\"markdownIt-Anchor\" href=\"#1161luaè„šæœ¬\">#</a> 11.6.1.\tLUA è„šæœ¬</h3>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731173040454.png\" alt=\"image-20220731173040454\"></p>\n<p>Lua æ˜¯ä¸€ä¸ªå°å·§çš„<strong>è„šæœ¬è¯­è¨€</strong>ï¼ŒLua è„šæœ¬å¯ä»¥å¾ˆå®¹æ˜“çš„è¢« C/C++ ä»£ç è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥åè¿‡æ¥è°ƒç”¨ C/C++ çš„å‡½æ•°ï¼ŒLua å¹¶æ²¡æœ‰æä¾›å¼ºå¤§çš„åº“ï¼Œä¸€ä¸ªå®Œæ•´çš„ Lua è§£é‡Šå™¨ä¸è¿‡ 200kï¼Œæ‰€ä»¥ Lua ä¸é€‚åˆä½œä¸ºå¼€å‘ç‹¬ç«‹åº”ç”¨ç¨‹åºçš„è¯­è¨€ï¼Œè€Œæ˜¯ä½œä¸º<strong>åµŒå…¥å¼è„šæœ¬è¯­è¨€</strong>ã€‚</p>\n<p>å¾ˆå¤šåº”ç”¨ç¨‹åºã€æ¸¸æˆä½¿ç”¨ LUA ä½œä¸ºè‡ªå·±çš„åµŒå…¥å¼è„šæœ¬è¯­è¨€ï¼Œä»¥æ­¤æ¥å®ç°å¯é…ç½®æ€§ã€å¯æ‰©å±•æ€§ã€‚</p>\n<p>è¿™å…¶ä¸­åŒ…æ‹¬é­”å…½äº‰éœ¸åœ°å›¾ã€é­”å…½ä¸–ç•Œã€åšå¾·ä¹‹é—¨ã€æ„¤æ€’çš„å°é¸Ÿç­‰ä¼—å¤šæ¸¸æˆæ’ä»¶æˆ–å¤–æŒ‚ã€‚</p>\n<p>å‚è€ƒï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudzNjc2Nob29sLmNuL2x1YS8=\">https://www.w3cschool.cn/lua/</span></p>\n<h3 id=\"1162luaè„šæœ¬åœ¨redisä¸­çš„ä¼˜åŠ¿\"><a class=\"markdownIt-Anchor\" href=\"#1162luaè„šæœ¬åœ¨redisä¸­çš„ä¼˜åŠ¿\">#</a> 11.6.2.\tLUA è„šæœ¬åœ¨ Redis ä¸­çš„ä¼˜åŠ¿</h3>\n<p>å°†å¤æ‚çš„æˆ–è€…å¤šæ­¥çš„ redis æ“ä½œï¼Œå†™ä¸ºä¸€ä¸ªè„šæœ¬ï¼Œä¸€æ¬¡æäº¤ç»™ redis æ‰§è¡Œï¼Œå‡å°‘åå¤è¿æ¥ redis çš„æ¬¡æ•°ã€‚æå‡æ€§èƒ½ã€‚</p>\n<p><strong>LUA è„šæœ¬æ˜¯ç±»ä¼¼ redis äº‹åŠ¡ï¼Œæœ‰ä¸€å®šçš„åŸå­æ€§ï¼Œä¸ä¼šè¢«å…¶ä»–å‘½ä»¤æ’é˜Ÿï¼Œå¯ä»¥å®Œæˆä¸€äº› redis äº‹åŠ¡æ€§çš„æ“ä½œã€‚</strong></p>\n<p>ä½†æ˜¯æ³¨æ„ redis çš„ lua è„šæœ¬åŠŸèƒ½ï¼Œåªæœ‰åœ¨ Redis 2.6 ä»¥ä¸Šçš„ç‰ˆæœ¬æ‰å¯ä»¥ä½¿ç”¨ã€‚<br>\nåˆ©ç”¨ lua è„šæœ¬æ·˜æ±°ç”¨æˆ·ï¼Œè§£å†³<strong>è¶…å–é—®é¢˜</strong>ã€‚</p>\n<p>redis 2.6 ç‰ˆæœ¬ä»¥åï¼Œé€šè¿‡ lua è„šæœ¬è§£å†³<strong>äº‰æŠ¢é—®é¢˜</strong>ï¼Œå®é™…ä¸Šæ˜¯<strong> redis åˆ©ç”¨å…¶å•çº¿ç¨‹çš„ç‰¹æ€§ï¼Œç”¨ä»»åŠ¡é˜Ÿåˆ—çš„æ–¹å¼è§£å†³å¤šä»»åŠ¡å¹¶å‘é—®é¢˜</strong>ã€‚</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731173328775.png\" alt=\"image-20220731173328775\"></p>\n<h2 id=\"7-redis_äº‹åŠ¡_ç§’æ€æ¡ˆä¾‹_ä»£ç \"><a class=\"markdownIt-Anchor\" href=\"#7-redis_äº‹åŠ¡_ç§’æ€æ¡ˆä¾‹_ä»£ç \">#</a> 7 - Redis_äº‹åŠ¡_ç§’æ€æ¡ˆä¾‹_ä»£ç </h2>\n<h3 id=\"1171é¡¹ç›®ç»“æ„\"><a class=\"markdownIt-Anchor\" href=\"#1171é¡¹ç›®ç»“æ„\">#</a> 11.7.1.\té¡¹ç›®ç»“æ„</h3>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731173358460.png\" alt=\"image-20220731173358460\"></p>\n<h3 id=\"1172ç¬¬ä¸€ç‰ˆç®€å•ç‰ˆ\"><a class=\"markdownIt-Anchor\" href=\"#1172ç¬¬ä¸€ç‰ˆç®€å•ç‰ˆ\">#</a> 11.7.2.\tç¬¬ä¸€ç‰ˆï¼šç®€å•ç‰ˆ</h3>\n<p>è€å¸ˆç‚¹ 10 æ¬¡ï¼Œæ­£å¸¸ç§’æ€</p>\n<p>åŒå­¦ä¸€èµ·ç‚¹è¯•ä¸€è¯•ï¼Œç§’æ€ä¹Ÿæ˜¯æ­£å¸¸çš„ã€‚è¿™æ˜¯å› ä¸ºè¿˜è¾¾ä¸åˆ°å¹¶å‘çš„æ•ˆæœã€‚</p>\n<p>ä½¿ç”¨<strong>å·¥å…· ab</strong> æ¨¡æ‹Ÿå¹¶å‘æµ‹è¯•ï¼Œä¼šå‡ºç°è¶…å–æƒ…å†µã€‚æŸ¥çœ‹åº“å­˜ä¼šå‡ºç°<strong>è´Ÿæ•°</strong>ã€‚</p>\n<h3 id=\"1173ç¬¬äºŒç‰ˆåŠ äº‹åŠ¡-ä¹è§‚é”è§£å†³è¶…å–ä½†å‡ºç°é—ç•™åº“å­˜å’Œè¿æ¥è¶…æ—¶\"><a class=\"markdownIt-Anchor\" href=\"#1173ç¬¬äºŒç‰ˆåŠ äº‹åŠ¡-ä¹è§‚é”è§£å†³è¶…å–ä½†å‡ºç°é—ç•™åº“å­˜å’Œè¿æ¥è¶…æ—¶\">#</a> 11.7.3.\tç¬¬äºŒç‰ˆï¼šåŠ äº‹åŠ¡ - ä¹è§‚é” (è§£å†³è¶…å–), ä½†å‡ºç°é—ç•™åº“å­˜å’Œè¿æ¥è¶…æ—¶</h3>\n<h3 id=\"1174ç¬¬ä¸‰ç‰ˆè¿æ¥æ± è§£å†³è¶…æ—¶é—®é¢˜\"><a class=\"markdownIt-Anchor\" href=\"#1174ç¬¬ä¸‰ç‰ˆè¿æ¥æ± è§£å†³è¶…æ—¶é—®é¢˜\">#</a> 11.7.4.\tç¬¬ä¸‰ç‰ˆï¼šè¿æ¥æ± è§£å†³è¶…æ—¶é—®é¢˜</h3>\n<h3 id=\"1175ç¬¬å››ç‰ˆè§£å†³åº“å­˜é—ç•™é—®é¢˜luaè„šæœ¬\"><a class=\"markdownIt-Anchor\" href=\"#1175ç¬¬å››ç‰ˆè§£å†³åº“å­˜é—ç•™é—®é¢˜luaè„šæœ¬\">#</a> 11.7.5.\tç¬¬å››ç‰ˆï¼šè§£å†³åº“å­˜é—ç•™é—®é¢˜ï¼ŒLUA è„šæœ¬</h3>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">local</span> userid<span class=\"token operator\">=</span>KEYS<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">local</span> prodid<span class=\"token operator\">=</span>KEYS<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">local</span> qtkey<span class=\"token operator\">=</span><span class=\"token string\">\"sk:\"</span><span class=\"token operator\">..</span>prodid<span class=\"token operator\">..</span><span class=\"token string\">\":qt\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">local</span> usersKey<span class=\"token operator\">=</span><span class=\"token string\">\"sk:\"</span><span class=\"token operator\">..</span>prodid<span class=\"token punctuation\">.</span>\"<span class=\"token punctuation\">:</span>usr'<span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">local</span> userExists<span class=\"token operator\">=</span>redis<span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sismember\"</span><span class=\"token punctuation\">,</span>usersKey<span class=\"token punctuation\">,</span>userid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token function\">tonumber</span><span class=\"token punctuation\">(</span>userExists<span class=\"token punctuation\">)</span><span class=\"token operator\">==</span><span class=\"token number\">1</span> <span class=\"token keyword\">then</span> </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token keyword\">return</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">local</span> num<span class=\"token operator\">=</span> redis<span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"get\"</span> <span class=\"token punctuation\">,</span>qtkey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token function\">tonumber</span><span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">)</span><span class=\"token operator\">&lt;=</span><span class=\"token number\">0</span> <span class=\"token keyword\">then</span> </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">else</span> </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  redis<span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"decr\"</span><span class=\"token punctuation\">,</span>qtkey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  redis<span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sadd\"</span><span class=\"token punctuation\">,</span>usersKey<span class=\"token punctuation\">,</span>userid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">return</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h1 id=\"åäºŒ-redisæŒä¹…åŒ–ä¹‹rdb\"><a class=\"markdownIt-Anchor\" href=\"#åäºŒ-redisæŒä¹…åŒ–ä¹‹rdb\">#</a> åäºŒã€Redis æŒä¹…åŒ–ä¹‹ RDB</h1>\n<h2 id=\"1-æ€»ä½“ä»‹ç»\"><a class=\"markdownIt-Anchor\" href=\"#1-æ€»ä½“ä»‹ç»\">#</a> 1 - æ€»ä½“ä»‹ç»</h2>\n<p>å®˜ç½‘ä»‹ç»ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5yZWRpcy5pbw==\">http://www.redis.io</span></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731173617123.png\" alt=\"image-20220731173617123\"></p>\n<p>Redis æä¾›äº† 2 ä¸ªä¸åŒå½¢å¼çš„æŒä¹…åŒ–æ–¹å¼ã€‚</p>\n<ul>\n<li>RDBï¼ˆRedis DataBaseï¼‰</li>\n<li>AOFï¼ˆAppend Of Fileï¼‰</li>\n</ul>\n<h2 id=\"2-rdbredis-database\"><a class=\"markdownIt-Anchor\" href=\"#2-rdbredis-database\">#</a> 2 - RDBï¼ˆRedis DataBaseï¼‰</h2>\n<h3 id=\"1221å®˜ç½‘ä»‹ç»\"><a class=\"markdownIt-Anchor\" href=\"#1221å®˜ç½‘ä»‹ç»\">#</a> 12.2.1.\tå®˜ç½‘ä»‹ç»</h3>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731173702411.png\" alt=\"image-20220731173702411\"></p>\n<h3 id=\"1222æ˜¯ä»€ä¹ˆ\"><a class=\"markdownIt-Anchor\" href=\"#1222æ˜¯ä»€ä¹ˆ\">#</a> 12.2.2.\tæ˜¯ä»€ä¹ˆ</h3>\n<p>åœ¨æŒ‡å®šçš„<strong>æ—¶é—´é—´éš”</strong>å†…å°†å†…å­˜ä¸­çš„æ•°æ®é›†<strong>å¿«ç…§</strong>å†™å…¥ç£ç›˜ï¼Œ ä¹Ÿå°±æ˜¯è¡Œè¯è®²çš„ Snapshot å¿«ç…§ï¼Œå®ƒæ¢å¤æ—¶æ˜¯å°†å¿«ç…§æ–‡ä»¶ç›´æ¥è¯»åˆ°å†…å­˜é‡Œ</p>\n<h3 id=\"1223å¤‡ä»½æ˜¯å¦‚ä½•æ‰§è¡Œçš„\"><a class=\"markdownIt-Anchor\" href=\"#1223å¤‡ä»½æ˜¯å¦‚ä½•æ‰§è¡Œçš„\">#</a> 12.2.3.\tå¤‡ä»½æ˜¯å¦‚ä½•æ‰§è¡Œçš„</h3>\n<p>Redis ä¼šå•ç‹¬åˆ›å»ºï¼ˆforkï¼‰ä¸€ä¸ªå­è¿›ç¨‹æ¥è¿›è¡ŒæŒä¹…åŒ–ï¼Œä¼šå…ˆå°†æ•°æ®å†™å…¥åˆ° ä¸€ä¸ª<strong>ä¸´æ—¶æ–‡ä»¶</strong>ä¸­ï¼Œå¾…æŒä¹…åŒ–è¿‡ç¨‹éƒ½ç»“æŸäº†ï¼Œå†ç”¨è¿™ä¸ª<strong>ä¸´æ—¶æ–‡ä»¶æ›¿æ¢ä¸Šæ¬¡æŒä¹…åŒ–å¥½çš„æ–‡ä»¶</strong>ã€‚ æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸»è¿›ç¨‹æ˜¯ä¸è¿›è¡Œä»»ä½• IO æ“ä½œçš„ï¼Œè¿™å°±ç¡®ä¿äº†æé«˜çš„æ€§èƒ½ å¦‚æœéœ€è¦è¿›è¡Œå¤§è§„æ¨¡æ•°æ®çš„æ¢å¤ï¼Œä¸”å¯¹äºæ•°æ®æ¢å¤çš„å®Œæ•´æ€§ä¸æ˜¯éå¸¸æ•æ„Ÿï¼Œé‚£ RDB æ–¹å¼è¦æ¯” AOF æ–¹å¼æ›´åŠ çš„é«˜æ•ˆã€‚</p>\n<p><strong>RDB çš„ç¼ºç‚¹æ˜¯æœ€åä¸€æ¬¡æŒä¹…åŒ–åçš„æ•°æ®å¯èƒ½ä¸¢å¤±</strong>ã€‚</p>\n<h3 id=\"1224fork\"><a class=\"markdownIt-Anchor\" href=\"#1224fork\">#</a> 12.2.4.\tFork</h3>\n<ul>\n<li>Fork çš„ä½œç”¨æ˜¯<strong>å¤åˆ¶</strong>ä¸€ä¸ªä¸å½“å‰è¿›ç¨‹ä¸€æ ·çš„è¿›ç¨‹ã€‚æ–°è¿›ç¨‹çš„æ‰€æœ‰æ•°æ®ï¼ˆå˜é‡ã€ç¯å¢ƒå˜é‡ã€ç¨‹åºè®¡æ•°å™¨ç­‰ï¼‰ æ•°å€¼éƒ½å’ŒåŸè¿›ç¨‹ä¸€è‡´ï¼Œä½†æ˜¯æ˜¯ä¸€ä¸ªå…¨æ–°çš„è¿›ç¨‹ï¼Œå¹¶<strong>ä½œä¸ºåŸè¿›ç¨‹çš„å­è¿›ç¨‹</strong></li>\n<li>åœ¨ Linux ç¨‹åºä¸­ï¼Œfork () ä¼šäº§ç”Ÿä¸€ä¸ªå’Œçˆ¶è¿›ç¨‹å®Œå…¨ç›¸åŒçš„å­è¿›ç¨‹ï¼Œä½†å­è¿›ç¨‹åœ¨æ­¤åå¤šä¼š exec ç³»ç»Ÿè°ƒç”¨ï¼Œå‡ºäºæ•ˆç‡è€ƒè™‘ï¼ŒLinux ä¸­å¼•å…¥äº† â€œ<strong>å†™æ—¶å¤åˆ¶æŠ€æœ¯</strong>â€</li>\n<li><strong>ä¸€èˆ¬æƒ…å†µçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¼šå…±ç”¨åŒä¸€æ®µç‰©ç†å†…å­˜</strong>ï¼Œåªæœ‰è¿›ç¨‹ç©ºé—´çš„å„æ®µçš„å†…å®¹è¦å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰ä¼šå°†çˆ¶è¿›ç¨‹çš„å†…å®¹å¤åˆ¶ä¸€ä»½ç»™å­è¿›ç¨‹ã€‚</li>\n</ul>\n<h3 id=\"1225rdbæŒä¹…åŒ–æµç¨‹\"><a class=\"markdownIt-Anchor\" href=\"#1225rdbæŒä¹…åŒ–æµç¨‹\">#</a> 12.2.5.\tRDB æŒä¹…åŒ–æµç¨‹</h3>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731174221520.png\" alt=\"image-20220731174221520\"></p>\n<h3 id=\"1226dumprdbæ–‡ä»¶\"><a class=\"markdownIt-Anchor\" href=\"#1226dumprdbæ–‡ä»¶\">#</a> 12.2.6.\tdump.rdb æ–‡ä»¶</h3>\n<p>åœ¨ redis.conf ä¸­é…ç½®æ–‡ä»¶åç§°ï¼Œé»˜è®¤ä¸º dump.rdb</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731174310211.png\" alt=\"image-20220731174310211\"></p>\n<h3 id=\"1227é…ç½®ä½ç½®\"><a class=\"markdownIt-Anchor\" href=\"#1227é…ç½®ä½ç½®\">#</a> 12.2.7.\té…ç½®ä½ç½®</h3>\n<p>rdb æ–‡ä»¶çš„ä¿å­˜è·¯å¾„ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹ã€‚é»˜è®¤ä¸º Redis å¯åŠ¨æ—¶å‘½ä»¤è¡Œæ‰€åœ¨çš„ç›®å½•ä¸‹<br>\n dir â€œ/myredis/â€</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731174540479.png\" alt=\"image-20220731174540479\"></p>\n<h3 id=\"1228å¦‚ä½•è§¦å‘rdbå¿«ç…§ä¿æŒç­–ç•¥\"><a class=\"markdownIt-Anchor\" href=\"#1228å¦‚ä½•è§¦å‘rdbå¿«ç…§ä¿æŒç­–ç•¥\">#</a> 12.2.8.\tå¦‚ä½•è§¦å‘ RDB å¿«ç…§ï¼›ä¿æŒç­–ç•¥</h3>\n<p><strong>12.2.8.1.\té…ç½®æ–‡ä»¶ä¸­é»˜è®¤çš„å¿«ç…§é…ç½®</strong></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731174621350.png\" alt=\"image-20220731174621350\"></p>\n<p><strong>12.2.8.2.\tå‘½ä»¤ save VS bgsave</strong></p>\n<p><code>save</code>  ï¼šsave æ—¶åªç®¡ä¿å­˜ï¼Œå…¶å®ƒä¸ç®¡ï¼Œå…¨éƒ¨é˜»å¡ã€‚æ‰‹åŠ¨ä¿å­˜ã€‚ä¸å»ºè®®ã€‚</p>\n<p><code>bgsave</code> ï¼šRedis ä¼šåœ¨åå°å¼‚æ­¥è¿›è¡Œå¿«ç…§æ“ä½œï¼Œ <strong>å¿«ç…§åŒæ—¶è¿˜å¯ä»¥å“åº”å®¢æˆ·ç«¯è¯·æ±‚ã€‚</strong></p>\n<p>å¯ä»¥é€šè¿‡ lastsave å‘½ä»¤è·å–æœ€åä¸€æ¬¡æˆåŠŸæ‰§è¡Œå¿«ç…§çš„æ—¶é—´</p>\n<p><strong>12.2.8.3.\tflushall å‘½ä»¤</strong></p>\n<p>æ‰§è¡Œ flushall å‘½ä»¤ï¼Œä¹Ÿä¼šäº§ç”Ÿ dump.rdb æ–‡ä»¶ï¼Œä½†é‡Œé¢æ˜¯ç©ºçš„ï¼Œæ— æ„ä¹‰</p>\n<p><strong>12.2.8.4.\t###SNAPSHOTTING å¿«ç…§ ###</strong></p>\n<p><strong>12.2.8.5.\tSave</strong></p>\n<p>æ ¼å¼ï¼šsave ç§’é’Ÿ å†™æ“ä½œæ¬¡æ•°</p>\n<p>RDB æ˜¯æ•´ä¸ªå†…å­˜çš„å‹ç¼©è¿‡çš„ Snapshotï¼ŒRDB çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥é…ç½®å¤åˆçš„å¿«ç…§è§¦å‘æ¡ä»¶ï¼Œ</p>\n<p><strong>é»˜è®¤æ˜¯ 1 åˆ†é’Ÿå†…æ”¹äº† 1 ä¸‡æ¬¡ï¼Œæˆ– 5 åˆ†é’Ÿå†…æ”¹äº† 10 æ¬¡ï¼Œæˆ– 15 åˆ†é’Ÿå†…æ”¹äº† 1 æ¬¡ã€‚</strong></p>\n<p><strong>ç¦ç”¨ï¼šä¸è®¾ç½® save æŒ‡ä»¤ï¼Œæˆ–è€…ç»™ save ä¼ å…¥ç©ºå­—ç¬¦ä¸²</strong></p>\n<p><strong>12.2.8.6.\tstop-writes-on-bgsave-error</strong></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731175145278.png\" alt=\"image-20220731175145278\"></p>\n<p>å½“ Redis æ— æ³•å†™å…¥ç£ç›˜çš„è¯ï¼Œç›´æ¥å…³æ‰ Redis çš„å†™æ“ä½œã€‚æ¨è yes.</p>\n<p><strong>12.2.8.7.\trdbcompression å‹ç¼©æ–‡ä»¶</strong></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731175201409.png\" alt=\"image-20220731175201409\"></p>\n<p>å¯¹äºå­˜å‚¨åˆ°ç£ç›˜ä¸­çš„å¿«ç…§ï¼Œå¯ä»¥è®¾ç½®æ˜¯å¦è¿›è¡Œå‹ç¼©å­˜å‚¨ã€‚å¦‚æœæ˜¯çš„è¯ï¼Œredis ä¼šé‡‡ç”¨ <code>LZFç®—æ³•</code> è¿›è¡Œå‹ç¼©ã€‚</p>\n<p>å¦‚æœä½ ä¸æƒ³æ¶ˆè€— CPU æ¥è¿›è¡Œå‹ç¼©çš„è¯ï¼Œå¯ä»¥è®¾ç½®ä¸ºå…³é—­æ­¤åŠŸèƒ½ã€‚æ¨è yes.</p>\n<p><strong>12.2.8.8.\trdbchecksum æ£€æŸ¥å®Œæ•´æ€§</strong></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731175342119.png\" alt=\"image-20220731175342119\"></p>\n<p>åœ¨å­˜å‚¨å¿«ç…§åï¼Œè¿˜å¯ä»¥è®© redis ä½¿ç”¨ <code>CRC64ç®—æ³•</code> æ¥è¿›è¡Œæ•°æ®æ ¡éªŒï¼Œ</p>\n<p>ä½†æ˜¯è¿™æ ·åšä¼šå¢åŠ å¤§çº¦ 10% çš„æ€§èƒ½æ¶ˆè€—ï¼Œå¦‚æœå¸Œæœ›è·å–åˆ°æœ€å¤§çš„æ€§èƒ½æå‡ï¼Œå¯ä»¥å…³é—­æ­¤åŠŸèƒ½ ã€‚æ¨è yes.</p>\n<p><strong>12.2.8.9.\trdb çš„å¤‡ä»½</strong></p>\n<p>å…ˆé€šè¿‡ config get dir  æŸ¥è¯¢ rdb æ–‡ä»¶çš„ç›®å½•</p>\n<p>å°† *.rdb çš„æ–‡ä»¶æ‹·è´åˆ°åˆ«çš„åœ°æ–¹</p>\n<p>rdb çš„æ¢å¤</p>\n<ul>\n<li>å…³é—­ Redis</li>\n<li>å…ˆæŠŠå¤‡ä»½çš„æ–‡ä»¶æ‹·è´åˆ°å·¥ä½œç›®å½•ä¸‹  <code>cp dump2.rdb dump.rdb</code></li>\n<li>å¯åŠ¨ Redis, å¤‡ä»½æ•°æ®ä¼šç›´æ¥åŠ è½½</li>\n</ul>\n<h3 id=\"1229ä¼˜åŠ¿\"><a class=\"markdownIt-Anchor\" href=\"#1229ä¼˜åŠ¿\">#</a> 12.2.9.\tä¼˜åŠ¿</h3>\n<ul>\n<li>é€‚åˆå¤§è§„æ¨¡çš„æ•°æ®æ¢å¤</li>\n<li>å¯¹æ•°æ®å®Œæ•´æ€§å’Œä¸€è‡´æ€§è¦æ±‚ä¸é«˜æ›´é€‚åˆä½¿ç”¨</li>\n<li>èŠ‚çœç£ç›˜ç©ºé—´</li>\n<li>æ¢å¤é€Ÿåº¦å¿«</li>\n</ul>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731175646400.png\" alt=\"image-20220731175646400\"></p>\n<h3 id=\"12210åŠ£åŠ¿\"><a class=\"markdownIt-Anchor\" href=\"#12210åŠ£åŠ¿\">#</a> 12.2.10.\tåŠ£åŠ¿</h3>\n<ul>\n<li>\n<p>Fork çš„æ—¶å€™ï¼Œå†…å­˜ä¸­çš„æ•°æ®è¢«å…‹éš†äº†ä¸€ä»½ï¼Œå¤§è‡´ 2 å€çš„è†¨èƒ€æ€§éœ€è¦è€ƒè™‘</p>\n</li>\n<li>\n<p>è™½ç„¶ Redis åœ¨ fork æ—¶ä½¿ç”¨äº†<strong>å†™æ—¶æ‹·è´æŠ€æœ¯</strong>ï¼Œä½†æ˜¯å¦‚æœæ•°æ®åºå¤§æ—¶è¿˜æ˜¯æ¯”è¾ƒæ¶ˆè€—æ€§èƒ½</p>\n</li>\n<li>\n<p><strong>åœ¨å¤‡ä»½å‘¨æœŸåœ¨ä¸€å®šé—´éš”æ—¶é—´åšä¸€æ¬¡å¤‡ä»½ï¼Œæ‰€ä»¥å¦‚æœ Redis æ„å¤– down æ‰çš„è¯ï¼Œå°±ä¼šä¸¢å¤±æœ€åä¸€æ¬¡å¿«ç…§åçš„æ‰€æœ‰ä¿®æ”¹</strong>ã€‚</p>\n</li>\n</ul>\n<h3 id=\"12211å¦‚ä½•åœæ­¢\"><a class=\"markdownIt-Anchor\" href=\"#12211å¦‚ä½•åœæ­¢\">#</a> 12.2.11.\tå¦‚ä½•åœæ­¢</h3>\n<p>åŠ¨æ€åœæ­¢ RDBï¼š <code>redis-cli config set save &quot;&quot; </code>  #save åç»™ç©ºå€¼ï¼Œè¡¨ç¤ºç¦ç”¨ä¿å­˜ç­–ç•¥</p>\n<h3 id=\"12212å°æ€»ç»“\"><a class=\"markdownIt-Anchor\" href=\"#12212å°æ€»ç»“\">#</a> 12.2.12.\tå°æ€»ç»“</h3>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731175756853.png\" alt=\"image-20220731175756853\"></p>\n<h1 id=\"åä¸‰-redisæŒä¹…åŒ–ä¹‹aof\"><a class=\"markdownIt-Anchor\" href=\"#åä¸‰-redisæŒä¹…åŒ–ä¹‹aof\">#</a> åä¸‰ã€Redis æŒä¹…åŒ–ä¹‹ AOF</h1>\n<h2 id=\"1-aofappend-only-file\"><a class=\"markdownIt-Anchor\" href=\"#1-aofappend-only-file\">#</a> 1 - AOFï¼ˆAppend Only Fileï¼‰</h2>\n<h3 id=\"1311æ˜¯ä»€ä¹ˆ\"><a class=\"markdownIt-Anchor\" href=\"#1311æ˜¯ä»€ä¹ˆ\">#</a> 13.1.1.\tæ˜¯ä»€ä¹ˆ</h3>\n<p>ä»¥<strong>æ—¥å¿—çš„å½¢å¼æ¥è®°å½•æ¯ä¸ªå†™æ“ä½œï¼ˆå¢é‡ä¿å­˜ï¼‰</strong>ï¼Œå°† Redis æ‰§è¡Œè¿‡çš„æ‰€æœ‰å†™æŒ‡ä»¤è®°å½•ä¸‹æ¥ (<strong>è¯»æ“ä½œä¸è®°å½•</strong>)ï¼Œ <strong>åªè®¸è¿½åŠ æ–‡ä»¶ä½†ä¸å¯ä»¥æ”¹å†™æ–‡ä»¶</strong>ï¼Œredis å¯åŠ¨ä¹‹åˆä¼šè¯»å–è¯¥æ–‡ä»¶é‡æ–°æ„å»ºæ•°æ®ï¼Œæ¢è¨€ä¹‹ï¼Œredis é‡å¯çš„è¯å°±æ ¹æ®æ—¥å¿—æ–‡ä»¶çš„å†…å®¹å°†<strong>å†™æŒ‡ä»¤</strong>ä»å‰åˆ°åæ‰§è¡Œä¸€æ¬¡ä»¥å®Œæˆæ•°æ®çš„æ¢å¤å·¥ä½œ</p>\n<h3 id=\"1312aofæŒä¹…åŒ–æµç¨‹\"><a class=\"markdownIt-Anchor\" href=\"#1312aofæŒä¹…åŒ–æµç¨‹\">#</a> 13.1.2.\tAOF æŒä¹…åŒ–æµç¨‹</h3>\n<p>ï¼ˆ1ï¼‰å®¢æˆ·ç«¯çš„è¯·æ±‚å†™å‘½ä»¤ä¼šè¢« append è¿½åŠ åˆ° AOF ç¼“å†²åŒºå†…ï¼›</p>\n<p>ï¼ˆ2ï¼‰AOF ç¼“å†²åŒºæ ¹æ® AOF æŒä¹…åŒ–ç­–ç•¥ [always,everysec,no] å°†æ“ä½œ sync åŒæ­¥åˆ°ç£ç›˜çš„ AOF æ–‡ä»¶ä¸­ï¼›</p>\n<p>ï¼ˆ3ï¼‰AOF æ–‡ä»¶å¤§å°è¶…è¿‡é‡å†™ç­–ç•¥æˆ–æ‰‹åŠ¨é‡å†™æ—¶ï¼Œä¼šå¯¹ AOF æ–‡ä»¶ rewrite é‡å†™ï¼Œå‹ç¼© AOF æ–‡ä»¶å®¹é‡ï¼›</p>\n<p>ï¼ˆ4ï¼‰Redis æœåŠ¡é‡å¯æ—¶ï¼Œä¼šé‡æ–° load åŠ è½½ AOF æ–‡ä»¶ä¸­çš„å†™æ“ä½œè¾¾åˆ°æ•°æ®æ¢å¤çš„ç›®çš„ï¼›</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731180326215.png\" alt=\"image-20220731180326215\"></p>\n<h3 id=\"1313aofé»˜è®¤ä¸å¼€å¯\"><a class=\"markdownIt-Anchor\" href=\"#1313aofé»˜è®¤ä¸å¼€å¯\">#</a> 13.1.3.\tAOF é»˜è®¤ä¸å¼€å¯</h3>\n<p>å¯ä»¥åœ¨ redis.conf ä¸­é…ç½®æ–‡ä»¶åç§°ï¼Œé»˜è®¤ä¸º  <code>appendonly.aof</code></p>\n<p>AOF æ–‡ä»¶çš„ä¿å­˜è·¯å¾„ï¼ŒåŒ RDB çš„è·¯å¾„ä¸€è‡´ã€‚</p>\n<h3 id=\"1314aofå’ŒrdbåŒæ—¶å¼€å¯rediså¬è°çš„\"><a class=\"markdownIt-Anchor\" href=\"#1314aofå’ŒrdbåŒæ—¶å¼€å¯rediså¬è°çš„\">#</a> 13.1.4.\tAOF å’Œ RDB åŒæ—¶å¼€å¯ï¼Œredis å¬è°çš„ï¼Ÿ</h3>\n<p>AOF å’Œ RDB åŒæ—¶å¼€å¯ï¼Œç³»ç»Ÿé»˜è®¤å– AOF çš„æ•°æ®ï¼ˆæ•°æ®ä¸ä¼šå­˜åœ¨ä¸¢å¤±ï¼‰</p>\n<h3 id=\"1315aofå¯åŠ¨ä¿®å¤æ¢å¤\"><a class=\"markdownIt-Anchor\" href=\"#1315aofå¯åŠ¨ä¿®å¤æ¢å¤\">#</a> 13.1.5.\tAOF å¯åŠ¨ / ä¿®å¤ / æ¢å¤</h3>\n<ul>\n<li>\n<p>AOF çš„å¤‡ä»½æœºåˆ¶å’Œæ€§èƒ½è™½ç„¶å’Œ RDB ä¸åŒï¼Œä½†æ˜¯å¤‡ä»½å’Œæ¢å¤çš„æ“ä½œåŒ RDB ä¸€æ ·ï¼Œéƒ½æ˜¯æ‹·è´å¤‡ä»½æ–‡ä»¶ï¼Œéœ€è¦æ¢å¤æ—¶å†æ‹·è´åˆ° Redis å·¥ä½œç›®å½•ä¸‹ï¼Œå¯åŠ¨ç³»ç»Ÿå³åŠ è½½ã€‚</p>\n</li>\n<li>\n<p>æ­£å¸¸æ¢å¤</p>\n<ul>\n<li>ä¿®æ”¹é»˜è®¤çš„ appendonly noï¼Œæ”¹ä¸º yes</li>\n<li>å°†æœ‰æ•°æ®çš„ aof æ–‡ä»¶å¤åˆ¶ä¸€ä»½ä¿å­˜åˆ°å¯¹åº”ç›®å½• (æŸ¥çœ‹ç›®å½•ï¼šconfig get dir)</li>\n<li>æ¢å¤ï¼šé‡å¯ redis ç„¶åé‡æ–°åŠ è½½</li>\n</ul>\n</li>\n<li>\n<p>å¼‚å¸¸æ¢å¤</p>\n<ul>\n<li>ä¿®æ”¹é»˜è®¤çš„ appendonly noï¼Œæ”¹ä¸º yes</li>\n<li>å¦‚é‡åˆ°<strong> AOF æ–‡ä»¶æŸå</strong>ï¼Œé€šè¿‡ /<strong>usr/local/bin/redis-check-aofâ€“fix appendonly.aof</strong> è¿›è¡Œæ¢å¤</li>\n<li>å¤‡ä»½è¢«å†™åçš„ AOF æ–‡ä»¶</li>\n<li>æ¢å¤ï¼šé‡å¯ redisï¼Œç„¶åé‡æ–°åŠ è½½</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"1316aofåŒæ­¥é¢‘ç‡è®¾ç½®\"><a class=\"markdownIt-Anchor\" href=\"#1316aofåŒæ­¥é¢‘ç‡è®¾ç½®\">#</a> 13.1.6.\tAOF åŒæ­¥é¢‘ç‡è®¾ç½®</h3>\n<p><code>appendfsync always</code> <br>\n å§‹ç»ˆåŒæ­¥ï¼Œæ¯æ¬¡ Redis çš„å†™å…¥éƒ½ä¼šç«‹åˆ»è®°å…¥æ—¥å¿—ï¼›æ€§èƒ½è¾ƒå·®ä½†æ•°æ®å®Œæ•´æ€§æ¯”è¾ƒå¥½<br>\n <code>appendfsync everysec</code> <br>\n æ¯ç§’åŒæ­¥ï¼Œæ¯ç§’è®°å…¥æ—¥å¿—ä¸€æ¬¡ï¼Œå¦‚æœå®•æœºï¼Œæœ¬ç§’çš„æ•°æ®å¯èƒ½ä¸¢å¤±ã€‚<br>\n <code>appendfsync no</code> <br>\nredis ä¸ä¸»åŠ¨è¿›è¡ŒåŒæ­¥ï¼ŒæŠŠåŒæ­¥æ—¶æœºäº¤ç»™æ“ä½œç³»ç»Ÿã€‚</p>\n<h3 id=\"1317rewriteå‹ç¼©\"><a class=\"markdownIt-Anchor\" href=\"#1317rewriteå‹ç¼©\">#</a> 13.1.7.\tRewrite å‹ç¼©</h3>\n<ol>\n<li>\n<p>æ˜¯ä»€ä¹ˆï¼š<br>\nAOF é‡‡ç”¨<strong>æ–‡ä»¶è¿½åŠ </strong>æ–¹å¼ï¼Œæ–‡ä»¶ä¼šè¶Šæ¥è¶Šå¤§ä¸ºé¿å…å‡ºç°æ­¤ç§æƒ…å†µï¼Œæ–°å¢äº†<strong>é‡å†™æœºåˆ¶</strong>ï¼Œå½“ AOF æ–‡ä»¶çš„å¤§å°è¶…è¿‡æ‰€è®¾å®šçš„é˜ˆå€¼æ—¶ï¼ŒRedis å°±ä¼šå¯åŠ¨ AOF æ–‡ä»¶çš„<strong>å†…å®¹å‹ç¼©</strong>ï¼Œ åªä¿ç•™å¯ä»¥æ¢å¤æ•°æ®çš„<strong>æœ€å°æŒ‡ä»¤é›†</strong>ã€‚å¯ä»¥ä½¿ç”¨å‘½ä»¤ <code>bgrewriteaof</code></p>\n</li>\n<li>\n<p>é‡å†™åŸç†ï¼Œå¦‚ä½•å®ç°é‡å†™<br>\n AOF æ–‡ä»¶æŒç»­å¢é•¿è€Œè¿‡å¤§æ—¶ï¼Œä¼š fork å‡ºä¸€æ¡æ–°è¿›ç¨‹æ¥å°†æ–‡ä»¶é‡å†™ (ä¹Ÿæ˜¯å…ˆå†™ä¸´æ—¶æ–‡ä»¶æœ€åå† rename)ï¼Œ<strong>redis4.0 ç‰ˆæœ¬åçš„é‡å†™ï¼Œæ˜¯æŒ‡ä¸Šå°±æ˜¯æŠŠ rdb çš„å¿«ç…§ï¼Œä»¥äºŒçº§åˆ¶çš„å½¢å¼é™„åœ¨æ–°çš„ aof å¤´éƒ¨ï¼Œä½œä¸ºå·²æœ‰çš„å†å²æ•°æ®ï¼Œæ›¿æ¢æ‰åŸæ¥çš„æµæ°´è´¦æ“ä½œ</strong>ã€‚</p>\n<p><code>no-appendfsync-on-rewrite</code> ï¼š<br>\nå¦‚æœ no-appendfsync-on-rewrite=yes , ä¸å†™å…¥ aof æ–‡ä»¶åªå†™å…¥ <code>ç¼“å­˜</code> ï¼Œç”¨æˆ·è¯·æ±‚ä¸ä¼šé˜»å¡ï¼Œä½†æ˜¯åœ¨è¿™æ®µæ—¶é—´å¦‚æœå®•æœºä¼šä¸¢å¤±è¿™æ®µæ—¶é—´çš„ç¼“å­˜æ•°æ®ã€‚ï¼ˆ<strong>é™ä½æ•°æ®å®‰å…¨æ€§ï¼Œæé«˜æ€§èƒ½</strong>ï¼‰</p>\n<p>â€‹\tå¦‚æœ no-appendfsync-on-rewrite=no,  è¿˜æ˜¯ä¼šæŠŠæ•°æ®å¾€ <code>ç£ç›˜</code> é‡Œåˆ·ï¼Œä½†æ˜¯é‡åˆ°é‡å†™æ“ä½œï¼Œå¯èƒ½ä¼šå‘ç”Ÿé˜»å¡ã€‚ï¼ˆ<strong>æ•°æ®å®‰å…¨ï¼Œä½†æ˜¯æ€§èƒ½é™ä½</strong>ï¼‰</p>\n<p>è§¦å‘æœºåˆ¶ï¼Œä½•æ—¶é‡å†™</p>\n<p>Redis ä¼šè®°å½•ä¸Šæ¬¡é‡å†™æ—¶çš„ AOF å¤§å°ï¼Œé»˜è®¤é…ç½®æ˜¯å½“ AOF æ–‡ä»¶å¤§å°æ˜¯ä¸Šæ¬¡ rewrite åå¤§å°çš„ä¸€å€ä¸”æ–‡ä»¶å¤§äº 64M æ—¶è§¦å‘</p>\n<p>é‡å†™è™½ç„¶å¯ä»¥èŠ‚çº¦å¤§é‡ç£ç›˜ç©ºé—´ï¼Œå‡å°‘æ¢å¤æ—¶é—´ã€‚ä½†æ˜¯æ¯æ¬¡é‡å†™è¿˜æ˜¯æœ‰ä¸€å®šçš„è´Ÿæ‹…çš„ï¼Œå› æ­¤è®¾å®š Redis è¦æ»¡è¶³ä¸€å®šæ¡ä»¶æ‰ä¼šè¿›è¡Œé‡å†™ã€‚</p>\n<p><code>auto-aof-rewrite-percentage</code> ï¼šè®¾ç½®é‡å†™çš„åŸºå‡†å€¼ï¼Œæ–‡ä»¶è¾¾åˆ° 100% æ—¶å¼€å§‹é‡å†™ï¼ˆæ–‡ä»¶æ˜¯åŸæ¥é‡å†™åæ–‡ä»¶çš„ 2 å€æ—¶è§¦å‘ï¼‰</p>\n<p><code>auto-aof-rewrite-min-size</code> ï¼šè®¾ç½®é‡å†™çš„åŸºå‡†å€¼ï¼Œæœ€å°æ–‡ä»¶ 64MBã€‚è¾¾åˆ°è¿™ä¸ªå€¼å¼€å§‹é‡å†™ã€‚</p>\n<p>** ä¾‹å¦‚ï¼š** æ–‡ä»¶è¾¾åˆ° 70MB å¼€å§‹é‡å†™ï¼Œé™åˆ° 50MBï¼Œä¸‹æ¬¡ä»€ä¹ˆæ—¶å€™å¼€å§‹é‡å†™ï¼Ÿ100MB</p>\n<p>ç³»ç»Ÿè½½å…¥æ—¶æˆ–è€…ä¸Šæ¬¡é‡å†™å®Œæ¯•æ—¶ï¼ŒRedis ä¼šè®°å½•æ­¤æ—¶ AOF å¤§å°ï¼Œè®¾ä¸º base_size,</p>\n<p>å¦‚æœ Redis çš„ AOF å½“å‰å¤§å° &gt;= base_size +base_size*100% (é»˜è®¤) ä¸”å½“å‰å¤§å° &gt;=64mb (é»˜è®¤) çš„æƒ…å†µä¸‹ï¼ŒRedis ä¼šå¯¹ AOF è¿›è¡Œé‡å†™ã€‚</p>\n</li>\n<li>\n<p>é‡å†™æµç¨‹<br>\nï¼ˆ1ï¼‰bgrewriteaof è§¦å‘é‡å†™ï¼Œåˆ¤æ–­æ˜¯å¦å½“å‰æœ‰ bgsave æˆ– bgrewriteaof åœ¨è¿è¡Œï¼Œå¦‚æœæœ‰ï¼Œåˆ™ç­‰å¾…è¯¥å‘½ä»¤ç»“æŸåå†ç»§ç»­æ‰§è¡Œã€‚</p>\n<p>ï¼ˆ2ï¼‰ä¸»è¿›ç¨‹ fork å‡ºå­è¿›ç¨‹æ‰§è¡Œé‡å†™æ“ä½œï¼Œä¿è¯ä¸»è¿›ç¨‹ä¸ä¼šé˜»å¡ã€‚</p>\n<p>ï¼ˆ3ï¼‰å­è¿›ç¨‹éå† redis å†…å­˜ä¸­æ•°æ®åˆ°ä¸´æ—¶æ–‡ä»¶ï¼Œå®¢æˆ·ç«¯çš„å†™è¯·æ±‚åŒæ—¶å†™å…¥ aof_buf ç¼“å†²åŒºå’Œ aof_rewrite_buf é‡å†™ç¼“å†²åŒºä¿è¯åŸ AOF æ–‡ä»¶å®Œæ•´ä»¥åŠæ–° AOF æ–‡ä»¶ç”ŸæˆæœŸé—´çš„æ–°çš„æ•°æ®ä¿®æ”¹åŠ¨ä½œä¸ä¼šä¸¢å¤±ã€‚</p>\n<p>ï¼ˆ4ï¼‰1). å­è¿›ç¨‹å†™å®Œæ–°çš„ AOF æ–‡ä»¶åï¼Œå‘ä¸»è¿›ç¨‹å‘ä¿¡å·ï¼Œçˆ¶è¿›ç¨‹æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ã€‚2). ä¸»è¿›ç¨‹æŠŠ aof_rewrite_buf ä¸­çš„æ•°æ®å†™å…¥åˆ°æ–°çš„ AOF æ–‡ä»¶ã€‚</p>\n<p>ï¼ˆ5ï¼‰ä½¿ç”¨æ–°çš„ AOF æ–‡ä»¶è¦†ç›–æ—§çš„ AOF æ–‡ä»¶ï¼Œå®Œæˆ AOF é‡å†™ã€‚</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731213215703.png\" alt=\"image-20220731213215703\"></p>\n</li>\n</ol>\n<h3 id=\"1318ä¼˜åŠ¿\"><a class=\"markdownIt-Anchor\" href=\"#1318ä¼˜åŠ¿\">#</a> 13.1.8.\tä¼˜åŠ¿</h3>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731213229824.png\" alt=\"image-20220731213229824\"></p>\n<ul>\n<li>\n<p>å¤‡ä»½æœºåˆ¶æ›´ç¨³å¥ï¼Œä¸¢å¤±æ•°æ®æ¦‚ç‡æ›´ä½ã€‚</p>\n</li>\n<li>\n<p>å¯è¯»çš„æ—¥å¿—æ–‡æœ¬ï¼Œé€šè¿‡æ“ä½œ AOF ç¨³å¥ï¼Œå¯ä»¥å¤„ç†è¯¯æ“ä½œã€‚</p>\n</li>\n</ul>\n<h3 id=\"1319åŠ£åŠ¿\"><a class=\"markdownIt-Anchor\" href=\"#1319åŠ£åŠ¿\">#</a> 13.1.9.\tåŠ£åŠ¿</h3>\n<ul>\n<li>æ¯”èµ· RDB å ç”¨æ›´å¤šçš„ç£ç›˜ç©ºé—´ã€‚</li>\n<li>æ¢å¤å¤‡ä»½é€Ÿåº¦è¦æ…¢ã€‚</li>\n<li>æ¯æ¬¡è¯»å†™éƒ½åŒæ­¥çš„è¯ï¼Œæœ‰ä¸€å®šçš„æ€§èƒ½å‹åŠ›ã€‚</li>\n<li>å­˜åœ¨ä¸ªåˆ« Bugï¼Œé€ æˆæ¢å¤ä¸èƒ½ã€‚</li>\n</ul>\n<h3 id=\"13110-å°æ€»ç»“\"><a class=\"markdownIt-Anchor\" href=\"#13110-å°æ€»ç»“\">#</a> 13.1.10.\t  å°æ€»ç»“</h3>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731213332159.png\" alt=\"image-20220731213332159\"></p>\n<h2 id=\"2-æ€»ç»“which-one\"><a class=\"markdownIt-Anchor\" href=\"#2-æ€»ç»“which-one\">#</a> 2 - æ€»ç»“ (Which one)</h2>\n<h3 id=\"1321ç”¨å“ªä¸ªå¥½\"><a class=\"markdownIt-Anchor\" href=\"#1321ç”¨å“ªä¸ªå¥½\">#</a> 13.2.1.\tç”¨å“ªä¸ªå¥½</h3>\n<p>å®˜æ–¹æ¨èä¸¤ä¸ªéƒ½å¯ç”¨ã€‚</p>\n<p>å¦‚æœå¯¹æ•°æ®ä¸æ•æ„Ÿï¼Œå¯ä»¥é€‰å•ç‹¬ç”¨ RDBã€‚</p>\n<p>ä¸å»ºè®®å•ç‹¬ç”¨ AOFï¼Œå› ä¸ºå¯èƒ½ä¼šå‡ºç° Bugã€‚</p>\n<p>å¦‚æœåªæ˜¯åšçº¯å†…å­˜ç¼“å­˜ï¼Œå¯ä»¥éƒ½ä¸ç”¨ã€‚</p>\n<h3 id=\"1322å®˜ç½‘å»ºè®®\"><a class=\"markdownIt-Anchor\" href=\"#1322å®˜ç½‘å»ºè®®\">#</a> 13.2.2.\tå®˜ç½‘å»ºè®®</h3>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731213526710.png\" alt=\"image-20220731213526710\"></p>\n<ul>\n<li>RDB æŒä¹…åŒ–æ–¹å¼èƒ½å¤Ÿåœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”èƒ½å¯¹ä½ çš„æ•°æ®è¿›è¡Œå¿«ç…§å­˜å‚¨</li>\n<li>AOF æŒä¹…åŒ–æ–¹å¼è®°å½•æ¯æ¬¡å¯¹æœåŠ¡å™¨å†™çš„æ“ä½œï¼Œå½“æœåŠ¡å™¨é‡å¯çš„æ—¶å€™ä¼šé‡æ–°æ‰§è¡Œè¿™äº›å‘½ä»¤æ¥æ¢å¤åŸå§‹çš„æ•°æ®ï¼ŒAOF å‘½ä»¤ä»¥ redis åè®®è¿½åŠ ä¿å­˜æ¯æ¬¡å†™çš„æ“ä½œåˆ°æ–‡ä»¶æœ«å°¾.</li>\n<li>Redis è¿˜èƒ½å¯¹ AOF æ–‡ä»¶è¿›è¡Œåå°é‡å†™ï¼Œä½¿å¾— AOF æ–‡ä»¶çš„ä½“ç§¯ä¸è‡³äºè¿‡å¤§</li>\n<li>åªåšç¼“å­˜ï¼šå¦‚æœä½ åªå¸Œæœ›ä½ çš„æ•°æ®åœ¨æœåŠ¡å™¨è¿è¡Œçš„æ—¶å€™å­˜åœ¨ï¼Œä½ ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ä»»ä½•æŒä¹…åŒ–æ–¹å¼.</li>\n<li>åŒæ—¶å¼€å¯ä¸¤ç§æŒä¹…åŒ–æ–¹å¼</li>\n<li>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“ redis é‡å¯çš„æ—¶å€™ä¼šä¼˜å…ˆè½½å…¥ AOF æ–‡ä»¶æ¥æ¢å¤åŸå§‹çš„æ•°æ®ï¼Œå› ä¸ºåœ¨é€šå¸¸æƒ…å†µä¸‹ AOF æ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†è¦æ¯” RDB æ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†è¦å®Œæ•´.</li>\n<li>RDB çš„æ•°æ®ä¸å®æ—¶ï¼ŒåŒæ—¶ä½¿ç”¨ä¸¤è€…æ—¶æœåŠ¡å™¨é‡å¯ä¹Ÿåªä¼šæ‰¾ AOF æ–‡ä»¶ã€‚é‚£è¦ä¸è¦åªä½¿ç”¨ AOF å‘¢ï¼Ÿ</li>\n<li>å»ºè®®ä¸è¦ï¼Œå› ä¸º RDB æ›´é€‚åˆç”¨äºå¤‡ä»½æ•°æ®åº“ (AOF åœ¨ä¸æ–­å˜åŒ–ä¸å¥½å¤‡ä»½)ï¼Œ å¿«é€Ÿé‡å¯ï¼Œè€Œä¸”ä¸ä¼šæœ‰ AOF å¯èƒ½æ½œåœ¨çš„ bugï¼Œç•™ç€ä½œä¸ºä¸€ä¸ªä¸‡ä¸€çš„æ‰‹æ®µã€‚</li>\n<li>æ€§èƒ½å»ºè®®</li>\n</ul>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731213730871.png\" alt=\"image-20220731213730871\"></p>\n<h1 id=\"åå››-redis_ä¸»ä»å¤åˆ¶\"><a class=\"markdownIt-Anchor\" href=\"#åå››-redis_ä¸»ä»å¤åˆ¶\">#</a> åå››ã€Redis_ä¸»ä»å¤åˆ¶</h1>\n<h2 id=\"1-æ˜¯ä»€ä¹ˆ\"><a class=\"markdownIt-Anchor\" href=\"#1-æ˜¯ä»€ä¹ˆ\">#</a> 1 - æ˜¯ä»€ä¹ˆ</h2>\n<p>ä¸»æœºæ•°æ®æ›´æ–°åæ ¹æ®é…ç½®å’Œç­–ç•¥ï¼Œ è‡ªåŠ¨åŒæ­¥åˆ°å¤‡æœºçš„<strong> master/slaver æœºåˆ¶ï¼ŒMaster ä»¥å†™ä¸ºä¸»ï¼ŒSlave ä»¥è¯»ä¸ºä¸»</strong></p>\n<h2 id=\"2-èƒ½å¹²å˜›\"><a class=\"markdownIt-Anchor\" href=\"#2-èƒ½å¹²å˜›\">#</a> 2 - èƒ½å¹²å˜›</h2>\n<ul>\n<li>è¯»å†™åˆ†ç¦»ï¼Œæ€§èƒ½æ‰©å±•</li>\n<li>å®¹ç¾å¿«é€Ÿæ¢å¤</li>\n</ul>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731213848099.png\" alt=\"image-20220731213848099\"></p>\n<h2 id=\"3-æ€ä¹ˆç©ä¸»ä»å¤åˆ¶\"><a class=\"markdownIt-Anchor\" href=\"#3-æ€ä¹ˆç©ä¸»ä»å¤åˆ¶\">#</a> 3 - æ€ä¹ˆç©ï¼šä¸»ä»å¤åˆ¶</h2>\n<ol>\n<li>\n<p>æ‹·è´å¤šä¸ª redis.conf æ–‡ä»¶ include (å†™ç»å¯¹è·¯å¾„)</p>\n</li>\n<li>\n<p>å¼€å¯ daemonize yes</p>\n</li>\n<li>\n<p>Pid æ–‡ä»¶åå­— pidfile</p>\n</li>\n<li>\n<p>æŒ‡å®šç«¯å£ port</p>\n</li>\n<li>\n<p>Log æ–‡ä»¶åå­—</p>\n</li>\n<li>\n<p>dump.rdb åå­— dbfilename</p>\n</li>\n<li>\n<p>Appendonly å…³æ‰æˆ–è€…æ¢åå­—</p>\n</li>\n</ol>\n<h3 id=\"1431æ–°å»ºredis6379confå¡«å†™ä»¥ä¸‹å†…å®¹\"><a class=\"markdownIt-Anchor\" href=\"#1431æ–°å»ºredis6379confå¡«å†™ä»¥ä¸‹å†…å®¹\">#</a> 14.3.1.\tæ–°å»º redis6379.confï¼Œå¡«å†™ä»¥ä¸‹å†…å®¹</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>include /myredis/redis.conf</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>pidfile /var/run/redis_6379.pid</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>port <span class=\"token number\">6379</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>dbfilename dump6379.rdb</pre></td></tr></table></figure><p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731214026263.png\" alt=\"image-20220731214026263\"></p>\n<h3 id=\"1432æ–°å»ºredis6380confå¡«å†™ä»¥ä¸‹å†…å®¹\"><a class=\"markdownIt-Anchor\" href=\"#1432æ–°å»ºredis6380confå¡«å†™ä»¥ä¸‹å†…å®¹\">#</a> 14.3.2.\tæ–°å»º redis6380.confï¼Œå¡«å†™ä»¥ä¸‹å†…å®¹</h3>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731214039132.png\" alt=\"image-20220731214039132\"></p>\n<h3 id=\"1433æ–°å»ºredis6381confå¡«å†™ä»¥ä¸‹å†…å®¹\"><a class=\"markdownIt-Anchor\" href=\"#1433æ–°å»ºredis6381confå¡«å†™ä»¥ä¸‹å†…å®¹\">#</a> 14.3.3.\tæ–°å»º redis6381.confï¼Œå¡«å†™ä»¥ä¸‹å†…å®¹</h3>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731214050893.png\" alt=\"image-20220731214050893\"></p>\n<p><strong>slave-priority 10</strong></p>\n<p><strong>è®¾ç½®ä»æœºçš„ä¼˜å…ˆçº§ï¼Œå€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œç”¨äºé€‰ä¸¾ä¸»æœºæ—¶ä½¿ç”¨ã€‚é»˜è®¤ 100</strong></p>\n<h3 id=\"1434å¯åŠ¨ä¸‰å°redisæœåŠ¡å™¨\"><a class=\"markdownIt-Anchor\" href=\"#1434å¯åŠ¨ä¸‰å°redisæœåŠ¡å™¨\">#</a> 14.3.4.\tå¯åŠ¨ä¸‰å° redis æœåŠ¡å™¨</h3>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731233845060.png\" alt=\"image-20220731233845060\"></p>\n<h3 id=\"1435æŸ¥çœ‹ç³»ç»Ÿè¿›ç¨‹çœ‹çœ‹ä¸‰å°æœåŠ¡å™¨æ˜¯å¦å¯åŠ¨\"><a class=\"markdownIt-Anchor\" href=\"#1435æŸ¥çœ‹ç³»ç»Ÿè¿›ç¨‹çœ‹çœ‹ä¸‰å°æœåŠ¡å™¨æ˜¯å¦å¯åŠ¨\">#</a> 14.3.5.\tæŸ¥çœ‹ç³»ç»Ÿè¿›ç¨‹ï¼Œçœ‹çœ‹ä¸‰å°æœåŠ¡å™¨æ˜¯å¦å¯åŠ¨</h3>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731233859352.png\" alt=\"image-20220731233859352\"></p>\n<h3 id=\"1436æŸ¥çœ‹ä¸‰å°ä¸»æœºè¿è¡Œæƒ…å†µ\"><a class=\"markdownIt-Anchor\" href=\"#1436æŸ¥çœ‹ä¸‰å°ä¸»æœºè¿è¡Œæƒ…å†µ\">#</a> 14.3.6.\tæŸ¥çœ‹ä¸‰å°ä¸»æœºè¿è¡Œæƒ…å†µ</h3>\n<p><code>info replication</code> <br>\n æ‰“å°ä¸»ä»å¤åˆ¶çš„ç›¸å…³ä¿¡æ¯</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731233920372.png\" alt=\"image-20220731233920372\"></p>\n<h3 id=\"1437é…ä»åº“ä¸é…ä¸»åº“\"><a class=\"markdownIt-Anchor\" href=\"#1437é…ä»åº“ä¸é…ä¸»åº“\">#</a> 14.3.7.\té…ä» (åº“) ä¸é…ä¸» (åº“)</h3>\n<p><code>slaveof  &lt;ip&gt;&lt;port&gt;</code></p>\n<p>æˆä¸ºæŸä¸ªå®ä¾‹çš„ä»æœåŠ¡å™¨</p>\n<p>1ã€åœ¨ 6380 å’Œ 6381 ä¸Šæ‰§è¡Œ :  slaveof 127.0.0.1 6379</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731233955771.png\" alt=\"image-20220731233955771\"></p>\n<p>2ã€åœ¨ä¸»æœºä¸Šå†™ï¼Œåœ¨ä»æœºä¸Šå¯ä»¥è¯»å–æ•°æ®</p>\n<p>åœ¨ä»æœºä¸Šå†™æ•°æ®æŠ¥é”™</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731234014747.png\" alt=\"image-20220731234014747\"></p>\n<p>3ã€ä¸»æœºæŒ‚æ‰ï¼Œé‡å¯å°±è¡Œï¼Œä¸€åˆ‡å¦‚åˆ</p>\n<p>4ã€ä»æœºé‡å¯éœ€é‡è®¾ï¼šslaveof 127.0.0.1 6379</p>\n<p>å¯ä»¥å°†é…ç½®å¢åŠ åˆ°æ–‡ä»¶ä¸­ã€‚æ°¸ä¹…ç”Ÿæ•ˆã€‚</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220731234028351.png\" alt=\"image-20220731234028351\"></p>\n<h2 id=\"4-å¸¸ç”¨3æ‹›\"><a class=\"markdownIt-Anchor\" href=\"#4-å¸¸ç”¨3æ‹›\">#</a> 4 - å¸¸ç”¨ 3 æ‹›</h2>\n<h3 id=\"1441ä¸€ä¸»äºŒä»†\"><a class=\"markdownIt-Anchor\" href=\"#1441ä¸€ä¸»äºŒä»†\">#</a> 14.4.1.\tä¸€ä¸»äºŒä»†</h3>\n<p>åˆ‡å…¥ç‚¹é—®é¢˜ï¼Ÿslave1ã€slave2 æ˜¯ä»å¤´å¼€å§‹å¤åˆ¶è¿˜æ˜¯ä»åˆ‡å…¥ç‚¹å¼€å§‹å¤åˆ¶ï¼Ÿæ¯”å¦‚ä» k4 è¿›æ¥ï¼Œé‚£ä¹‹å‰çš„ k1,k2,k3 æ˜¯å¦ä¹Ÿå¯ä»¥å¤åˆ¶ï¼Ÿ</p>\n<p>ä»æœºæ˜¯å¦å¯ä»¥å†™ï¼Ÿset å¯å¦ï¼Ÿ</p>\n<p>ä¸»æœº shutdown åæƒ…å†µå¦‚ä½•ï¼Ÿä»æœºæ˜¯ä¸Šä½è¿˜æ˜¯åŸåœ°å¾…å‘½ï¼Ÿ</p>\n<p>ä¸»æœºåˆå›æ¥äº†åï¼Œä¸»æœºæ–°å¢è®°å½•ï¼Œä»æœºè¿˜èƒ½å¦é¡ºåˆ©å¤åˆ¶ï¼Ÿ</p>\n<p>å…¶ä¸­ä¸€å°ä»æœº down åæƒ…å†µå¦‚ä½•ï¼Ÿä¾ç…§åŸæœ‰å®ƒèƒ½è·Ÿä¸Šå¤§éƒ¨é˜Ÿå—ï¼Ÿ</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220801105448121.png\" alt=\"image-20220801105448121\"></p>\n<h3 id=\"1442è–ªç«ç›¸ä¼ \"><a class=\"markdownIt-Anchor\" href=\"#1442è–ªç«ç›¸ä¼ \">#</a> 14.4.2.\tè–ªç«ç›¸ä¼ </h3>\n<p>ä¸Šä¸€ä¸ª Slave å¯ä»¥æ˜¯ä¸‹ä¸€ä¸ª slave çš„ Masterï¼ŒSlave åŒæ ·å¯ä»¥æ¥æ”¶å…¶ä»– slaves çš„è¿æ¥å’ŒåŒæ­¥è¯·æ±‚ï¼Œé‚£ä¹ˆè¯¥ slave ä½œä¸ºäº†é“¾æ¡ä¸­ä¸‹ä¸€ä¸ªçš„ master, å¯ä»¥æœ‰æ•ˆå‡è½» master çš„å†™å‹åŠ›ï¼Œå»ä¸­å¿ƒåŒ–é™ä½é£é™©ã€‚</p>\n<p>ç”¨ <code> slaveof  &lt;ip&gt;&lt;port&gt;</code> <br>\n ä¸­é€”å˜æ›´è½¬å‘ï¼šä¼šæ¸…é™¤ä¹‹å‰çš„æ•°æ®ï¼Œé‡æ–°å»ºç«‹æ‹·è´æœ€æ–°çš„</p>\n<p>é£é™©æ˜¯ä¸€æ—¦æŸä¸ª slave å®•æœºï¼Œåé¢çš„ slave éƒ½æ²¡æ³•å¤‡ä»½</p>\n<p>ä¸»æœºæŒ‚äº†ï¼Œä»æœºè¿˜æ˜¯ä»æœºï¼Œæ— æ³•å†™æ•°æ®äº†</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220801105607960.png\" alt=\"image-20220801105607960\"></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220801105732231.png\" alt=\"image-20220801105732231\"></p>\n<h3 id=\"1443åå®¢ä¸ºä¸»\"><a class=\"markdownIt-Anchor\" href=\"#1443åå®¢ä¸ºä¸»\">#</a> 14.4.3.\tåå®¢ä¸ºä¸»</h3>\n<p>å½“ä¸€ä¸ª master å®•æœºåï¼Œåé¢çš„ slave å¯ä»¥ç«‹åˆ»å‡ä¸º masterï¼Œå…¶åé¢çš„ slave ä¸ç”¨åšä»»ä½•ä¿®æ”¹ã€‚(æ‰‹åŠ¨)</p>\n<p>ç”¨  <code>slaveof no one</code>   å°†ä»æœºå˜ä¸ºä¸»æœºã€‚</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220801105740685.png\" alt=\"image-20220801105740685\"></p>\n<h2 id=\"5-å¤åˆ¶åŸç†\"><a class=\"markdownIt-Anchor\" href=\"#5-å¤åˆ¶åŸç†\">#</a> 5 - å¤åˆ¶åŸç†</h2>\n<ul>\n<li>Slave å¯åŠ¨æˆåŠŸè¿æ¥åˆ° master åä¼šå‘é€ä¸€ä¸ª sync å‘½ä»¤</li>\n<li>Master æ¥åˆ°å‘½ä»¤å¯åŠ¨åå°çš„å­˜ç›˜è¿›ç¨‹ï¼ŒåŒæ—¶æ”¶é›†æ‰€æœ‰æ¥æ”¶åˆ°çš„ç”¨äºä¿®æ”¹æ•°æ®é›†å‘½ä»¤ï¼Œ åœ¨åå°è¿›ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œmaster å°†ä¼ é€æ•´ä¸ªæ•°æ®æ–‡ä»¶åˆ° slave, ä»¥å®Œæˆä¸€æ¬¡å®Œå…¨åŒæ­¥</li>\n<li>å…¨é‡å¤åˆ¶ï¼šè€Œ slave æœåŠ¡åœ¨æ¥æ”¶åˆ°æ•°æ®åº“æ–‡ä»¶æ•°æ®åï¼Œå°†å…¶å­˜ç›˜å¹¶åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</li>\n<li>å¢é‡å¤åˆ¶ï¼šMaster ç»§ç»­å°†æ–°çš„æ‰€æœ‰æ”¶é›†åˆ°çš„ä¿®æ”¹å‘½ä»¤ä¾æ¬¡ä¼ ç»™ slave, å®ŒæˆåŒæ­¥</li>\n<li>ä½†æ˜¯åªè¦æ˜¯é‡æ–°è¿æ¥ master, ä¸€æ¬¡å®Œå…¨åŒæ­¥ï¼ˆå…¨é‡å¤åˆ¶) å°†è¢«è‡ªåŠ¨æ‰§è¡Œ</li>\n</ul>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220801105844173.png\" alt=\"image-20220801105844173\"></p>\n<h2 id=\"6-å“¨å…µæ¨¡å¼sentinel\"><a class=\"markdownIt-Anchor\" href=\"#6-å“¨å…µæ¨¡å¼sentinel\">#</a> 6 - å“¨å…µæ¨¡å¼ (sentinel)</h2>\n<h3 id=\"1461æ˜¯ä»€ä¹ˆ\"><a class=\"markdownIt-Anchor\" href=\"#1461æ˜¯ä»€ä¹ˆ\">#</a> 14.6.1.\tæ˜¯ä»€ä¹ˆ</h3>\n<p><strong>åå®¢ä¸ºä¸»çš„è‡ªåŠ¨ç‰ˆ</strong>ï¼Œèƒ½å¤Ÿåå°ç›‘æ§ä¸»æœºæ˜¯å¦æ•…éšœï¼Œå¦‚æœæ•…éšœäº†æ ¹æ®æŠ•ç¥¨æ•°è‡ªåŠ¨å°†ä»åº“è½¬æ¢ä¸ºä¸»åº“</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220801110018170.png\" alt=\"image-20220801110018170\"></p>\n<h3 id=\"1462æ€ä¹ˆç©ä½¿ç”¨æ­¥éª¤\"><a class=\"markdownIt-Anchor\" href=\"#1462æ€ä¹ˆç©ä½¿ç”¨æ­¥éª¤\">#</a> 14.6.2.\tæ€ä¹ˆç© (ä½¿ç”¨æ­¥éª¤)</h3>\n<p><strong>14.6.2.1.\tè°ƒæ•´ä¸ºä¸€ä¸»äºŒä»†æ¨¡å¼ï¼Œ6379 å¸¦ç€ 6380ã€6381</strong></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220801110034320.png\" alt=\"image-20220801110034320\"></p>\n<p><strong>14.6.2.2.\tè‡ªå®šä¹‰çš„ /myredis ç›®å½•ä¸‹æ–°å»º sentinel.conf æ–‡ä»¶ï¼Œåå­—ç»ä¸èƒ½é”™</strong></p>\n<p><strong>14.6.2.3.\té…ç½®å“¨å…µï¼Œå¡«å†™å†…å®¹</strong></p>\n<p>sentinel monitor mymaster 127.0.0.1 6379 1</p>\n<p>å…¶ä¸­ mymaster ä¸ºç›‘æ§å¯¹è±¡èµ·çš„æœåŠ¡å™¨åç§°ï¼Œ 1 ä¸ºè‡³å°‘æœ‰å¤šå°‘ä¸ªå“¨å…µåŒæ„è¿ç§»çš„æ•°é‡ã€‚</p>\n<p><strong>14.6.2.4.\tå¯åŠ¨å“¨å…µ</strong></p>\n<p>/usr/local/bin</p>\n<p>redis åšå‹æµ‹å¯ä»¥ç”¨è‡ªå¸¦çš„<strong> redis-benchmark</strong> å·¥å…·</p>\n<p>æ‰§è¡Œ<strong> redis-sentinel  /myredis/sentinel.conf</strong></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220801110305367.png\" alt=\"image-20220801110305367\"></p>\n<p><strong>14.6.2.5.\tå½“ä¸»æœºæŒ‚æ‰ï¼Œä»æœºé€‰ä¸¾ä¸­äº§ç”Ÿæ–°çš„ä¸»æœº</strong></p>\n<p>(å¤§æ¦‚ 10 ç§’å·¦å³å¯ä»¥çœ‹åˆ°å“¨å…µçª—å£æ—¥å¿—ï¼Œåˆ‡æ¢äº†æ–°çš„ä¸»æœº)</p>\n<p>å“ªä¸ªä»æœºä¼šè¢«é€‰ä¸¾ä¸ºä¸»æœºå‘¢ï¼Ÿæ ¹æ®ä¼˜å…ˆçº§åˆ«ï¼š <code>replica-priority </code></p>\n<p><strong>åŸä¸»æœºé‡å¯åä¼šå˜ä¸ºä»æœºã€‚</strong></p>\n<p><strong>14.6.2.6.\tå¤åˆ¶å»¶æ—¶</strong></p>\n<p>ç”±äºæ‰€æœ‰çš„<strong>å†™æ“ä½œ</strong>éƒ½æ˜¯å…ˆåœ¨ Master ä¸Šæ“ä½œï¼Œç„¶ååŒæ­¥æ›´æ–°åˆ° Slave ä¸Šï¼Œæ‰€ä»¥ä» Master åŒæ­¥åˆ° Slave æœºå™¨æœ‰ä¸€å®šçš„å»¶è¿Ÿï¼Œå½“ç³»ç»Ÿå¾ˆç¹å¿™çš„æ—¶å€™ï¼Œå»¶è¿Ÿé—®é¢˜ä¼šæ›´åŠ ä¸¥é‡ï¼ŒSlave æœºå™¨æ•°é‡çš„å¢åŠ ä¹Ÿä¼šä½¿è¿™ä¸ªé—®é¢˜æ›´åŠ ä¸¥é‡ã€‚</p>\n<h3 id=\"1463æ•…éšœæ¢å¤\"><a class=\"markdownIt-Anchor\" href=\"#1463æ•…éšœæ¢å¤\">#</a> 14.6.3.\tæ•…éšœæ¢å¤</h3>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220801110846257.png\" alt=\"image-20220801110846257\"></p>\n<p><code>ä¼˜å…ˆçº§</code> åœ¨ redis.conf ä¸­é»˜è®¤ï¼šreplica-priority 100ï¼Œå€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜</p>\n<p><code>åç§»é‡</code> æ˜¯æŒ‡è·å¾—åŸä¸»æœºæ•°æ®æœ€å…¨çš„</p>\n<p>æ¯ä¸ª redis å®ä¾‹å¯åŠ¨åéƒ½ä¼šéšæœºç”Ÿæˆä¸€ä¸ª 40 ä½çš„ <code>runid</code></p>\n<h3 id=\"1464ä¸»ä»å¤åˆ¶\"><a class=\"markdownIt-Anchor\" href=\"#1464ä¸»ä»å¤åˆ¶\">#</a> 14.6.4.\tä¸»ä»å¤åˆ¶</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">JedisSentinelPool</span> jedisSentinelPool<span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span>  <span class=\"token class-name\">Jedis</span> <span class=\"token function\">getJedisFromSentinel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>jedisSentinelPool<span class=\"token operator\">==</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> sentinelSet<span class=\"token operator\">=</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">HashSet</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        sentinelSet<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"192.168.11.103:26379\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">JedisPoolConfig</span> jedisPoolConfig <span class=\"token operator\">=</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">JedisPoolConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        jedisPoolConfig<span class=\"token punctuation\">.</span><span class=\"token function\">setMaxTotal</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// æœ€å¤§å¯ç”¨è¿æ¥æ•°</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre> \t\tjedisPoolConfig<span class=\"token punctuation\">.</span><span class=\"token function\">setMaxIdle</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// æœ€å¤§é—²ç½®è¿æ¥æ•°</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\tjedisPoolConfig<span class=\"token punctuation\">.</span><span class=\"token function\">setMinIdle</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// æœ€å°é—²ç½®è¿æ¥æ•°</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\tjedisPoolConfig<span class=\"token punctuation\">.</span><span class=\"token function\">setBlockWhenExhausted</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// è¿æ¥è€—å°½æ˜¯å¦ç­‰å¾…</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\tjedisPoolConfig<span class=\"token punctuation\">.</span><span class=\"token function\">setMaxWaitMillis</span><span class=\"token punctuation\">(</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ç­‰å¾…æ—¶é—´</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\tjedisPoolConfig<span class=\"token punctuation\">.</span><span class=\"token function\">setTestOnBorrow</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// å–è¿æ¥çš„æ—¶å€™è¿›è¡Œä¸€ä¸‹æµ‹è¯• ping pong</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\tjedisSentinelPool<span class=\"token operator\">=</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">JedisSentinelPool</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mymaster\"</span><span class=\"token punctuation\">,</span>sentinelSet<span class=\"token punctuation\">,</span>jedisPoolConfig<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> jedisSentinelPool<span class=\"token punctuation\">.</span><span class=\"token function\">getResource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>     <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> jedisSentinelPool<span class=\"token punctuation\">.</span><span class=\"token function\">getResource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>     <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"åäº”-redisé›†ç¾¤\"><a class=\"markdownIt-Anchor\" href=\"#åäº”-redisé›†ç¾¤\">#</a> åäº”ã€Redis é›†ç¾¤</h1>\n<h2 id=\"1-é—®é¢˜\"><a class=\"markdownIt-Anchor\" href=\"#1-é—®é¢˜\">#</a> 1 - é—®é¢˜</h2>\n<p>å®¹é‡ä¸å¤Ÿï¼Œredis å¦‚ä½•è¿›è¡Œæ‰©å®¹ï¼Ÿ</p>\n<p>å¹¶å‘å†™æ“ä½œï¼Œ redis å¦‚ä½•åˆ†æ‘Šï¼Ÿ</p>\n<p><strong>å¦å¤–ï¼Œä¸»ä»æ¨¡å¼ï¼Œè–ªç«ç›¸ä¼ æ¨¡å¼ï¼Œä¸»æœºå®•æœºï¼Œå¯¼è‡´ ip åœ°å€å‘ç”Ÿå˜åŒ–ï¼Œåº”ç”¨ç¨‹åºä¸­é…ç½®éœ€è¦ä¿®æ”¹å¯¹åº”çš„ä¸»æœºåœ°å€ã€ç«¯å£ç­‰ä¿¡æ¯ã€‚</strong></p>\n<p>ä¹‹å‰é€šè¿‡ä»£ç†ä¸»æœºæ¥è§£å†³ï¼Œä½†æ˜¯ redis3.0 ä¸­æä¾›äº†è§£å†³æ–¹æ¡ˆã€‚å°±æ˜¯æ— ä¸­å¿ƒåŒ–é›†ç¾¤é…ç½®ã€‚</p>\n<h2 id=\"2-ä»€ä¹ˆæ˜¯é›†ç¾¤\"><a class=\"markdownIt-Anchor\" href=\"#2-ä»€ä¹ˆæ˜¯é›†ç¾¤\">#</a> 2 - ä»€ä¹ˆæ˜¯é›†ç¾¤</h2>\n<p>Redis é›†ç¾¤å®ç°äº†å¯¹ Redis çš„æ°´å¹³æ‰©å®¹ï¼Œå³å¯åŠ¨ N ä¸ª redis èŠ‚ç‚¹ï¼Œå°†æ•´ä¸ªæ•°æ®åº“åˆ†å¸ƒå­˜å‚¨åœ¨è¿™ N ä¸ªèŠ‚ç‚¹ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨æ€»æ•°æ®çš„ 1/Nã€‚</p>\n<p>Redis é›†ç¾¤é€šè¿‡åˆ†åŒºï¼ˆpartitionï¼‰æ¥æä¾›ä¸€å®šç¨‹åº¦çš„å¯ç”¨æ€§ï¼ˆavailabilityï¼‰ï¼š å³ä½¿é›†ç¾¤ä¸­æœ‰ä¸€éƒ¨åˆ†èŠ‚ç‚¹å¤±æ•ˆæˆ–è€…æ— æ³•è¿›è¡Œé€šè®¯ï¼Œ é›†ç¾¤ä¹Ÿå¯ä»¥ç»§ç»­å¤„ç†å‘½ä»¤è¯·æ±‚ã€‚</p>\n<h2 id=\"3-åˆ é™¤æŒä¹…åŒ–æ•°æ®\"><a class=\"markdownIt-Anchor\" href=\"#3-åˆ é™¤æŒä¹…åŒ–æ•°æ®\">#</a> 3 - åˆ é™¤æŒä¹…åŒ–æ•°æ®</h2>\n<p>å°† rdb,aof æ–‡ä»¶éƒ½åˆ é™¤æ‰ã€‚</p>\n<h2 id=\"4-åˆ¶ä½œ6ä¸ªå®ä¾‹637963806381638963906391\"><a class=\"markdownIt-Anchor\" href=\"#4-åˆ¶ä½œ6ä¸ªå®ä¾‹637963806381638963906391\">#</a> 4 - åˆ¶ä½œ 6 ä¸ªå®ä¾‹ï¼Œ6379,6380,6381,6389,6390,6391</h2>\n<h3 id=\"1541é…ç½®åŸºæœ¬ä¿¡æ¯\"><a class=\"markdownIt-Anchor\" href=\"#1541é…ç½®åŸºæœ¬ä¿¡æ¯\">#</a> 15.4.1.\té…ç½®åŸºæœ¬ä¿¡æ¯</h3>\n<blockquote>\n<ol>\n<li>å¼€å¯ daemonize yes</li>\n<li>Pid æ–‡ä»¶åå­—</li>\n<li>æŒ‡å®šç«¯å£</li>\n<li>Log æ–‡ä»¶åå­—</li>\n<li>Dump.rdb åå­—</li>\n<li>Appendonly å…³æ‰æˆ–è€…æ¢åå­—</li>\n</ol>\n</blockquote>\n<h3 id=\"1542redis-clusteré…ç½®ä¿®æ”¹\"><a class=\"markdownIt-Anchor\" href=\"#1542redis-clusteré…ç½®ä¿®æ”¹\">#</a> 15.4.2.\tredis cluster é…ç½®ä¿®æ”¹</h3>\n<blockquote>\n<ol>\n<li>cluster-enabled yes    æ‰“å¼€é›†ç¾¤æ¨¡å¼</li>\n<li>cluster-config-file nodes-6379.conf  è®¾å®šèŠ‚ç‚¹é…ç½®æ–‡ä»¶å</li>\n<li>cluster-node-timeout 15000   è®¾å®šèŠ‚ç‚¹å¤±è”æ—¶é—´ï¼Œè¶…è¿‡è¯¥æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œé›†ç¾¤è‡ªåŠ¨è¿›è¡Œä¸»ä»åˆ‡æ¢ã€‚</li>\n</ol>\n</blockquote>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>include /home/bigdata/redis.conf</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>port <span class=\"token number\">6379</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>pidfile <span class=\"token string\">\"/var/run/redis_6379.pid\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>dbfilename <span class=\"token string\">\"dump6379.rdb\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">dir</span> <span class=\"token string\">\"/home/bigdata/redis_cluster\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>logfile <span class=\"token string\">\"/home/bigdata/redis_cluster/redis_err_6379.log\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>clu - ster-enabled <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>cluster-config-file nodes-6379.conf</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>cluster-node-timeout <span class=\"token number\">15000</span></pre></td></tr></table></figure><h3 id=\"1543ä¿®æ”¹å¥½redis6379confæ–‡ä»¶æ‹·è´å¤šä¸ªredisconfæ–‡ä»¶\"><a class=\"markdownIt-Anchor\" href=\"#1543ä¿®æ”¹å¥½redis6379confæ–‡ä»¶æ‹·è´å¤šä¸ªredisconfæ–‡ä»¶\">#</a> 15.4.3.\tä¿®æ”¹å¥½ redis6379.conf æ–‡ä»¶ï¼Œæ‹·è´å¤šä¸ª redis.conf æ–‡ä»¶</h3>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220801113056666.png\" alt=\"image-20220801113056666\"></p>\n<h3 id=\"1544ä½¿ç”¨æŸ¥æ‰¾æ›¿æ¢ä¿®æ”¹å¦å¤–5ä¸ªæ–‡ä»¶\"><a class=\"markdownIt-Anchor\" href=\"#1544ä½¿ç”¨æŸ¥æ‰¾æ›¿æ¢ä¿®æ”¹å¦å¤–5ä¸ªæ–‡ä»¶\">#</a> 15.4.4.\tä½¿ç”¨æŸ¥æ‰¾æ›¿æ¢ä¿®æ”¹å¦å¤– 5 ä¸ªæ–‡ä»¶</h3>\n<p>ä¾‹å¦‚ï¼š:% s/6379/6380</p>\n<h3 id=\"1545å¯åŠ¨6ä¸ªredisæœåŠ¡\"><a class=\"markdownIt-Anchor\" href=\"#1545å¯åŠ¨6ä¸ªredisæœåŠ¡\">#</a> 15.4.5.\tå¯åŠ¨ 6 ä¸ª redis æœåŠ¡</h3>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220801113121076.png\" alt=\"image-20220801113121076\"></p>\n<h2 id=\"5-å°†å…­ä¸ªèŠ‚ç‚¹åˆæˆä¸€ä¸ªé›†ç¾¤\"><a class=\"markdownIt-Anchor\" href=\"#5-å°†å…­ä¸ªèŠ‚ç‚¹åˆæˆä¸€ä¸ªé›†ç¾¤\">#</a> 5 - å°†å…­ä¸ªèŠ‚ç‚¹åˆæˆä¸€ä¸ªé›†ç¾¤</h2>\n<p>ç»„åˆä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‰€æœ‰ redis å®ä¾‹å¯åŠ¨åï¼Œnodes-xxxx.conf æ–‡ä»¶éƒ½ç”Ÿæˆæ­£å¸¸ã€‚</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220801113311052.png\" alt=\"image-20220801113311052\"></p>\n<ul>\n<li>åˆä½“ï¼š</li>\n</ul>\n<p>cd  /opt/redis-6.2.1/src</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>redis-cli <span class=\"token parameter variable\">--cluster</span> create --cluster-replicas <span class=\"token number\">1</span> <span class=\"token number\">192.168</span>.11.101:6379 <span class=\"token number\">192.168</span>.11.101:6380 <span class=\"token number\">192.168</span>.11.101:6381 <span class=\"token number\">192.168</span>.11.101:6389 <span class=\"token number\">192.168</span>.11.101:6390 <span class=\"token number\">192.168</span>.11.101:6391</pre></td></tr></table></figure><p>æ­¤å¤„ä¸è¦ç”¨ 127.0.0.1ï¼Œ è¯·ç”¨çœŸå® IP åœ°å€<br>\nâ€“replicas 1 é‡‡ç”¨æœ€ç®€å•çš„æ–¹å¼é…ç½®é›†ç¾¤ï¼Œä¸€å°ä¸»æœºï¼Œä¸€å°ä»æœºï¼Œæ­£å¥½ä¸‰ç»„ã€‚</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220801113349156.png\" alt=\"image-20220801113349156\"></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220801113414617.png\" alt=\"image-20220801113414617\"></p>\n<ul>\n<li>æ™®é€šæ–¹å¼ç™»å½•<br>\nå¯èƒ½ç›´æ¥è¿›å…¥è¯»ä¸»æœºï¼Œå­˜å‚¨æ•°æ®æ—¶ï¼Œä¼šå‡ºç° MOVED é‡å®šå‘æ“ä½œã€‚æ‰€ä»¥ï¼Œåº”è¯¥ä»¥é›†ç¾¤æ–¹å¼ç™»å½•ã€‚</li>\n</ul>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220801113425849.png\" alt=\"image-20220801113425849\"></p>\n<h2 id=\"6-c-é‡‡ç”¨é›†ç¾¤ç­–ç•¥è¿æ¥è®¾ç½®æ•°æ®ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°ç›¸åº”çš„å†™ä¸»æœº\"><a class=\"markdownIt-Anchor\" href=\"#6-c-é‡‡ç”¨é›†ç¾¤ç­–ç•¥è¿æ¥è®¾ç½®æ•°æ®ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°ç›¸åº”çš„å†™ä¸»æœº\">#</a> 6 - -c é‡‡ç”¨é›†ç¾¤ç­–ç•¥è¿æ¥ï¼Œè®¾ç½®æ•°æ®ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°ç›¸åº”çš„å†™ä¸»æœº</h2>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220801113550736.png\" alt=\"image-20220801113550736\"></p>\n<h2 id=\"7-é€šè¿‡-cluster-nodes-å‘½ä»¤æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯\"><a class=\"markdownIt-Anchor\" href=\"#7-é€šè¿‡-cluster-nodes-å‘½ä»¤æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯\">#</a> 7-  é€šè¿‡ cluster nodes å‘½ä»¤æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯</h2>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220801123052282.png\" alt=\"image-20220801123052282\"></p>\n<h2 id=\"8-redis-cluster-å¦‚ä½•åˆ†é…è¿™å…­ä¸ªèŠ‚ç‚¹\"><a class=\"markdownIt-Anchor\" href=\"#8-redis-cluster-å¦‚ä½•åˆ†é…è¿™å…­ä¸ªèŠ‚ç‚¹\">#</a> 8 - redis cluster å¦‚ä½•åˆ†é…è¿™å…­ä¸ªèŠ‚ç‚¹ï¼Ÿ</h2>\n<p>ä¸€ä¸ªé›†ç¾¤è‡³å°‘è¦æœ‰<strong>ä¸‰ä¸ªä¸»èŠ‚ç‚¹</strong>ã€‚</p>\n<p>é€‰é¡¹ --cluster-replicas 1 è¡¨ç¤ºæˆ‘ä»¬å¸Œæœ›ä¸ºé›†ç¾¤ä¸­çš„æ¯ä¸ªä¸»èŠ‚ç‚¹åˆ›å»ºä¸€ä¸ªä»èŠ‚ç‚¹ã€‚</p>\n<p>åˆ†é…åŸåˆ™å°½é‡ä¿è¯æ¯ä¸ªä¸»æ•°æ®åº“è¿è¡Œåœ¨ä¸åŒçš„ IP åœ°å€ï¼Œæ¯ä¸ªä»åº“å’Œä¸»åº“ä¸åœ¨ä¸€ä¸ª IP åœ°å€ä¸Šã€‚</p>\n<h2 id=\"9-ä»€ä¹ˆæ˜¯slots\"><a class=\"markdownIt-Anchor\" href=\"#9-ä»€ä¹ˆæ˜¯slots\">#</a> 9 - ä»€ä¹ˆæ˜¯ slots</h2>\n<p><strong>[OK] All nodes agree about slots configuration.</strong></p>\n<p><strong>&gt;&gt;&gt; Check for open slotsâ€¦</strong></p>\n<p><strong>&gt;&gt;&gt; Check slots coverageâ€¦</strong></p>\n<p><strong>[OK] All 16384 slots covered.</strong></p>\n<p>ä¸€ä¸ª Redis é›†ç¾¤åŒ…å« <code>16384</code>  ä¸ªæ’æ§½ï¼ˆhash slotï¼‰ï¼Œ æ•°æ®åº“ä¸­çš„æ¯ä¸ªé”®éƒ½å±äºè¿™ 16384 ä¸ªæ’æ§½çš„å…¶ä¸­ä¸€ä¸ªï¼Œ é›†ç¾¤ä½¿ç”¨å…¬å¼  <code>CRC16(key) % 16384</code>  æ¥è®¡ç®—é”® key å±äºå“ªä¸ªæ§½ï¼Œ å…¶ä¸­ CRC16 (key) è¯­å¥ç”¨äºè®¡ç®—é”® key çš„ CRC16 æ ¡éªŒå’Œ ã€‚</p>\n<p>é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£å¤„ç†ä¸€éƒ¨åˆ†æ’æ§½ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œ å¦‚æœä¸€ä¸ªé›†ç¾¤å¯ä»¥æœ‰ä¸»èŠ‚ç‚¹ï¼Œ å…¶ä¸­ï¼š</p>\n<blockquote>\n<p>èŠ‚ç‚¹ A è´Ÿè´£å¤„ç† 0 å·è‡³ 5460 å·æ’æ§½ã€‚<br>\nèŠ‚ç‚¹ B è´Ÿè´£å¤„ç† 5461 å·è‡³ 10922 å·æ’æ§½ã€‚<br>\nèŠ‚ç‚¹ C è´Ÿè´£å¤„ç† 10923 å·è‡³ 16383 å·æ’æ§½ã€‚</p>\n</blockquote>\n<h2 id=\"10-åœ¨é›†ç¾¤ä¸­å½•å…¥å€¼\"><a class=\"markdownIt-Anchor\" href=\"#10-åœ¨é›†ç¾¤ä¸­å½•å…¥å€¼\">#</a> 10 - åœ¨é›†ç¾¤ä¸­å½•å…¥å€¼</h2>\n<p>åœ¨ redis-cli æ¯æ¬¡å½•å…¥ã€æŸ¥è¯¢é”®å€¼ï¼Œredis éƒ½ä¼šè®¡ç®—å‡ºè¯¥ key åº”è¯¥é€å¾€çš„æ’æ§½ï¼Œå¦‚æœä¸æ˜¯è¯¥å®¢æˆ·ç«¯å¯¹åº”æœåŠ¡å™¨çš„æ’æ§½ï¼Œredis ä¼šæŠ¥é”™ï¼Œå¹¶å‘ŠçŸ¥åº”å‰å¾€çš„ redis å®ä¾‹åœ°å€å’Œç«¯å£ã€‚</p>\n<p>redis-cli å®¢æˆ·ç«¯æä¾›äº†  <code>â€“c</code>  å‚æ•°å®ç°è‡ªåŠ¨é‡å®šå‘ã€‚</p>\n<p>å¦‚  <code>redis-cli  -c â€“p 6379</code>  ç™»å…¥åï¼Œå†å½•å…¥ã€æŸ¥è¯¢é”®å€¼å¯¹å¯ä»¥è‡ªåŠ¨é‡å®šå‘ã€‚</p>\n<p>ä¸åœ¨ä¸€ä¸ª slot ä¸‹çš„é”®å€¼ï¼Œæ˜¯ä¸èƒ½ä½¿ç”¨ mget,mset ç­‰å¤šé”®æ“ä½œã€‚</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220801123630199.png\" alt=\"image-20220801123630199\"></p>\n<p>å¯ä»¥é€šè¿‡ {} æ¥å®šä¹‰ç»„çš„æ¦‚å¿µï¼Œä»è€Œä½¿ key ä¸­ {} å†…ç›¸åŒå†…å®¹çš„é”®å€¼å¯¹æ”¾åˆ°ä¸€ä¸ª slot ä¸­å»ã€‚</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220801123644949.png\" alt=\"image-20220801123644949\"></p>\n<h2 id=\"11-æŸ¥è¯¢é›†ç¾¤ä¸­çš„å€¼\"><a class=\"markdownIt-Anchor\" href=\"#11-æŸ¥è¯¢é›†ç¾¤ä¸­çš„å€¼\">#</a> 11 - æŸ¥è¯¢é›†ç¾¤ä¸­çš„å€¼</h2>\n<p><strong>CLUSTER GETKEYSINSLOT <slot><count></strong>  è¿”å› count ä¸ª slot æ§½ä¸­çš„é”®ã€‚</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220801123657501.png\" alt=\"image-20220801123657501\"></p>\n<h2 id=\"12-æ•…éšœæ¢å¤\"><a class=\"markdownIt-Anchor\" href=\"#12-æ•…éšœæ¢å¤\">#</a> 12 -  æ•…éšœæ¢å¤</h2>\n<p>å¦‚æœä¸»èŠ‚ç‚¹ä¸‹çº¿ï¼Ÿä»èŠ‚ç‚¹èƒ½å¦è‡ªåŠ¨å‡ä¸ºä¸»èŠ‚ç‚¹ï¼Ÿæ³¨æ„ï¼š<strong>15 ç§’è¶…æ—¶</strong></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220801123757512.png\" alt=\"image-20220801123757512\"></p>\n<p>ä¸»èŠ‚ç‚¹æ¢å¤åï¼Œä¸»ä»å…³ç³»ä¼šå¦‚ä½•ï¼Ÿ<strong>ä¸»èŠ‚ç‚¹å›æ¥å˜æˆä»æœº</strong>ã€‚</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220801123820814.png\" alt=\"image-20220801123820814\"></p>\n<p>å¦‚æœæ‰€æœ‰æŸä¸€æ®µæ’æ§½çš„ä¸»ä»èŠ‚ç‚¹éƒ½å®•æ‰ï¼Œredis æœåŠ¡æ˜¯å¦è¿˜èƒ½ç»§ç»­ï¼Ÿ</p>\n<p>å¦‚æœæŸä¸€æ®µæ’æ§½çš„ä¸»ä»éƒ½æŒ‚æ‰ï¼Œè€Œ cluster-require-full-coverage ä¸º yes ï¼Œé‚£ä¹ˆ ï¼Œæ•´ä¸ªé›†ç¾¤éƒ½æŒ‚æ‰</p>\n<p>å¦‚æœæŸä¸€æ®µæ’æ§½çš„ä¸»ä»éƒ½æŒ‚æ‰ï¼Œè€Œ cluster-require-full-coverage ä¸º no ï¼Œé‚£ä¹ˆï¼Œè¯¥æ’æ§½æ•°æ®å…¨éƒ½ä¸èƒ½ä½¿ç”¨ï¼Œä¹Ÿæ— æ³•å­˜å‚¨ã€‚</p>\n<p>redis.conf ä¸­çš„å‚æ•°  cluster-require-full-coverage</p>\n<h2 id=\"13-é›†ç¾¤çš„jediså¼€å‘\"><a class=\"markdownIt-Anchor\" href=\"#13-é›†ç¾¤çš„jediså¼€å‘\">#</a> 13 - é›†ç¾¤çš„ Jedis å¼€å‘</h2>\n<p>å³ä½¿è¿æ¥çš„ä¸æ˜¯ä¸»æœºï¼Œé›†ç¾¤ä¼šè‡ªåŠ¨åˆ‡æ¢ä¸»æœºå­˜å‚¨ã€‚ä¸»æœºå†™ï¼Œä»æœºè¯»ã€‚</p>\n<p>æ— ä¸­å¿ƒåŒ–ä¸»ä»é›†ç¾¤ã€‚æ— è®ºä»å“ªå°ä¸»æœºå†™çš„æ•°æ®ï¼Œå…¶ä»–ä¸»æœºä¸Šéƒ½èƒ½è¯»åˆ°æ•°æ®ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JedisClusterTest</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>     <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">HostAndPort</span><span class=\"token punctuation\">></span></span>set <span class=\"token operator\">=</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">HashSet</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">HostAndPort</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>     set<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">HostAndPort</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"192.168.31.211\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">6379</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>     <span class=\"token class-name\">JedisCluster</span> jedisCluster<span class=\"token operator\">=</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">JedisCluster</span><span class=\"token punctuation\">(</span>set<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>     jedisCluster<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"k1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"v1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>     <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>jedisCluster<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"k1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"14-redis-é›†ç¾¤æä¾›äº†ä»¥ä¸‹å¥½å¤„\"><a class=\"markdownIt-Anchor\" href=\"#14-redis-é›†ç¾¤æä¾›äº†ä»¥ä¸‹å¥½å¤„\">#</a> 14 - Redis é›†ç¾¤æä¾›äº†ä»¥ä¸‹å¥½å¤„</h2>\n<ol>\n<li>å®ç°æ‰©å®¹</li>\n<li>åˆ†æ‘Šå‹åŠ›</li>\n<li>æ— ä¸­å¿ƒé…ç½®ç›¸å¯¹ç®€å•</li>\n</ol>\n<h2 id=\"15-redis-é›†ç¾¤çš„ä¸è¶³\"><a class=\"markdownIt-Anchor\" href=\"#15-redis-é›†ç¾¤çš„ä¸è¶³\">#</a> 15 - Redis é›†ç¾¤çš„ä¸è¶³</h2>\n<ol>\n<li>\n<p>å¤šé”®æ“ä½œæ˜¯ä¸è¢«æ”¯æŒçš„</p>\n</li>\n<li>\n<p>å¤šé”®çš„ Redis äº‹åŠ¡æ˜¯ä¸è¢«æ”¯æŒçš„ã€‚lua è„šæœ¬ä¸è¢«æ”¯æŒ</p>\n</li>\n<li>\n<p>ç”±äºé›†ç¾¤æ–¹æ¡ˆå‡ºç°è¾ƒæ™šï¼Œå¾ˆå¤šå…¬å¸å·²ç»é‡‡ç”¨äº†å…¶ä»–çš„é›†ç¾¤æ–¹æ¡ˆï¼Œè€Œä»£ç†æˆ–è€…å®¢æˆ·ç«¯åˆ†ç‰‡çš„æ–¹æ¡ˆæƒ³è¦è¿ç§»è‡³ redis clusterï¼Œéœ€è¦æ•´ä½“è¿ç§»è€Œä¸æ˜¯é€æ­¥è¿‡æ¸¡ï¼Œå¤æ‚åº¦è¾ƒå¤§ã€‚</p>\n</li>\n</ol>\n<h1 id=\"åå…­-redisåº”ç”¨é—®é¢˜è§£å†³\"><a class=\"markdownIt-Anchor\" href=\"#åå…­-redisåº”ç”¨é—®é¢˜è§£å†³\">#</a> åå…­ã€Redis åº”ç”¨é—®é¢˜è§£å†³</h1>\n<h2 id=\"1-ç¼“å­˜ç©¿é€\"><a class=\"markdownIt-Anchor\" href=\"#1-ç¼“å­˜ç©¿é€\">#</a> 1- ç¼“å­˜ç©¿é€</h2>\n<h3 id=\"1611é—®é¢˜æè¿°\"><a class=\"markdownIt-Anchor\" href=\"#1611é—®é¢˜æè¿°\">#</a> 16.1.1.\té—®é¢˜æè¿°</h3>\n<p>key å¯¹åº”çš„æ•°æ®åœ¨æ•°æ®æºå¹¶ä¸å­˜åœ¨ï¼Œæ¯æ¬¡é’ˆå¯¹æ­¤ key çš„è¯·æ±‚ä»ç¼“å­˜è·å–ä¸åˆ°ï¼Œè¯·æ±‚éƒ½ä¼šå‹åˆ°æ•°æ®æºï¼Œä»è€Œå¯èƒ½å‹å®æ•°æ®æºã€‚æ¯”å¦‚ç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„ç”¨æˆ· id è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œä¸è®ºç¼“å­˜è¿˜æ˜¯æ•°æ®åº“éƒ½æ²¡æœ‰ï¼Œè‹¥é»‘å®¢åˆ©ç”¨æ­¤æ¼æ´è¿›è¡Œæ”»å‡»å¯èƒ½å‹å®æ•°æ®åº“ã€‚</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220801124314744.png\" alt=\"image-20220801124314744\"></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220808134718629.png\" alt=\"image-20220808134718629\"></p>\n<h3 id=\"1612è§£å†³æ–¹æ¡ˆ\"><a class=\"markdownIt-Anchor\" href=\"#1612è§£å†³æ–¹æ¡ˆ\">#</a> 16.1.2.\tè§£å†³æ–¹æ¡ˆ</h3>\n<p>ä¸€ä¸ªä¸€å®šä¸å­˜åœ¨ç¼“å­˜åŠæŸ¥è¯¢ä¸åˆ°çš„æ•°æ®ï¼Œç”±äºç¼“å­˜æ˜¯ä¸å‘½ä¸­æ—¶è¢«åŠ¨å†™çš„ï¼Œå¹¶ä¸”å‡ºäºå®¹é”™è€ƒè™‘ï¼Œå¦‚æœä»å­˜å‚¨å±‚æŸ¥ä¸åˆ°æ•°æ®åˆ™ä¸å†™å…¥ç¼“å­˜ï¼Œè¿™å°†å¯¼è‡´è¿™ä¸ªä¸å­˜åœ¨çš„æ•°æ®æ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ°å­˜å‚¨å±‚å»æŸ¥è¯¢ï¼Œå¤±å»äº†ç¼“å­˜çš„æ„ä¹‰ã€‚</p>\n<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong><br>\nï¼ˆ1ï¼‰\t** å¯¹ç©ºå€¼ç¼“å­˜ï¼š** å¦‚æœä¸€ä¸ªæŸ¥è¯¢è¿”å›çš„æ•°æ®ä¸ºç©ºï¼ˆä¸ç®¡æ˜¯æ•°æ®æ˜¯å¦ä¸å­˜åœ¨ï¼‰ï¼Œæˆ‘ä»¬ä»ç„¶æŠŠè¿™ä¸ªç©ºç»“æœï¼ˆnullï¼‰è¿›è¡Œç¼“å­˜ï¼Œè®¾ç½®ç©ºç»“æœçš„è¿‡æœŸæ—¶é—´ä¼šå¾ˆçŸ­ï¼Œæœ€é•¿ä¸è¶…è¿‡äº”åˆ†é’Ÿ</p>\n<p>ï¼ˆ2ï¼‰\t<strong>è®¾ç½®å¯è®¿é—®çš„åå•ï¼ˆç™½åå•ï¼‰</strong>ï¼š<br>\nä½¿ç”¨ bitmaps ç±»å‹å®šä¹‰ä¸€ä¸ªå¯ä»¥è®¿é—®çš„åå•ï¼Œåå• id ä½œä¸º bitmaps çš„åç§»é‡ï¼Œæ¯æ¬¡è®¿é—®å’Œ bitmap é‡Œé¢çš„ id è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœè®¿é—® id ä¸åœ¨ bitmaps é‡Œé¢ï¼Œè¿›è¡Œæ‹¦æˆªï¼Œä¸å…è®¸è®¿é—®ã€‚</p>\n<p>ï¼ˆ3ï¼‰\t<strong>é‡‡ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼š</strong>(å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰æ˜¯ 1970 å¹´ç”±å¸ƒéš†æå‡ºçš„ã€‚å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªå¾ˆé•¿çš„ <code>äºŒè¿›åˆ¶å‘é‡</code>  (ä½å›¾) å’Œä¸€ç³»åˆ—éšæœº <code>æ˜ å°„å‡½æ•°</code> ï¼ˆå“ˆå¸Œå‡½æ•°ï¼‰ã€‚</p>\n<p>å¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥ç”¨äº<strong>æ£€ç´¢ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­</strong>ã€‚å®ƒçš„<strong>ä¼˜ç‚¹</strong>æ˜¯ç©ºé—´æ•ˆç‡å’ŒæŸ¥è¯¢æ—¶é—´éƒ½è¿œè¿œè¶…è¿‡ä¸€èˆ¬çš„ç®—æ³•ï¼Œ<strong>ç¼ºç‚¹</strong>æ˜¯æœ‰ä¸€å®šçš„è¯¯è¯†åˆ«ç‡å’Œåˆ é™¤å›°éš¾ã€‚)</p>\n<p>å°†æ‰€æœ‰å¯èƒ½å­˜åœ¨çš„æ•°æ®å“ˆå¸Œåˆ°ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ bitmaps ä¸­ï¼Œä¸€ä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ä¼šè¢« è¿™ä¸ª bitmaps æ‹¦æˆªæ‰ï¼Œä»è€Œé¿å…äº†å¯¹åº•å±‚å­˜å‚¨ç³»ç»Ÿçš„æŸ¥è¯¢å‹åŠ›ã€‚</p>\n<p>ï¼ˆ4ï¼‰\t<strong>è¿›è¡Œå®æ—¶ç›‘æ§</strong>ï¼šå½“å‘ç° Redis çš„å‘½ä¸­ç‡å¼€å§‹æ€¥é€Ÿé™ä½ï¼Œéœ€è¦æ’æŸ¥è®¿é—®å¯¹è±¡å’Œè®¿é—®çš„æ•°æ®ï¼Œå’Œè¿ç»´äººå‘˜é…åˆï¼Œå¯ä»¥è®¾ç½®é»‘åå•é™åˆ¶æœåŠ¡</p>\n<h2 id=\"2-ç¼“å­˜å‡»ç©¿\"><a class=\"markdownIt-Anchor\" href=\"#2-ç¼“å­˜å‡»ç©¿\">#</a> 2 - ç¼“å­˜å‡»ç©¿</h2>\n<h3 id=\"1621é—®é¢˜æè¿°\"><a class=\"markdownIt-Anchor\" href=\"#1621é—®é¢˜æè¿°\">#</a> 16.2.1.\té—®é¢˜æè¿°</h3>\n<p>key å¯¹åº”çš„æ•°æ®å­˜åœ¨ï¼Œä½†åœ¨ redis ä¸­è¿‡æœŸï¼Œæ­¤æ—¶è‹¥æœ‰å¤§é‡å¹¶å‘è¯·æ±‚è¿‡æ¥ï¼Œè¿™äº›è¯·æ±‚å‘ç°ç¼“å­˜è¿‡æœŸä¸€èˆ¬éƒ½ä¼šä»åç«¯ DB åŠ è½½æ•°æ®å¹¶å›è®¾åˆ°ç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™å¤§å¹¶å‘çš„è¯·æ±‚å¯èƒ½ä¼šç¬é—´æŠŠåç«¯ DB å‹å®ã€‚</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220801124751949.png\" alt=\"image-20220801124751949\"></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220808135145459.png\" alt=\"image-20220808135145459\"></p>\n<h3 id=\"1622è§£å†³æ–¹æ¡ˆ\"><a class=\"markdownIt-Anchor\" href=\"#1622è§£å†³æ–¹æ¡ˆ\">#</a> 16.2.2.\tè§£å†³æ–¹æ¡ˆ</h3>\n<p>key å¯èƒ½ä¼šåœ¨æŸäº›æ—¶é—´ç‚¹è¢«è¶…é«˜å¹¶å‘åœ°è®¿é—®ï¼Œæ˜¯ä¸€ç§éå¸¸ â€œçƒ­ç‚¹â€ çš„æ•°æ®ã€‚è¿™ä¸ªæ—¶å€™ï¼Œéœ€è¦è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼šç¼“å­˜è¢« â€œå‡»ç©¿â€ çš„é—®é¢˜ã€‚</p>\n<p><strong>è§£å†³é—®é¢˜ï¼š</strong></p>\n<p>ï¼ˆ1ï¼‰<strong>é¢„å…ˆè®¾ç½®çƒ­é—¨æ•°æ®</strong>ï¼šåœ¨ redis é«˜å³°è®¿é—®ä¹‹å‰ï¼ŒæŠŠä¸€äº›çƒ­é—¨æ•°æ®æå‰å­˜å…¥åˆ° redis é‡Œé¢ï¼ŒåŠ å¤§è¿™äº›çƒ­é—¨æ•°æ® key çš„æ—¶é•¿</p>\n<p>ï¼ˆ2ï¼‰<strong>å®æ—¶è°ƒæ•´</strong>ï¼šç°åœºç›‘æ§å“ªäº›æ•°æ®çƒ­é—¨ï¼Œå®æ—¶è°ƒæ•´ key çš„è¿‡æœŸæ—¶é•¿</p>\n<p>ï¼ˆ3ï¼‰<strong>ä½¿ç”¨é”</strong>ï¼š</p>\n<ol>\n<li>å°±æ˜¯åœ¨ç¼“å­˜å¤±æ•ˆçš„æ—¶å€™ï¼ˆåˆ¤æ–­æ‹¿å‡ºæ¥çš„å€¼ä¸ºç©ºï¼‰ï¼Œä¸æ˜¯ç«‹å³å» load dbã€‚</li>\n<li>å…ˆä½¿ç”¨ç¼“å­˜å·¥å…·çš„æŸäº›å¸¦æˆåŠŸæ“ä½œè¿”å›å€¼çš„æ“ä½œï¼ˆæ¯”å¦‚ Redis çš„ SETNXï¼‰å» set ä¸€ä¸ª mutex key</li>\n<li>å½“æ“ä½œè¿”å›æˆåŠŸæ—¶ï¼Œå†è¿›è¡Œ load db çš„æ“ä½œï¼Œå¹¶å›è®¾ç¼“å­˜ï¼Œæœ€ååˆ é™¤ mutex keyï¼›</li>\n<li>å½“æ“ä½œè¿”å›å¤±è´¥ï¼Œè¯æ˜æœ‰çº¿ç¨‹åœ¨ load dbï¼Œå½“å‰çº¿ç¨‹ç¡çœ ä¸€æ®µæ—¶é—´å†é‡è¯•æ•´ä¸ª get ç¼“å­˜çš„æ–¹æ³•ã€‚</li>\n</ol>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220801125032132.png\" alt=\"image-20220801125032132\"></p>\n<h2 id=\"3-ç¼“å­˜é›ªå´©\"><a class=\"markdownIt-Anchor\" href=\"#3-ç¼“å­˜é›ªå´©\">#</a> 3 - ç¼“å­˜é›ªå´©</h2>\n<h3 id=\"1631é—®é¢˜æè¿°\"><a class=\"markdownIt-Anchor\" href=\"#1631é—®é¢˜æè¿°\">#</a> 16.3.1.\té—®é¢˜æè¿°</h3>\n<p>key å¯¹åº”çš„æ•°æ®å­˜åœ¨ï¼Œä½†åœ¨ redis ä¸­è¿‡æœŸï¼Œæ­¤æ—¶è‹¥æœ‰å¤§é‡å¹¶å‘è¯·æ±‚è¿‡æ¥ï¼Œè¿™äº›è¯·æ±‚å‘ç°ç¼“å­˜è¿‡æœŸä¸€èˆ¬éƒ½ä¼šä»åç«¯ DB åŠ è½½æ•°æ®å¹¶å›è®¾åˆ°ç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™å¤§å¹¶å‘çš„è¯·æ±‚å¯èƒ½ä¼šç¬é—´æŠŠåç«¯ DB å‹å®ã€‚</p>\n<p>ç¼“å­˜é›ªå´©ä¸ç¼“å­˜å‡»ç©¿çš„åŒºåˆ«åœ¨äº<strong>è¿™é‡Œé’ˆå¯¹å¾ˆå¤š key ç¼“å­˜ï¼Œå‰è€…åˆ™æ˜¯æŸä¸€ä¸ª key</strong></p>\n<p>æ­£å¸¸è®¿é—®â¬‡</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220801125120331.png\" alt=\"image-20220801125120331\"></p>\n<p>ç¼“å­˜å¤±æ•ˆç¬é—´â¬‡</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220801125130104.png\" alt=\"image-20220801125130104\"></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220808140122025.png\" alt=\"image-20220808140122025\"></p>\n<h3 id=\"1632è§£å†³æ–¹æ¡ˆ\"><a class=\"markdownIt-Anchor\" href=\"#1632è§£å†³æ–¹æ¡ˆ\">#</a> 16.3.2.\tè§£å†³æ–¹æ¡ˆ</h3>\n<p>ç¼“å­˜å¤±æ•ˆæ—¶çš„é›ªå´©æ•ˆåº”å¯¹åº•å±‚ç³»ç»Ÿçš„å†²å‡»éå¸¸å¯æ€•ï¼</p>\n<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong><br>\nï¼ˆ1ï¼‰\t** æ„å»ºå¤šçº§ç¼“å­˜æ¶æ„ï¼š**nginx ç¼“å­˜ + redis ç¼“å­˜ + å…¶ä»–ç¼“å­˜ï¼ˆehcache ç­‰ï¼‰</p>\n<p>ï¼ˆ2ï¼‰\t<strong>ä½¿ç”¨é”æˆ–é˜Ÿåˆ—ï¼š</strong><br>\nç”¨ <code>åŠ é”</code> æˆ–è€… <code>é˜Ÿåˆ—</code> çš„æ–¹å¼ä¿è¯æ¥ä¿è¯ä¸ä¼šæœ‰å¤§é‡çš„çº¿ç¨‹å¯¹æ•°æ®åº“ä¸€æ¬¡æ€§è¿›è¡Œè¯»å†™ï¼Œä»è€Œé¿å…å¤±æ•ˆæ—¶å¤§é‡çš„å¹¶å‘è¯·æ±‚è½åˆ°åº•å±‚å­˜å‚¨ç³»ç»Ÿä¸Šã€‚ä¸é€‚ç”¨é«˜å¹¶å‘æƒ…å†µ</p>\n<p>ï¼ˆ3ï¼‰\t<strong>è®¾ç½®è¿‡æœŸæ ‡å¿—æ›´æ–°ç¼“å­˜</strong>ï¼š<br>\nè®°å½•ç¼“å­˜æ•°æ®æ˜¯å¦è¿‡æœŸï¼ˆè®¾ç½®æå‰é‡ï¼‰ï¼Œå¦‚æœè¿‡æœŸä¼šè§¦å‘é€šçŸ¥å¦å¤–çš„çº¿ç¨‹åœ¨åå°å»æ›´æ–°å®é™… key çš„ç¼“å­˜ã€‚</p>\n<p>ï¼ˆ4ï¼‰\t<strong>å°†ç¼“å­˜å¤±æ•ˆæ—¶é—´åˆ†æ•£å¼€</strong>ï¼š<br>\næ¯”å¦‚æˆ‘ä»¬å¯ä»¥åœ¨åŸæœ‰çš„å¤±æ•ˆæ—¶é—´åŸºç¡€ä¸Šå¢åŠ ä¸€ä¸ªéšæœºå€¼ï¼Œæ¯”å¦‚ 1-5 åˆ†é’Ÿéšæœºï¼Œè¿™æ ·æ¯ä¸€ä¸ªç¼“å­˜çš„è¿‡æœŸæ—¶é—´çš„é‡å¤ç‡å°±ä¼šé™ä½ï¼Œå°±å¾ˆéš¾å¼•å‘é›†ä½“å¤±æ•ˆçš„äº‹ä»¶ã€‚</p>\n<h2 id=\"4-åˆ†å¸ƒå¼é”\"><a class=\"markdownIt-Anchor\" href=\"#4-åˆ†å¸ƒå¼é”\">#</a> 4 - åˆ†å¸ƒå¼é”</h2>\n<h3 id=\"1641é—®é¢˜æè¿°\"><a class=\"markdownIt-Anchor\" href=\"#1641é—®é¢˜æè¿°\">#</a> 16.4.1.\té—®é¢˜æè¿°</h3>\n<p>éšç€ä¸šåŠ¡å‘å±•çš„éœ€è¦ï¼Œ<strong>åŸå•ä½“å•æœºéƒ¨ç½²</strong>çš„ç³»ç»Ÿè¢«æ¼”åŒ–æˆ<strong>åˆ†å¸ƒå¼é›†ç¾¤ç³»ç»Ÿ</strong>åï¼Œç”±äºåˆ†å¸ƒå¼ç³»ç»Ÿå¤šçº¿ç¨‹ã€å¤šè¿›ç¨‹å¹¶ä¸”åˆ†å¸ƒåœ¨ä¸åŒæœºå™¨ä¸Šï¼Œè¿™å°†ä½¿åŸå•æœºéƒ¨ç½²æƒ…å†µä¸‹çš„å¹¶å‘æ§åˆ¶é”ç­–ç•¥å¤±æ•ˆï¼Œå•çº¯çš„ Java API å¹¶ä¸èƒ½æä¾›åˆ†å¸ƒå¼é”çš„èƒ½åŠ›ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜å°±<strong>éœ€è¦ä¸€ç§è·¨ JVM çš„äº’æ–¥æœºåˆ¶æ¥æ§åˆ¶å…±äº«èµ„æºçš„è®¿é—®</strong>ï¼Œè¿™å°±æ˜¯åˆ†å¸ƒå¼é”è¦è§£å†³çš„é—®é¢˜ï¼</p>\n<p><strong>åˆ†å¸ƒå¼é”ä¸»æµçš„å®ç°æ–¹æ¡ˆ</strong>ï¼š</p>\n<ol>\n<li>åŸºäºæ•°æ®åº“å®ç°åˆ†å¸ƒå¼é”</li>\n<li>åŸºäºç¼“å­˜ï¼ˆRedis ç­‰ï¼‰</li>\n<li>åŸºäº Zookeeper<br>\n æ¯ä¸€ç§åˆ†å¸ƒå¼é”è§£å†³æ–¹æ¡ˆéƒ½æœ‰å„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼š</li>\n<li>æ€§èƒ½ï¼šredis æœ€é«˜</li>\n<li>å¯é æ€§ï¼šzookeeper æœ€é«˜<br>\nè¿™é‡Œï¼Œæˆ‘ä»¬å°±åŸºäº redis å®ç°åˆ†å¸ƒå¼é”ã€‚</li>\n</ol>\n<h3 id=\"1642è§£å†³æ–¹æ¡ˆä½¿ç”¨rediså®ç°åˆ†å¸ƒå¼é”\"><a class=\"markdownIt-Anchor\" href=\"#1642è§£å†³æ–¹æ¡ˆä½¿ç”¨rediså®ç°åˆ†å¸ƒå¼é”\">#</a> 16.4.2.\tè§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ redis å®ç°åˆ†å¸ƒå¼é”</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rediså‘½ä»¤ ï¼š </pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">set</span> sku:1:info â€œOKâ€ NX PX <span class=\"token number\">10000</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>EX secondï¼šè®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´ä¸º second ç§’ã€‚ SET key value EX second æ•ˆæœç­‰åŒäº SETEX key second value</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>PX millisecondï¼šè®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´ä¸º millisecond æ¯«ç§’ã€‚ SET key value PX millisecond æ•ˆæœç­‰åŒäº PSETEX key millisecond value </pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>NX ï¼šåªåœ¨é”®ä¸å­˜åœ¨æ—¶ï¼Œæ‰å¯¹é”®è¿›è¡Œè®¾ç½®æ“ä½œã€‚ SET key value NX æ•ˆæœç­‰åŒäº SETNX key value </pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>XX ï¼šåªåœ¨é”®å·²ç»å­˜åœ¨æ—¶ï¼Œæ‰å¯¹é”®è¿›è¡Œè®¾ç½®æ“ä½œã€‚</pre></td></tr></table></figure><p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220801152803095.png\" alt=\"image-20220801152803095\"></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220808141133285.png\" alt=\"image-20220808141133285\"></p>\n<ol>\n<li>å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è·å–é”ï¼ˆsetnxï¼‰</li>\n<li>è·å–æˆåŠŸï¼Œæ‰§è¡Œä¸šåŠ¡é€»è¾‘ {ä» db è·å–æ•°æ®ï¼Œæ”¾å…¥ç¼“å­˜}ï¼Œæ‰§è¡Œå®Œæˆé‡Šæ”¾é”ï¼ˆdelï¼‰</li>\n<li>å…¶ä»–å®¢æˆ·ç«¯ç­‰å¾…é‡è¯•</li>\n</ol>\n<h3 id=\"1643ç¼–å†™ä»£ç \"><a class=\"markdownIt-Anchor\" href=\"#1643ç¼–å†™ä»£ç \">#</a> 16.4.3.\tç¼–å†™ä»£ç </h3>\n<p>Redis: set num 0</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"testLock\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testLock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">//1 è·å–é”ï¼Œsetne</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">Boolean</span> lock <span class=\"token operator\">=</span> redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setIfAbsent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"lock\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"111\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">//2 è·å–é”æˆåŠŸã€æŸ¥è¯¢ num çš„å€¼</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>lock<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">Object</span> value <span class=\"token operator\">=</span> redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"num\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token comment\">//2.1 åˆ¤æ–­ num ä¸ºç©º return</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">//2.2 æœ‰å€¼å°±è½¬æˆæˆ int</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">int</span> num <span class=\"token operator\">=</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>value<span class=\"token operator\">+</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">//2.3 æŠŠ redis çš„ num åŠ  1</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"num\"</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">++</span>num<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\">//2.4 é‡Šæ”¾é”ï¼Œdel</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"lock\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token comment\">//3 è·å–é”å¤±è´¥ã€æ¯éš” 0.1 ç§’å†è·å–</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token function\">testLock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>é‡å¯ï¼ŒæœåŠ¡é›†ç¾¤ï¼Œé€šè¿‡ç½‘å…³å‹åŠ›æµ‹è¯•ï¼š<br>\nab -n 1000 -c 100 <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMTQwLjE6ODA4MC90ZXN0L3Rlc3RMb2Nr\">http://192.168.140.1:8080/test/testLock</span></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220801153313835.png\" alt=\"image-20220801153313835\"></p>\n<p>æŸ¥çœ‹ redis ä¸­ num çš„å€¼ ï¼š</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220801153341490.png\" alt=\"image-20220801153341490\"></p>\n<p>ä½†æ˜¯è¿˜ä¼šæœ‰ä¸€äº›é—®é¢˜ï¼Œè§ä¸‹ï¼Œé—®é¢˜åŠç›¸å…³è§£å†³æ–¹æ¡ˆã€‚</p>\n<h3 id=\"1644ä¼˜åŒ–ä¹‹è®¾ç½®é”çš„è¿‡æœŸæ—¶é—´\"><a class=\"markdownIt-Anchor\" href=\"#1644ä¼˜åŒ–ä¹‹è®¾ç½®é”çš„è¿‡æœŸæ—¶é—´\">#</a> 16.4.4.\tä¼˜åŒ–ä¹‹è®¾ç½®é”çš„è¿‡æœŸæ—¶é—´</h3>\n<p>** é—®é¢˜ï¼š**setnx åˆšå¥½è·å–åˆ°é”ï¼Œä¸šåŠ¡é€»è¾‘å‡ºç°å¼‚å¸¸ï¼Œå¯¼è‡´é”æ— æ³•é‡Šæ”¾</p>\n<p>** è§£å†³ï¼š** è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œè‡ªåŠ¨é‡Šæ”¾é”ã€‚</p>\n<p>è®¾ç½®è¿‡æœŸæ—¶é—´æœ‰<strong>ä¸¤ç§æ–¹å¼ï¼š</strong></p>\n<ol>\n<li>é¦–å…ˆæƒ³åˆ°é€šè¿‡ <code>expire</code>  è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆç¼ºä¹åŸå­æ€§ï¼šå¦‚æœåœ¨ setnx å’Œ expire ä¹‹é—´å‡ºç°å¼‚å¸¸ï¼Œé”ä¹Ÿæ— æ³•é‡Šæ”¾ï¼‰</li>\n<li>åœ¨ set æ—¶æŒ‡å®šè¿‡æœŸæ—¶é—´ï¼ˆæ¨èï¼‰</li>\n</ol>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220801153615051.png\" alt=\"image-20220801153615051\"></p>\n<p>è®¾ç½®è¿‡æœŸæ—¶é—´ï¼š</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220801153652058.png\" alt=\"image-20220801153652058\"></p>\n<p>å‹åŠ›æµ‹è¯•è‚¯å®šä¹Ÿæ²¡æœ‰é—®é¢˜ã€‚è‡ªè¡Œæµ‹è¯•</p>\n<h3 id=\"1645ä¼˜åŒ–ä¹‹uuidé˜²è¯¯åˆ \"><a class=\"markdownIt-Anchor\" href=\"#1645ä¼˜åŒ–ä¹‹uuidé˜²è¯¯åˆ \">#</a> 16.4.5.\tä¼˜åŒ–ä¹‹ UUID é˜²è¯¯åˆ </h3>\n<p>** é—®é¢˜ï¼š** å¯èƒ½ä¼šé‡Šæ”¾å…¶ä»–æœåŠ¡å™¨çš„é”ã€‚</p>\n<p>** åœºæ™¯ï¼š** å¦‚æœä¸šåŠ¡é€»è¾‘çš„æ‰§è¡Œæ—¶é—´æ˜¯ 7sã€‚æ‰§è¡Œæµç¨‹å¦‚ä¸‹</p>\n<ol>\n<li>index1 ä¸šåŠ¡é€»è¾‘æ²¡æ‰§è¡Œå®Œï¼Œ3 ç§’åé”è¢«è‡ªåŠ¨é‡Šæ”¾ã€‚</li>\n<li>index2 è·å–åˆ°é”ï¼Œæ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œ3 ç§’åé”è¢«è‡ªåŠ¨é‡Šæ”¾ã€‚</li>\n<li>index3 è·å–åˆ°é”ï¼Œæ‰§è¡Œä¸šåŠ¡é€»è¾‘</li>\n<li>index1 ä¸šåŠ¡é€»è¾‘æ‰§è¡Œå®Œæˆï¼Œå¼€å§‹è°ƒç”¨ del é‡Šæ”¾é”ï¼Œè¿™æ—¶é‡Šæ”¾çš„æ˜¯ index3 çš„é”ï¼Œå¯¼è‡´ index3 çš„ä¸šåŠ¡åªæ‰§è¡Œ 1s å°±è¢«åˆ«äººé‡Šæ”¾ã€‚<br>\næœ€ç»ˆç­‰äºæ²¡é”çš„æƒ…å†µã€‚</li>\n</ol>\n<p>** è§£å†³ï¼š**setnx è·å–é”æ—¶ï¼Œè®¾ç½®ä¸€ä¸ªæŒ‡å®šçš„å”¯ä¸€å€¼ï¼ˆä¾‹å¦‚ï¼šuuidï¼‰ï¼›é‡Šæ”¾å‰è·å–è¿™ä¸ªå€¼ï¼Œåˆ¤æ–­æ˜¯å¦è‡ªå·±çš„é”</p>\n<p><strong>å›¾ç‰‡åˆ†æï¼š</strong></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220808142646549.png\" alt=\"image-20220808142646549\"></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220802091705477.png\" alt=\"image-20220802091705477\"></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220802091817746.png\" alt=\"image-20220802091817746\"></p>\n<h3 id=\"1646ä¼˜åŒ–ä¹‹luaè„šæœ¬ä¿è¯åˆ é™¤çš„åŸå­æ€§\"><a class=\"markdownIt-Anchor\" href=\"#1646ä¼˜åŒ–ä¹‹luaè„šæœ¬ä¿è¯åˆ é™¤çš„åŸå­æ€§\">#</a> 16.4.6.\tä¼˜åŒ–ä¹‹ LUA è„šæœ¬ä¿è¯åˆ é™¤çš„åŸå­æ€§</h3>\n<p>** é—®é¢˜ï¼š** åˆ é™¤æ“ä½œç¼ºä¹åŸå­æ€§ã€‚</p>\n<p><strong>å›¾ç‰‡åˆ†æï¼š</strong></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220808143635697.png\" alt=\"image-20220808143635697\"></p>\n<p><strong>åœºæ™¯ï¼š</strong></p>\n<ol>\n<li>index1 æ‰§è¡Œåˆ é™¤æ—¶ï¼ŒæŸ¥è¯¢åˆ°çš„ lock å€¼ç¡®å®å’Œ uuid ç›¸ç­‰</li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>uuid<span class=\"token operator\">=</span>v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>lock<span class=\"token punctuation\">,</span>uuid<span class=\"token punctuation\">)</span>ï¼›</pre></td></tr></table></figure><p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220802091921511.png\" alt=\"image-20220802091921511\"></p>\n<ol start=\"2\">\n<li>index1 æ‰§è¡Œåˆ é™¤å‰ï¼Œlock åˆšå¥½è¿‡æœŸæ—¶é—´å·²åˆ°ï¼Œè¢« redis è‡ªåŠ¨é‡Šæ”¾<br>\nåœ¨ redis ä¸­æ²¡æœ‰äº† lockï¼Œæ²¡æœ‰äº†é”ã€‚</li>\n</ol>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220802091953632.png\" alt=\"image-20220802091953632\"></p>\n<ol start=\"3\">\n<li>index2 è·å–äº† lock<br>\nindex2 çº¿ç¨‹è·å–åˆ°äº† cpu çš„èµ„æºï¼Œå¼€å§‹æ‰§è¡Œæ–¹æ³•</li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>uuid<span class=\"token operator\">=</span>v2</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>lock<span class=\"token punctuation\">,</span>uuid<span class=\"token punctuation\">)</span>ï¼›</pre></td></tr></table></figure><ol start=\"4\">\n<li>index1 æ‰§è¡Œåˆ é™¤ï¼Œæ­¤æ—¶ä¼šæŠŠ index2 çš„ lock åˆ é™¤<br>\n index1 å› ä¸ºå·²ç»åœ¨æ–¹æ³•ä¸­äº†ï¼Œæ‰€ä»¥ä¸éœ€è¦é‡æ–°ä¸Šé”ã€‚index1 æœ‰æ‰§è¡Œçš„æƒé™ã€‚index1 å·²ç»æ¯”è¾ƒå®Œæˆäº†ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå¼€å§‹æ‰§è¡Œ</li>\n</ol>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220802092126594.png\" alt=\"image-20220802092126594\"></p>\n<p>åˆ é™¤çš„ index2 çš„é”ï¼</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"testLockLua\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testLockLua</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">//1 å£°æ˜ä¸€ä¸ª uuid , å°†åšä¸ºä¸€ä¸ª value æ”¾å…¥æˆ‘ä»¬çš„ key æ‰€å¯¹åº”çš„å€¼ä¸­</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">String</span> uuid <span class=\"token operator\">=</span> <span class=\"token constant\">UUID</span><span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">//2 å®šä¹‰ä¸€ä¸ªé”ï¼šlua è„šæœ¬å¯ä»¥ä½¿ç”¨åŒä¸€æŠŠé”ï¼Œæ¥å®ç°åˆ é™¤ï¼</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token class-name\">String</span> skuId <span class=\"token operator\">=</span> <span class=\"token string\">\"25\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// è®¿é—® skuId ä¸º 25 å·çš„å•†å“ 100008348542</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token class-name\">String</span> locKey <span class=\"token operator\">=</span> <span class=\"token string\">\"lock:\"</span> <span class=\"token operator\">+</span> skuId<span class=\"token punctuation\">;</span> <span class=\"token comment\">// é”ä½çš„æ˜¯æ¯ä¸ªå•†å“çš„æ•°æ®</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// 3 è·å–é”</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token class-name\">Boolean</span> lock <span class=\"token operator\">=</span> redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setIfAbsent</span><span class=\"token punctuation\">(</span>locKey<span class=\"token punctuation\">,</span> uuid<span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">TimeUnit</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SECONDS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token comment\">// ç¬¬ä¸€ç§ï¼š lock ä¸è¿‡æœŸæ—¶é—´ä¸­é—´ä¸å†™ä»»ä½•çš„ä»£ç ã€‚</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token comment\">//redisTemplate.expire (\"lock\",10, TimeUnit.SECONDS);// è®¾ç½®è¿‡æœŸæ—¶é—´</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t<span class=\"token comment\">// å¦‚æœ true</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>lock<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token comment\">// æ‰§è¡Œçš„ä¸šåŠ¡é€»è¾‘å¼€å§‹</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\">// è·å–ç¼“å­˜ä¸­çš„ num æ•°æ®</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token class-name\">Object</span> value <span class=\"token operator\">=</span> redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"num\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token comment\">// å¦‚æœæ˜¯ç©ºç›´æ¥è¿”å›</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token comment\">// ä¸æ˜¯ç©º å¦‚æœè¯´åœ¨è¿™å‡ºç°äº†å¼‚å¸¸ï¼ é‚£ä¹ˆ delete å°±åˆ é™¤å¤±è´¥ï¼ ä¹Ÿå°±æ˜¯è¯´é”æ°¸è¿œå­˜åœ¨ï¼</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">int</span> num <span class=\"token operator\">=</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">+</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token comment\">// ä½¿ num æ¯æ¬¡ + 1 æ”¾å…¥ç¼“å­˜</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"num\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">valueOf</span><span class=\"token punctuation\">(</span><span class=\"token operator\">++</span>num<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token comment\">/* ä½¿ç”¨ lua è„šæœ¬æ¥é” */</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token comment\">// å®šä¹‰ lua è„šæœ¬</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token class-name\">String</span> script <span class=\"token operator\">=</span> <span class=\"token string\">\"if redis.call('get', KEYS[1]) == ARGV[1] then return redis.call('del', KEYS[1]) else return 0 end\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token comment\">// ä½¿ç”¨ redis æ‰§è¡Œ lua æ‰§è¡Œ</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token class-name\">DefaultRedisScript</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> redisScript <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultRedisScript</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        redisScript<span class=\"token punctuation\">.</span><span class=\"token function\">setScriptText</span><span class=\"token punctuation\">(</span>script<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token comment\">// è®¾ç½®ä¸€ä¸‹è¿”å›å€¼ç±»å‹ ä¸º Long</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token comment\">// å› ä¸ºåˆ é™¤åˆ¤æ–­çš„æ—¶å€™ï¼Œè¿”å›çš„ 0, ç»™å…¶å°è£…ä¸ºæ•°æ®ç±»å‹ã€‚å¦‚æœä¸å°è£…é‚£ä¹ˆé»˜è®¤è¿”å› String ç±»å‹ï¼Œ</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token comment\">// é‚£ä¹ˆè¿”å›å­—ç¬¦ä¸²ä¸ 0 ä¼šæœ‰å‘ç”Ÿé”™è¯¯ã€‚</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        redisScript<span class=\"token punctuation\">.</span><span class=\"token function\">setResultType</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token comment\">// ç¬¬ä¸€ä¸ªè¦æ˜¯ script è„šæœ¬ ï¼Œç¬¬äºŒä¸ªéœ€è¦åˆ¤æ–­çš„ keyï¼Œç¬¬ä¸‰ä¸ªå°±æ˜¯ key æ‰€å¯¹åº”çš„å€¼ã€‚</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span>redisScript<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Arrays</span><span class=\"token punctuation\">.</span><span class=\"token function\">asList</span><span class=\"token punctuation\">(</span>locKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> uuid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token comment\">// å…¶ä»–çº¿ç¨‹ç­‰å¾…</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token comment\">// ç¡çœ </span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token comment\">// ç¡é†’äº†ä¹‹åï¼Œè°ƒç”¨æ–¹æ³•ã€‚</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token function\">testLockLua</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>Lua è„šæœ¬è¯¦è§£ï¼š</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220802092521165.png\" alt=\"image-20220802092521165\"></p>\n<p>é¡¹ç›®ä¸­æ­£ç¡®ä½¿ç”¨ï¼š</p>\n<p>å®šä¹‰ keyï¼Œkey åº”è¯¥æ˜¯ä¸ºæ¯ä¸ª sku å®šä¹‰çš„ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ª sku æœ‰ä¸€æŠŠé”ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">String</span> locKey <span class=\"token operator\">=</span><span class=\"token string\">\"lock:\"</span><span class=\"token operator\">+</span>skuId<span class=\"token punctuation\">;</span> <span class=\"token comment\">// é”ä½çš„æ˜¯æ¯ä¸ªå•†å“çš„æ•°æ®</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">Boolean</span> lock <span class=\"token operator\">=</span> redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setIfAbsent</span><span class=\"token punctuation\">(</span>locKey<span class=\"token punctuation\">,</span> uuid<span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">TimeUnit</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SECONDS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220802092834206.png\" alt=\"image-20220802092834206\"></p>\n<h3 id=\"1647æ€»ç»“\"><a class=\"markdownIt-Anchor\" href=\"#1647æ€»ç»“\">#</a> 16.4.7.\tæ€»ç»“</h3>\n<p>1ã€åŠ é”</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 1. ä» redis ä¸­è·å–é”ï¼Œset k1 v1 px 20000 nx</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">String</span> uuid <span class=\"token operator\">=</span> <span class=\"token constant\">UUID</span><span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token class-name\">Boolean</span> lock <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">setIfAbsent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"lock\"</span><span class=\"token punctuation\">,</span> uuid<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">TimeUnit</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SECONDS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>2ã€ä½¿ç”¨ lua é‡Šæ”¾é”</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 2. é‡Šæ”¾é” del</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">String</span> script <span class=\"token operator\">=</span> <span class=\"token string\">\"if redis.call('get', KEYS[1]) == ARGV[1] then return redis.call('del', KEYS[1]) else return 0 end\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// è®¾ç½® lua è„šæœ¬è¿”å›çš„æ•°æ®ç±»å‹</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token class-name\">DefaultRedisScript</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> redisScript <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultRedisScript</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// è®¾ç½® lua è„šæœ¬è¿”å›ç±»å‹ä¸º Long</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>redisScript<span class=\"token punctuation\">.</span><span class=\"token function\">setResultType</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>redisScript<span class=\"token punctuation\">.</span><span class=\"token function\">setScriptText</span><span class=\"token punctuation\">(</span>script<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span>redisScript<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Arrays</span><span class=\"token punctuation\">.</span><span class=\"token function\">asList</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"lock\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>uuid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>3ã€é‡è¯•</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">testLock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>ä¸ºäº†ç¡®ä¿åˆ†å¸ƒå¼é”å¯ç”¨ï¼Œæˆ‘ä»¬è‡³å°‘è¦ç¡®ä¿é”çš„å®ç°åŒæ—¶<strong>æ»¡è¶³ä»¥ä¸‹å››ä¸ªæ¡ä»¶</strong>ï¼š</p>\n<ul>\n<li>äº’æ–¥æ€§ã€‚åœ¨ä»»æ„æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯èƒ½æŒæœ‰é”ã€‚</li>\n<li>ä¸ä¼šå‘ç”Ÿæ­»é”ã€‚å³ä½¿æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯åœ¨æŒæœ‰é”çš„æœŸé—´å´©æºƒè€Œæ²¡æœ‰ä¸»åŠ¨è§£é”ï¼Œä¹Ÿèƒ½ä¿è¯åç»­å…¶ä»–å®¢æˆ·ç«¯èƒ½åŠ é”ã€‚</li>\n<li>è§£é“ƒè¿˜é¡»ç³»é“ƒäººã€‚åŠ é”å’Œè§£é”å¿…é¡»æ˜¯åŒä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯è‡ªå·±ä¸èƒ½æŠŠåˆ«äººåŠ çš„é”ç»™è§£äº†ã€‚</li>\n<li>åŠ é”å’Œè§£é”å¿…é¡»å…·æœ‰åŸå­æ€§ã€‚</li>\n</ul>\n<h1 id=\"åä¸ƒ-redis60æ–°åŠŸèƒ½\"><a class=\"markdownIt-Anchor\" href=\"#åä¸ƒ-redis60æ–°åŠŸèƒ½\">#</a> åä¸ƒã€Redis6.0 æ–°åŠŸèƒ½</h1>\n<h2 id=\"1-acl\"><a class=\"markdownIt-Anchor\" href=\"#1-acl\">#</a> 1 - ACL</h2>\n<h3 id=\"1711ç®€ä»‹\"><a class=\"markdownIt-Anchor\" href=\"#1711ç®€ä»‹\">#</a> 17.1.1.\tç®€ä»‹</h3>\n<p>Redis  <code>ACL</code>  æ˜¯ <code>Access Control List</code> ï¼ˆè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼‰çš„ç¼©å†™ï¼Œè¯¥åŠŸèƒ½å…è®¸æ ¹æ®<strong>å¯ä»¥æ‰§è¡Œçš„å‘½ä»¤</strong>å’Œ<strong>å¯ä»¥è®¿é—®çš„é”®</strong>æ¥é™åˆ¶æŸäº›è¿æ¥ã€‚</p>\n<p>åœ¨ Redis 5 ç‰ˆæœ¬ä¹‹å‰ï¼ŒRedis å®‰å…¨è§„åˆ™åªæœ‰å¯†ç æ§åˆ¶ è¿˜æœ‰é€šè¿‡ rename æ¥è°ƒæ•´é«˜å±å‘½ä»¤æ¯”å¦‚ flushdb ï¼Œ KEYS* ï¼Œ shutdown ç­‰ã€‚Redis 6 åˆ™æä¾› ACL çš„åŠŸèƒ½å¯¹ç”¨æˆ·è¿›è¡Œæ›´ç»†ç²’åº¦çš„æƒé™æ§åˆ¶ ï¼š</p>\n<p>ï¼ˆ1ï¼‰æ¥å…¥æƒé™ï¼šç”¨æˆ·åå’Œå¯†ç <br>\nï¼ˆ2ï¼‰å¯ä»¥æ‰§è¡Œçš„å‘½ä»¤<br>\nï¼ˆ3ï¼‰å¯ä»¥æ“ä½œçš„ KEY</p>\n<p>å‚è€ƒå®˜ç½‘ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9yZWRpcy5pby90b3BpY3MvYWNs\">https://redis.io/topics/acl</span></p>\n<h3 id=\"1712å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#1712å‘½ä»¤\">#</a> 17.1.2.\tå‘½ä»¤</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>å‘½ä»¤ï¼š</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tï¼ˆ1ï¼‰æŸ¥çœ‹æƒé™åˆ—è¡¨ï¼šacl list</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tï¼ˆ2ï¼‰æŸ¥çœ‹æƒé™ç±»åˆ«ï¼šacl <span class=\"token function\">cat</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tï¼ˆ3ï¼‰æŸ¥çœ‹å½“å‰ç”¨æˆ·ï¼šacl <span class=\"token function\">whoami</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tï¼ˆ4ï¼‰åˆ›å»ºå’Œç¼–è¾‘ç”¨æˆ·ï¼šacl setuser</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>å…·ä½“ä½¿ç”¨è§ä¸‹ï¼š</pre></td></tr></table></figure><p>1ã€ä½¿ç”¨ acl list å‘½ä»¤å±•ç°ç”¨æˆ·æƒé™åˆ—è¡¨<br>\nï¼ˆ1ï¼‰æ•°æ®è¯´æ˜</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220802093424775.png\" alt=\"image-20220802093424775\"></p>\n<p>2ã€ä½¿ç”¨ acl cat å‘½ä»¤<br>\nï¼ˆ1ï¼‰æŸ¥çœ‹æ·»åŠ æƒé™æŒ‡ä»¤ç±»åˆ«</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220802093544283.png\" alt=\"image-20220802093544283\"></p>\n<p>ï¼ˆ2ï¼‰åŠ å‚æ•°ç±»å‹åå¯ä»¥æŸ¥çœ‹ç±»å‹ä¸‹å…·ä½“å‘½ä»¤</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220802093606610.png\" alt=\"image-20220802093606610\"></p>\n<p>3ã€ä½¿ç”¨ acl whoami å‘½ä»¤æŸ¥çœ‹å½“å‰ç”¨æˆ·</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220802093652694.png\" alt=\"image-20220802093652694\"></p>\n<p>4ã€ä½¿ç”¨ aclsetuser å‘½ä»¤åˆ›å»ºå’Œç¼–è¾‘ç”¨æˆ· ACL</p>\n<p>ï¼ˆ1ï¼‰ACL è§„åˆ™<br>\nä¸‹é¢æ˜¯æœ‰æ•ˆ ACL è§„åˆ™çš„åˆ—è¡¨ã€‚æŸäº›è§„åˆ™åªæ˜¯ç”¨äºæ¿€æ´»æˆ–åˆ é™¤æ ‡å¿—ï¼Œæˆ–å¯¹ç”¨æˆ· ACL æ‰§è¡Œç»™å®šæ›´æ”¹çš„å•ä¸ªå•è¯ã€‚å…¶ä»–è§„åˆ™æ˜¯å­—ç¬¦å‰ç¼€ï¼Œå®ƒä»¬ä¸å‘½ä»¤æˆ–ç±»åˆ«åç§°ã€é”®æ¨¡å¼ç­‰è¿æ¥åœ¨ä¸€èµ·ã€‚</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220802094003527.png\" alt=\"image-20220802094003527\"></p>\n<p>ï¼ˆ2ï¼‰é€šè¿‡å‘½ä»¤åˆ›å»ºæ–°ç”¨æˆ·é»˜è®¤æƒé™<br>\n <code>acl setuser user1</code></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220802094158447.png\" alt=\"image-20220802094158447\"></p>\n<p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘æ ¹æœ¬æ²¡æœ‰æŒ‡å®šä»»ä½•è§„åˆ™ã€‚å¦‚æœç”¨æˆ·ä¸å­˜åœ¨ï¼Œè¿™å°†ä½¿ç”¨ just created çš„é»˜è®¤å±æ€§æ¥åˆ›å»ºç”¨æˆ·ã€‚å¦‚æœç”¨æˆ·å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸Šé¢çš„å‘½ä»¤å°†ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚</p>\n<p>ï¼ˆ3ï¼‰è®¾ç½®æœ‰ç”¨æˆ·åã€å¯†ç ã€ACL æƒé™ã€å¹¶å¯ç”¨çš„ç”¨æˆ·<br>\n <code>acl setuser user2 on &gt;password ~cached:* +get</code></p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220802094428400.png\" alt=\"image-20220802094428400\"></p>\n<p>(4) åˆ‡æ¢ç”¨æˆ·ï¼ŒéªŒè¯æƒé™</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220802094549151.png\" alt=\"image-20220802094549151\"></p>\n<h2 id=\"2-ioå¤šçº¿ç¨‹\"><a class=\"markdownIt-Anchor\" href=\"#2-ioå¤šçº¿ç¨‹\">#</a> 2 - IO å¤šçº¿ç¨‹</h2>\n<h3 id=\"1721ç®€ä»‹\"><a class=\"markdownIt-Anchor\" href=\"#1721ç®€ä»‹\">#</a> 17.2.1.\tç®€ä»‹</h3>\n<p>Redis6 ç»ˆäºæ”¯æ’‘å¤šçº¿ç¨‹äº†ï¼Œå‘Šåˆ«å•çº¿ç¨‹äº†å—ï¼Ÿ</p>\n<p>IO å¤šçº¿ç¨‹å…¶å®æŒ‡<strong>å®¢æˆ·ç«¯äº¤äº’éƒ¨åˆ†çš„ç½‘ç»œ IO äº¤äº’å¤„ç†æ¨¡å—å¤šçº¿ç¨‹</strong>ï¼Œè€Œéæ‰§è¡Œå‘½ä»¤å¤šçº¿ç¨‹ã€‚Redis6 æ‰§è¡Œå‘½ä»¤ä¾ç„¶æ˜¯å•çº¿ç¨‹ã€‚</p>\n<h3 id=\"1722åŸç†æ¶æ„\"><a class=\"markdownIt-Anchor\" href=\"#1722åŸç†æ¶æ„\">#</a> 17.2.2.\tåŸç†æ¶æ„</h3>\n<p>Redis 6 åŠ å…¥å¤šçº¿ç¨‹ï¼Œä½†è·Ÿ Memcached è¿™ç§ä» IO å¤„ç†åˆ°æ•°æ®è®¿é—®å¤šçº¿ç¨‹çš„å®ç°æ¨¡å¼æœ‰äº›å·®å¼‚ã€‚Redis çš„å¤šçº¿ç¨‹éƒ¨åˆ†åªæ˜¯ç”¨æ¥<strong>å¤„ç†ç½‘ç»œæ•°æ®çš„è¯»å†™å’Œåè®®è§£æ</strong>ï¼Œæ‰§è¡Œå‘½ä»¤ä»ç„¶æ˜¯å•çº¿ç¨‹ã€‚ä¹‹æ‰€ä»¥è¿™ä¹ˆè®¾è®¡æ˜¯ä¸æƒ³å› ä¸ºå¤šçº¿ç¨‹è€Œå˜å¾—å¤æ‚ï¼Œéœ€è¦å»æ§åˆ¶ keyã€luaã€äº‹åŠ¡ï¼ŒLPUSH/LPOP ç­‰ç­‰çš„å¹¶å‘é—®é¢˜ã€‚æ•´ä½“çš„è®¾è®¡å¤§ä½“å¦‚ä¸‹:</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220802094700691.png\" alt=\"image-20220802094700691\"></p>\n<p>å¦å¤–ï¼Œå¤šçº¿ç¨‹ IO é»˜è®¤ä¹Ÿæ˜¯ä¸å¼€å¯çš„ï¼Œéœ€è¦å†é…ç½®æ–‡ä»¶ä¸­é…ç½®</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>io-threads-do-reads  <span class=\"token function\">yes</span> </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>io-threads <span class=\"token number\">4</span></pre></td></tr></table></figure><h2 id=\"3-å·¥å…·æ”¯æŒ-cluster\"><a class=\"markdownIt-Anchor\" href=\"#3-å·¥å…·æ”¯æŒ-cluster\">#</a> 3 - å·¥å…·æ”¯æŒ Cluster</h2>\n<p>ä¹‹å‰è€ç‰ˆ Redis æƒ³è¦æ­é›†ç¾¤éœ€è¦å•ç‹¬å®‰è£… ruby ç¯å¢ƒï¼ŒRedis 5 å°† redis-trib.rb çš„åŠŸèƒ½é›†æˆåˆ° redis-cli ã€‚</p>\n<p>å¦å¤–å®˜æ–¹ redis-benchmark å·¥å…·å¼€å§‹æ”¯æŒ  <code>cluster</code>  æ¨¡å¼äº†ï¼Œé€šè¿‡å¤šçº¿ç¨‹çš„æ–¹å¼å¯¹å¤šä¸ªåˆ†ç‰‡è¿›è¡Œå‹æµ‹ã€‚</p>\n<p><img data-src=\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4496/image-20220802095313745.png\" alt=\"image-20220802095313745\"></p>\n<h2 id=\"4-redisæ–°åŠŸèƒ½æŒç»­å…³æ³¨\"><a class=\"markdownIt-Anchor\" href=\"#4-redisæ–°åŠŸèƒ½æŒç»­å…³æ³¨\">#</a> 4 - Redis æ–°åŠŸèƒ½æŒç»­å…³æ³¨</h2>\n<p>Redis6 æ–°åŠŸèƒ½è¿˜æœ‰ï¼š</p>\n<p>1ã€RESP3 æ–°çš„ Redis é€šä¿¡åè®®ï¼šä¼˜åŒ–æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ä¹‹é—´é€šä¿¡</p>\n<p>2ã€Client side caching å®¢æˆ·ç«¯ç¼“å­˜ï¼šåŸºäº RESP3 åè®®å®ç°çš„å®¢æˆ·ç«¯ç¼“å­˜åŠŸèƒ½ã€‚ä¸ºäº†è¿›ä¸€æ­¥æå‡ç¼“å­˜çš„æ€§èƒ½ï¼Œå°†å®¢æˆ·ç«¯ç»å¸¸è®¿é—®çš„æ•°æ® cache åˆ°å®¢æˆ·ç«¯ã€‚å‡å°‘ TCP ç½‘ç»œäº¤äº’ã€‚</p>\n<p>3ã€Proxy é›†ç¾¤ä»£ç†æ¨¡å¼ï¼šProxy åŠŸèƒ½ï¼Œè®© Cluster æ‹¥æœ‰åƒå•å®ä¾‹ä¸€æ ·çš„æ¥å…¥æ–¹å¼ï¼Œé™ä½å¤§å®¶ä½¿ç”¨ cluster çš„é—¨æ§›ã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ä»£ç†ä¸æ”¹å˜ Cluster çš„åŠŸèƒ½é™åˆ¶ï¼Œä¸æ”¯æŒçš„å‘½ä»¤è¿˜æ˜¯ä¸ä¼šæ”¯æŒï¼Œæ¯”å¦‚è·¨ slot çš„å¤š Key æ“ä½œã€‚</p>\n<p>4ã€Modules API<br>\nRedis 6 ä¸­æ¨¡å— API å¼€å‘è¿›å±•éå¸¸å¤§ï¼Œå› ä¸º Redis Labs ä¸ºäº†å¼€å‘å¤æ‚çš„åŠŸèƒ½ï¼Œä»ä¸€å¼€å§‹å°±ç”¨ä¸Š Redis æ¨¡å—ã€‚Redis å¯ä»¥å˜æˆä¸€ä¸ªæ¡†æ¶ï¼Œåˆ©ç”¨ Modules æ¥æ„å»ºä¸åŒç³»ç»Ÿï¼Œè€Œä¸éœ€è¦ä»å¤´å¼€å§‹å†™ç„¶åè¿˜è¦ BSD è®¸å¯ã€‚Redis ä¸€å¼€å§‹å°±æ˜¯ä¸€ä¸ªå‘ç¼–å†™å„ç§ç³»ç»Ÿå¼€æ”¾çš„å¹³å°ã€‚</p>\n",
            "tags": [
                "Redis"
            ]
        }
    ]
}